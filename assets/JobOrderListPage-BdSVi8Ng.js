import{j as e,r as C,a as k,a7 as n,h as L,e as _,y as f,u as J,k as I,D as E,P as R,A}from"./index-zSIHDd_i.js";import{L as W}from"./ListWrapper-DoFaRH6P.js";import{T as z,a as G,b as d}from"./TableWrapper-Bwk1LSIu.js";import{T as H}from"./TableRow-F8MSZPbu.js";import{T as U,a as F}from"./TableDelete-BEyOmHVS.js";import{T as V}from"./TableEdit-D3e67rz4.js";import{D as M,P as O,S as $,V as s,I as q,T as l,a as Q,p as K}from"./react-pdf.browser-DC0RARgm.js";import{L as X}from"./Loading-BqWFEu0c.js";import{u as Y}from"./usePagination-mcOS4Aak.js";import{c as Z,a as B}from"./rolePermissions-NXJEoSR0.js";import{S as ee}from"./StatusFilter-CSiUwQ3Q.js";const D=r=>r?new Date(r).toLocaleDateString("en-IN",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",te=({jobOrder:r})=>{const x=r?.operations||[];return console.log("operations",x),e.jsx(M,{children:e.jsxs(O,{size:"A4",style:t.page,children:[e.jsx(s,{style:t.headerContainer,children:e.jsx(s,{style:t.logoSection,children:e.jsx(q,{src:"/assets/images/logo.png",style:t.logo})})}),e.jsx(l,{style:t.title,children:"Job Card"}),e.jsx(s,{style:t.jobDetailsContainer,children:e.jsxs(s,{style:t.detailsGrid,children:[e.jsxs(s,{style:t.leftColumn,children:[e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"Job Name:"}),e.jsx(l,{style:t.value,children:r.job_name||"-"})]}),e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"Job Card No:"}),e.jsx(l,{style:t.value,children:r.job_card_number||"-"})]}),e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"Processing Date:"}),e.jsx(l,{style:t.value,children:D(r.job_date)})]}),e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"Location:"}),e.jsx(l,{style:t.value,children:r.location||"-"})]})]}),e.jsxs(s,{style:t.rightColumn,children:[e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"Quantity:"}),e.jsx(l,{style:t.value,children:r.quantity||"-"})]}),e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"Expected Delivery:"}),e.jsx(l,{style:t.value,children:D(r.expected_delivery_date)})]}),e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"Customer Name:"}),e.jsx(l,{style:t.value,children:r.customer?.party_name||r.customer_name||"-"})]}),e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"RGP/Invoice no:"}),e.jsx(l,{style:t.value,children:r.rgp_invoice_no||"-"})]})]})]})}),e.jsxs(s,{style:t.descriptionSection,children:[e.jsx(l,{style:t.sectionTitle,children:"Job Description:"}),e.jsx(s,{style:t.descriptionBox,children:e.jsx(l,{style:t.descriptionText,children:r.job_description||"-"})})]}),e.jsxs(s,{style:t.operationsSection,children:[e.jsx(l,{style:t.sectionTitle,children:"List of Operations"}),e.jsxs(s,{style:t.tableContainer,children:[e.jsxs(s,{style:t.tableHeaderRow,children:[e.jsx(s,{style:[t.tableCell,t.snoCol,t.headerCell],children:e.jsx(l,{style:t.headerText,children:"S.no"})}),e.jsx(s,{style:[t.tableCell,t.operationCol,t.headerCell],children:e.jsx(l,{style:t.headerText,children:"Operation Name"})}),e.jsx(s,{style:[t.tableCell,t.supervisorCol,t.headerCell],children:e.jsx(l,{style:t.headerText,children:"Supervisor"})}),e.jsx(s,{style:[t.tableCell,t.startDateCol,t.headerCell],children:e.jsx(l,{style:t.headerText,children:"Start Date"})}),e.jsx(s,{style:[t.tableCell,t.endDateCol,t.headerCell],children:e.jsx(l,{style:t.headerText,children:"End Date"})}),e.jsx(s,{style:[t.tableCell,t.machineCol,t.headerCell],children:e.jsx(l,{style:t.headerText,children:"Machine Name"})})]}),x.length>0?x.map((o,h)=>e.jsxs(s,{style:t.tableRow,children:[e.jsx(s,{style:[t.tableCell,t.snoCol],children:e.jsx(l,{style:t.cellText,children:h+1})}),e.jsx(s,{style:[t.tableCell,t.operationCol],children:e.jsx(l,{style:t.cellText,children:o.operation_name||"-"})}),e.jsx(s,{style:[t.tableCell,t.supervisorCol],children:e.jsx(l,{style:t.cellText,children:o.supervisor?.full_name||"-"})}),e.jsx(s,{style:[t.tableCell,t.startDateCol],children:e.jsx(l,{style:t.cellText,children:D(o.start_date)})}),e.jsx(s,{style:[t.tableCell,t.endDateCol],children:e.jsx(l,{style:t.cellText,children:D(o.end_date)})}),e.jsx(s,{style:[t.tableCell,t.machineCol],children:e.jsx(l,{style:t.cellText,children:o.machine?.name||"-"})})]},h)):Array.from({length:5}).map((o,h)=>e.jsxs(s,{style:t.tableRow,children:[e.jsx(s,{style:[t.tableCell,t.snoCol],children:e.jsx(l,{style:t.cellText})}),e.jsx(s,{style:[t.tableCell,t.operationCol],children:e.jsx(l,{style:t.cellText})}),e.jsx(s,{style:[t.tableCell,t.supervisorCol],children:e.jsx(l,{style:t.cellText})}),e.jsx(s,{style:[t.tableCell,t.startDateCol],children:e.jsx(l,{style:t.cellText})}),e.jsx(s,{style:[t.tableCell,t.endDateCol],children:e.jsx(l,{style:t.cellText})}),e.jsx(s,{style:[t.tableCell,t.machineCol],children:e.jsx(l,{style:t.cellText})})]},h))]})]}),e.jsxs(s,{style:t.remarksSection,children:[e.jsx(l,{style:t.sectionTitle,children:"Additional Remarks/Notes:"}),e.jsx(s,{style:t.remarksBox,children:e.jsx(l,{style:t.remarksText,children:r.remarks||r.note||""})})]}),e.jsxs(s,{style:t.documentsSection,children:[e.jsx(l,{style:t.sectionTitle,children:"Attached Documents"}),e.jsx(s,{style:t.documentsBox,children:e.jsx(l,{style:t.documentsText})})]})]})})},t=$.create({page:{padding:20,fontSize:10,fontFamily:"Helvetica",lineHeight:1.3},headerContainer:{flexDirection:"row",alignItems:"center",marginBottom:15,paddingBottom:5},logoSection:{width:"80%",marginRight:15},logo:{width:100,height:50},companyInfo:{width:"85%",justifyContent:"center",alignItems:"center"},companyName:{fontSize:14,fontWeight:"bold"},title:{fontSize:16,textAlign:"center",marginBottom:20,fontWeight:"bold"},jobDetailsContainer:{marginBottom:15,borderWidth:1,borderColor:"#000"},detailsGrid:{flexDirection:"row",padding:8},leftColumn:{width:"50%",paddingRight:10},rightColumn:{width:"50%",paddingLeft:10},detailRow:{flexDirection:"row",marginBottom:8,alignItems:"flex-start"},label:{width:"40%",fontSize:9,fontWeight:"bold"},value:{width:"60%",fontSize:9,borderBottomWidth:.5,borderBottomColor:"#ccc",paddingBottom:2},descriptionSection:{marginBottom:15},sectionTitle:{fontSize:10,fontWeight:"bold",marginBottom:5},descriptionBox:{borderWidth:1,borderColor:"#000",minHeight:60,padding:8},descriptionText:{fontSize:9},operationsSection:{marginBottom:15},tableContainer:{borderWidth:1,borderColor:"#000"},tableHeaderRow:{flexDirection:"row",backgroundColor:"#f0f0f0"},tableRow:{flexDirection:"row",minHeight:25},tableCell:{padding:4,borderWidth:.5,borderColor:"#000",justifyContent:"center",alignItems:"center"},headerCell:{backgroundColor:"#f0f0f0"},headerText:{fontSize:9,fontWeight:"bold",textAlign:"center"},cellText:{fontSize:8,textAlign:"center"},snoCol:{width:"8%"},operationCol:{width:"25%"},supervisorCol:{width:"20%"},startDateCol:{width:"15%"},endDateCol:{width:"15%"},machineCol:{width:"17%"},remarksSection:{marginBottom:15},remarksBox:{borderWidth:1,borderColor:"#000",minHeight:50,padding:8},remarksText:{fontSize:9},documentsSection:{marginBottom:15},documentsBox:{borderWidth:1,borderColor:"#000",minHeight:50,padding:8},documentsText:{fontSize:9}}),se=({jobOrder:r,onStatusUpdate:x})=>{const[o,h]=C.useState(!1),{user:v}=k(),w=async i=>{h(!0);try{await L.post(_.job_order.statusActions,{job_card_id:r.job_card_id,status:i}),f.success("Status updated successfully"),x()}catch(c){console.error("Failed to update status:",c),f.error(c.response?.data?.message||"Failed to update status")}finally{h(!1)}},g=(()=>{const i=v?.role?.role_name,c=r.status,u=Z(i||""),m=B(i||"")||i==="Super Admin"||u;let a=[];switch(c){case n.PENDING:u&&(a=[n.APPROVED,n.CANCELLED]);break;case n.APPROVED:m&&(a=[n.IN_PROGRESS]),u&&a.push(n.CANCELLED);break;case n.IN_PROGRESS:m&&(a=[n.COMPLETED,n.CLOSED]),u&&a.push(n.CANCELLED);break;case n.COMPLETED:m&&(a=[n.CLOSED]);break;case n.CANCELLED:u&&(a=[n.PENDING]);break;case n.CLOSED:break;case n.OVERDUE:m&&(a=[n.IN_PROGRESS,n.COMPLETED]),u&&a.push(n.CANCELLED);break}return a})(),b=i=>i.replace(/_/g," ").replace(/\b\w/g,c=>c.toUpperCase()),j=i=>{switch(i){case n.PENDING:return"text-yellow-600 bg-yellow-50";case n.APPROVED:return"text-green-600 bg-green-50";case n.IN_PROGRESS:return"text-blue-600 bg-blue-50";case n.COMPLETED:return"text-purple-600 bg-purple-50";case n.CLOSED:return"text-gray-600 bg-gray-50";case n.CANCELLED:return"text-red-600 bg-red-50";case n.OVERDUE:return"text-orange-600 bg-orange-50";default:return"text-gray-600 bg-gray-50"}};return e.jsx("div",{className:"flex items-center gap-2",children:o?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Updating..."})]}):e.jsxs("select",{className:`text-xs border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white min-w-[120px] ${j(r.status)}`,value:r.status,onChange:i=>{i.target.value!==r.status&&w(i.target.value)},disabled:g.length===0,children:[e.jsx("option",{value:r.status,children:b(r.status)}),g.map(i=>e.jsx("option",{value:i,children:b(i)},i))]})})},ue=()=>{const{renderPagination:r}=Y(),x=J(),{selectedBranchId:o,user:h}=k(),{setJobOrders:v}=I(),[w,P]=C.useState([]),[g,b]=C.useState(!1),[j,i]=C.useState(""),c=async()=>{b(!0);try{const y=(await L.get(_.job_order.list,{params:{branch_id:o}})).data?.job_cards||[];P(y);const S=h?.role?.role_name;if(B(S||"")||S==="Super Admin"){const T=y.filter(N=>N.status==="pending").length;v(T)}}catch(a){console.error("Failed to fetch job orders:",a),f.error("Failed to fetch job orders")}finally{b(!1)}},u=async a=>{try{const S=(await L.get(_.job_order.details(a.id))).data.job_card,T=await K(e.jsx(te,{jobOrder:S})).toBlob(),N=URL.createObjectURL(T),p=document.createElement("a");p.href=N,p.setAttribute("download",`job-card-${a.job_card_number||a.id}.pdf`),document.body.appendChild(p),p.click(),p.remove(),URL.revokeObjectURL(N),f.success("Job card downloaded successfully")}catch(y){console.error("Failed to download job card:",y),f.error("Failed to download job card")}};C.useEffect(()=>{c()},[o]);const m=j?w.filter(a=>a.status===j):w;return g?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(X,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(ee,{module:"JobOrderStatus",selectedStatus:j,onChange:i}),e.jsxs(W,{title:`Job Orders (${m.length})`,createOnClick:R.hasPermission("job_card_management_create")?()=>x(A.JOB_ORDER.CREATE):void 0,children:[e.jsxs(z,{children:[e.jsx(G,{cols:[{title:"Job Card No"},{title:"Job Name"},{title:"Customer"},{title:"Job Date"},{title:"Expected Delivery"},{title:"Job Type"},{title:"Created At"},{title:"Status"},{title:"Actions"}]}),e.jsx("tbody",{children:g?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Loading job orders..."})]})})}):m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No job orders"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:j?`No job orders found with status "${j}"`:"Get started by creating a new job order."})]})})}):m.map((a,y)=>e.jsxs(H,{children:[e.jsx(d,{className:"w-12 text-center font-medium",children:e.jsx("div",{className:"text-sm text-gray-900",children:y+1})}),e.jsx(d,{className:"w-40",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.job_card_number||"-"})})}),e.jsx(d,{className:"w-48",children:e.jsx("div",{className:"text-sm text-gray-900",children:a.job_name||"-"})}),e.jsx(d,{className:"w-48",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.customer?.party_name||a.customer_name||"â€”"})})})}),e.jsx(d,{className:"w-32",children:e.jsx("div",{className:"text-sm text-gray-900",children:E.date(a.job_date)})}),e.jsx(d,{className:"w-32",children:e.jsx("div",{className:"text-sm text-gray-900",children:E.date(a.expected_delivery_date)})}),e.jsx(d,{className:"w-32",children:e.jsx("span",{className:"capitalize text-sm text-gray-900",children:a.job_type?.replace(/_/g," ")||"-"})}),e.jsx(d,{className:"w-32",children:e.jsx("div",{className:"text-sm text-gray-500",children:E.date(a.created_at)})}),e.jsx(d,{className:"w-40",children:e.jsx(se,{jobOrder:{job_card_id:a.id,status:a.status},onStatusUpdate:c})}),e.jsx(d,{className:"w-20",children:e.jsxs(U,{children:[R.hasPermission("job_card_management_update")&&e.jsx(V,{onClick:()=>x(`${A.JOB_ORDER.CREATE}?editId=${a.id}`)}),e.jsx(Q,{onClick:()=>u(a)}),R.hasPermission("job_card_management_delete")&&e.jsx(F,{refetch:c,endpoint:_.job_order.delete(a.id)})]})})]},a.id))})]}),m.length>0&&r()]})]})};export{ue as default};
