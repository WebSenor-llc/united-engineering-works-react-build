import{r as g,a as A,j as e,at as r,h as S,e as j,y as E,u as y,D as I,A as R}from"./index-BEme_EUt.js";import{L as T}from"./ListWrapper-BEjqc6VH.js";import{T as D,a as _,b as d}from"./TableWrapper-xBC1zAYs.js";import{T as w}from"./TableRow-ZxJSRXVE.js";import{u as P}from"./usePagination-ncXkOQbX.js";import{T as C}from"./TableActions-D4JklVjJ.js";import{T as L}from"./TableEdit-DP4qb6e7.js";import{T as U}from"./TableDelete-Bx4Sru7-.js";import{c as q,a as k,b as $}from"./rolePermissions-C7V8lw4J.js";const G=({requisition:a,onStatusUpdate:o})=>{const[h,u]=g.useState(!1),{user:c}=A(),b=async t=>{u(!0);try{await S.post(j.repair_requisition.statusActions(a.id),{repair_requisition_id:a.id,status:t}),E.success("Status updated successfully"),o()}catch(i){console.error("Failed to update status:",i),E.error(i.response?.data?.message||"Failed to update status")}finally{u(!1)}},p=(()=>{const t=c?.role?.role_name,i=a.status,f=q(t||""),s=k(t||"")||t==="Super Admin";let n=[];switch(i){case r.PENDING:s&&(n=[r.UNDER_REPAIR]);break;case r.UNDER_REPAIR:s&&(n=[r.READY]);break;case r.READY:break;case r.CANCELLED:f&&(n=[r.PENDING]);break}return n})(),x=t=>t.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase()),m=t=>{switch(t){case r.PENDING:return"text-yellow-600 bg-yellow-50";case r.UNDER_REPAIR:return"text-blue-600 bg-blue-50";case r.READY:return"text-purple-600 bg-purple-50";case r.CANCELLED:return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}};return e.jsx("div",{className:"flex items-center gap-2",children:h?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Updating..."})]}):e.jsxs("select",{className:`text-xs border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white min-w-[120px] ${m(a.status)}`,value:a.status,onChange:t=>{t.target.value!==a.status&&b(t.target.value)},disabled:p.length===0,children:[e.jsx("option",{value:a.status,children:x(a.status)}),p.map(t=>e.jsx("option",{value:t,children:x(t)},t))]})})},K=()=>{const{page:a,rowsPerPage:o,setTotal:h,renderPagination:u}=P(),c=y(),{user:b}=A(),[l,p]=g.useState([]),[x,m]=g.useState(!0),t=async()=>{m(!0);try{const s={page:a+1,rowsPerPage:o},n=await S.get(j.repair_requisition.list,{params:s}),v=n.data?.data||[],N=n.data?.pagination;p(v),N?.total!==void 0&&h(N.total)}catch(s){console.error("Error fetching repair requisitions:",s)}finally{m(!1)}};g.useEffect(()=>{t()},[a,o]);const i=b?.role?.role_name||"",f=$(i)||i==="Super Admin";return e.jsx("div",{className:"space-y-6",children:e.jsxs(T,{title:`Repair Requisitions (${l.length})`,createOnClick:f?()=>c(R.REPAIR_REQUISITION.CREATE):void 0,children:[e.jsxs(D,{children:[e.jsx(_,{cols:[{title:"Repair Item"},{title:"Created At"},{title:"Status"},{title:"Actions"}]}),e.jsx("tbody",{children:x&&l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-sm text-gray-500",children:"Loading repair requisitions..."})]})})}):l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"No repair requisitions found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new repair requisition."})]})})}):l.map((s,n)=>e.jsxs(w,{children:[e.jsx(d,{className:"px-5",children:a*o+n+1}),e.jsx(d,{children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.repair_item})}),e.jsx(d,{className:"w-40",children:e.jsx("div",{className:"text-sm text-gray-500",children:I.date(s.created_at)})}),e.jsx(d,{className:"w-40",children:e.jsx(G,{requisition:s,onStatusUpdate:t})}),e.jsx(d,{className:"w-32",children:e.jsxs(C,{children:[s.status===r.READY&&e.jsx("button",{onClick:()=>c(`${R.REPAIR_ISSUE_SLIP.CREATE}?requisitionId=${s.id}`),className:"text-blue-600 hover:text-blue-800 text-sm font-medium px-2 py-1 rounded hover:bg-blue-50 transition-colors",title:"Issue Slip",children:"Issue Slip"}),e.jsx(L,{onClick:()=>c(`${R.REPAIR_REQUISITION.CREATE}?id=${s.id}`)}),e.jsx(U,{refetch:t,endpoint:j.repair_requisition.delete(s.id)})]})})]},s.id))})]}),l.length>0&&u()]})})};export{K as default};
