import{j as t,u as L,r as b,a as z,A as I,h as _,e as C,y as u}from"./index-B6B_N_Cs.js";import{L as U}from"./ListWrapper-BYqYQIfr.js";import{T as j}from"./TableData-C5KeAsrw.js";import{T as W,a as k}from"./TableWrapper-Dhfo-hqQ.js";import{T as V}from"./TableRow-BRlLKE6x.js";import{u as H}from"./usePagination-B36e-l73.js";import{T as $}from"./TableActions-t42TbFtJ.js";import{T as v}from"./TableDelete-BtMAYzdR.js";import{T as G,a as M}from"./TableDownload-DtJX1FD6.js";import{Document as O,Page as K,StyleSheet as Q,View as s,Image as J,Text as i,pdf as Y}from"./react-pdf.browser-BKG0ZaNm.js";import{C as Z}from"./CommonFilter-C4rgzsJ9.js";import"./index.esm-CjwelUCb.js";import"./TextInput-B4OTG5Ho.js";const X=({data:a})=>{if(!a)return console.error("IssueSlipPdf: No data provided"),null;const h=Array.isArray(a.items)?a.items:[],d=o=>typeof o=="string"?o:typeof o=="object"&&o!==null?o.name?o.name:o.machine_name?o.machine_name:JSON.stringify(o):o?String(o):"-";return t.jsx(O,{children:t.jsxs(K,{size:"A4",style:e.page,children:[t.jsxs(s,{style:e.headerContainer,children:[t.jsx(s,{style:e.logoSection,children:t.jsx(J,{src:"/assets/images/logo.png",style:e.logo})}),t.jsxs(s,{style:e.companyInfo,children:[t.jsx(i,{style:e.companyName,children:"UNITED ENGINEERING WORKS"}),t.jsx(i,{style:e.companyAddress,children:"N.H. 8, Nehla Village, By Pass Road, Near Govardhan Vilas, Udaipur- 313001 (Raj.) INDIA"}),t.jsx(i,{style:e.companyContact,children:"Phone: +91-9829232445 +91-9829657145 | GSTIN: 08ABQPK8948J3ZP | Email: info@unitedengineeringworks.com"})]})]}),t.jsx(i,{style:e.title,children:"ISSUE SLIP"}),t.jsxs(s,{style:e.infoContainer,children:[t.jsxs(s,{style:e.detailRow,children:[t.jsx(i,{style:e.label,children:"MR:"}),t.jsx(i,{style:e.value,children:d(a.mr)})]}),t.jsxs(s,{style:e.detailRow,children:[t.jsx(i,{style:e.label,children:"Machine:"}),t.jsx(i,{style:e.value,children:d(a.machine)})]}),t.jsxs(s,{style:e.detailRow,children:[t.jsx(i,{style:e.label,children:"For Party:"}),t.jsx(i,{style:e.value,children:d(a.for_party)})]}),t.jsxs(s,{style:e.detailRow,children:[t.jsx(i,{style:e.label,children:"For Mines:"}),t.jsx(i,{style:e.value,children:d(a.for_mines)})]}),t.jsxs(s,{style:e.detailRow,children:[t.jsx(i,{style:e.label,children:"Purpose:"}),t.jsx(i,{style:e.value,children:d(a.purpose)})]})]}),t.jsxs(s,{style:e.tableContainer,children:[t.jsxs(s,{style:e.tableHeaderRow,children:[t.jsx(s,{style:[e.tableCell,e.snoCol],children:t.jsx(i,{style:e.headerText,children:"S.No"})}),t.jsx(s,{style:[e.tableCell,e.itemNameCol],children:t.jsx(i,{style:e.headerText,children:"Item Name"})}),t.jsx(s,{style:[e.tableCell,e.itemCodeCol],children:t.jsx(i,{style:e.headerText,children:"Item Code"})}),t.jsx(s,{style:[e.tableCell,e.unitCol],children:t.jsx(i,{style:e.headerText,children:"Unit"})}),t.jsx(s,{style:[e.tableCell,e.qtyCol],children:t.jsx(i,{style:e.headerText,children:"Required QTY"})}),t.jsx(s,{style:[e.tableCell,e.qtyCol],children:t.jsx(i,{style:e.headerText,children:"Issued QTY"})})]}),h.length>0?h.map((o,y)=>t.jsxs(s,{style:e.tableRow,children:[t.jsx(s,{style:[e.tableCell,e.snoCol],children:t.jsx(i,{style:e.cellText,children:y+1})}),t.jsx(s,{style:[e.tableCell,e.itemNameCol],children:t.jsx(i,{style:e.cellText,children:d(o?.item_name)})}),t.jsx(s,{style:[e.tableCell,e.itemCodeCol],children:t.jsx(i,{style:e.cellText,children:d(o?.item_code)})}),t.jsx(s,{style:[e.tableCell,e.unitCol],children:t.jsx(i,{style:e.cellText,children:d(o?.item_unit)})}),t.jsx(s,{style:[e.tableCell,e.qtyCol],children:t.jsx(i,{style:e.cellText,children:d(o?.required_qty)||"0"})}),t.jsx(s,{style:[e.tableCell,e.qtyCol],children:t.jsx(i,{style:e.cellText,children:d(o?.issued_qty)||"0"})})]},y)):Array.from({length:3}).map((o,y)=>t.jsxs(s,{style:e.tableRow,children:[t.jsx(s,{style:[e.tableCell,e.snoCol],children:t.jsx(i,{style:e.cellText,children:"-"})}),t.jsx(s,{style:[e.tableCell,e.itemNameCol],children:t.jsx(i,{style:e.cellText,children:"-"})}),t.jsx(s,{style:[e.tableCell,e.itemCodeCol],children:t.jsx(i,{style:e.cellText,children:"-"})}),t.jsx(s,{style:[e.tableCell,e.unitCol],children:t.jsx(i,{style:e.cellText,children:"-"})}),t.jsx(s,{style:[e.tableCell,e.qtyCol],children:t.jsx(i,{style:e.cellText,children:"-"})}),t.jsx(s,{style:[e.tableCell,e.qtyCol],children:t.jsx(i,{style:e.cellText,children:"-"})})]},y))]}),t.jsx(s,{style:e.signatureContainer,children:t.jsxs(s,{style:e.signatureBox,children:[t.jsx(i,{style:e.signatureTitle,children:"For: UNITED ENGINEERING WORKS"}),t.jsx(s,{style:e.signatureLine}),t.jsx(i,{style:e.signatureText,children:"Authorized Signatory"})]})})]})})},e=Q.create({page:{padding:20,fontSize:10,fontFamily:"Helvetica",lineHeight:1.3},headerContainer:{flexDirection:"row",alignItems:"center",marginBottom:15,gap:15,borderBottomWidth:2,borderBottomColor:"#000",paddingBottom:8},logoSection:{width:"20%"},logo:{width:90,height:50},companyInfo:{width:"80%",paddingLeft:10},companyName:{fontSize:14,fontWeight:"bold"},companyAddress:{fontSize:9},companyContact:{fontSize:9},title:{fontSize:16,textAlign:"center",marginVertical:10,fontWeight:"bold",textDecoration:"underline"},infoContainer:{marginBottom:15},detailRow:{flexDirection:"row",marginBottom:3},label:{width:"25%",fontSize:9,fontWeight:"bold"},value:{width:"75%",fontSize:9},tableContainer:{borderWidth:.25,borderColor:"#000",marginBottom:20},tableHeaderRow:{flexDirection:"row",backgroundColor:"#e0e0e0"},tableRow:{flexDirection:"row"},tableCell:{borderWidth:.25,borderColor:"#000",padding:2,justifyContent:"center",alignItems:"center"},headerText:{fontSize:9,fontWeight:"bold",textAlign:"center"},cellText:{fontSize:8,textAlign:"center"},snoCol:{width:"8%"},itemNameCol:{width:"30%"},itemCodeCol:{width:"20%"},unitCol:{width:"12%"},qtyCol:{width:"15%"},signatureContainer:{marginTop:40,alignItems:"flex-end"},signatureBox:{width:200,alignItems:"center"},signatureTitle:{fontSize:10,fontWeight:"bold",marginBottom:25},signatureLine:{width:150,height:1,backgroundColor:"#000",marginBottom:5},signatureText:{fontSize:9}}),ye=()=>{const{page:a,rowsPerPage:h,setTotal:d,renderPagination:o}=H(),y=L(),[N,R]=b.useState([]),{user:D,selectedBranchId:f}=z(),[w,P]=b.useState({}),E=[{name:"mr_number",label:"MR Number",placeholder:"Enter MR Number"},{name:"item_name",label:"Item Name",placeholder:"Enter Item Name"},{name:"date_from",label:"Date From",type:"date"},{name:"date_to",label:"Date To",type:"date"}],A=l=>{if(!l)return{ymd:"",dmy:""};const[r]=l.split("T"),[c,n,x]=r.split("-");return{ymd:r,dmy:`${x}-${n}-${c}`}},g=async l=>{try{const r={page:a+1,per_page:h,...f&&{branch_id:f}};l&&(l.mr_number&&(r.mr_number=l.mr_number),l.item_name&&(r.item_name=l.item_name),l.date_from&&l.date_to?l.date_from===l.date_to?r.date=l.date_from:(r.date_from=l.date_from,r.date_to=l.date_to):(l.date_from&&(r.date_from=l.date_from),l.date_to&&(r.date_to=l.date_to)));const c=await _.get(C.issue_slips.items,{params:r}),n=c.data?.data?.slips||c.data?.slips||[],x=c.data?.pagination;R(n),x?.last_page!==void 0&&d(x.last_page)}catch(r){console.error("Failed to fetch issue slips",r)}};b.useEffect(()=>{g(w)},[a,h,f,D]);const q=async l=>{P(l),await g(l)},F=async l=>{try{if(!l)throw new Error("No slip data provided");const r=u.loading("Preparing issue slip for download..."),c=await _.get(C.issue_slips.details(Number(l.id))),n=c.data.slip||c.data.data||c.data,x={id:n.id?.toString()||l.id,mr:n.mr||l.mr||"-",machine:typeof n.machine=="object"&&n.machine?.name?n.machine.name:n.machine||l.machine||"-",for_party:n.for_party||l.for_party||"-",for_mines:n.for_mines||l.for_mines||"-",purpose:n.purpose||l.purpose||"-",issued_to:n.issued_for||l.issued_to||"-",created_at:n.created_at||l.created_at||"",items:(n.items||[]).map(m=>({item_id:m.item_id?.toString()||"",item_name:m.item?.item_name||m.item_name||"-",item_code:m.item?.item_code||m.item_code||"-",item_unit:m.item?.unit?.unit_name||m.item_unit||"-",required_qty:m.required_qty?.toString()||"0",issued_qty:m.issued_qty?.toString()||"0"}))},T=await Y(t.jsx(X,{data:x})).toBlob();if(!T)throw new Error("Failed to generate PDF blob");const S=URL.createObjectURL(T),p=document.createElement("a");p.href=S,p.download=`issue-slip-${l.id||"unknown"}.pdf`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(S),u.dismiss(r),u.success("Issue slip downloaded successfully")}catch(r){console.error("Failed to download issue slip:",r),u.error(`Failed to download issue slip: ${r.message||"Unknown error"}`)}},B=async l=>{try{await _.delete(C.issue_slips.delete(l)),u.success("Issue slip deleted successfully"),g()}catch(r){console.error("Failed to delete issue slip",r),u.error("Failed to delete issue slip")}};return t.jsxs("div",{className:"space-y-6",children:[t.jsx(Z,{fields:E,onFilter:q,defaultValues:w}),t.jsxs(U,{title:"Issue Slip List",createOnClick:()=>y(I.ISSUE_SLIP.CREATE),children:[t.jsxs(W,{children:[t.jsx(k,{cols:[{title:"Date"},{title:"Issued to MR"},{title:"Purpose"},{title:"Actions"}]}),t.jsx("tbody",{children:N.map((l,r)=>t.jsxs(V,{children:[t.jsx(j,{className:"px-5",children:a*h+r+1}),t.jsx(j,{children:A(l.created_at).dmy}),t.jsx(j,{children:l?.mr||"N/A"}),t.jsx(j,{children:l.purpose||"N/A"}),t.jsx(j,{children:t.jsxs($,{children:[t.jsx(G,{url:`${I.ISSUE_SLIP.DETAILS.replace(":id","")}${l.id}`,tooltip:"View Issue Slip Details"}),t.jsx(M,{title:"Download Issue slip",onClick:()=>F(l)}),t.jsx(v,{onClick:()=>B(Number(l.id))})]})})]},l.id))})]}),o()]})]})};export{ye as default};
