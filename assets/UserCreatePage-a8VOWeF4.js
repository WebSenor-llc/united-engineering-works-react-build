import{u as P,i as R,r as i,j as r,B as g,A as x,h as d,e as c,y as m}from"./index-CqGN5vPj.js";import{T as n}from"./TextInput-Bt4fc_YE.js";import{S as u}from"./Select-DnVO7a7r.js";import{F as T}from"./FormHeader-DdZQymmB.js";import{L as B}from"./Loading-BaGxNgjf.js";import{o as I,h as L}from"./yup-DpSgmRLH.js";import{u as M,C as o}from"./index.esm-DANMKX6A.js";import"./BackButton-Doh_VSEt.js";const k={username:"",email:"",password:"",password_confirmation:"",full_name:"",employee_code:"",branch_id:"",role_id:"",is_active:!0},W=()=>{const p=P(),[j]=R(),a=j.get("id"),[b,h]=i.useState(!1),[_,f]=i.useState(!1),[v,y]=i.useState([]),[w,S]=i.useState([]),{control:t,handleSubmit:C,reset:N,formState:{errors:l}}=M({defaultValues:k,resolver:I(L,{context:{isEdit:!!a}})}),U=async()=>{try{const e=await d.get(c.role_management.roles);S(e.data.roles?.data||[])}catch(e){console.error("Failed to fetch roles:",e)}},E=async()=>{try{const e=await d.get(c.branches.branch);y(e.data.branches||[])}catch(e){console.error("Failed to fetch branches:",e)}},A=async()=>{if(a){h(!0);try{const s=(await d.get(c.user_management.details(Number(a)))).data.user;N({full_name:s.full_name||"",email:s.email||"",employee_code:s.employee_code||"",username:s.username||"",branch_id:s.branch_id?String(s.branch_id):"",role_id:s.role_id?String(s.role_id):"",is_active:s.is_active??!0,password:"",password_confirmation:""})}catch(e){console.error("Failed to load user details:",e),m.error("Failed to load user details")}finally{h(!1)}}};i.useEffect(()=>{U(),E(),a&&A()},[a]);const F=async e=>{f(!0);try{const s=a?{full_name:e.full_name,email:e.email,employee_code:e.employee_code,is_active:e.is_active}:e,q=a?c.user_management.update(Number(a)):c.user_management.create;await(a?d.put:d.post)(q,s),m.success(a?"User Updated Successfully":"User Created Successfully"),p(x.USER_MANAGEMENT.LIST)}catch(s){console.error(s),m.error(s.response?.data?.message||"Failed to save user")}finally{f(!1)}};return b?r.jsx("div",{className:"flex justify-center py-20",children:r.jsx(B,{})}):r.jsxs("div",{className:"w-full h-full overflow-auto space-y-8 p-4 pb-20",children:[r.jsx("div",{className:"space-y-1 ml-2",children:r.jsx(T,{title:a?"Edit User":"Create User",subtitle:a?"Update the user details":"Fill out the form to create a new user"})}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mx-2",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[r.jsx(o,{control:t,name:"full_name",render:({field:e})=>r.jsx(n,{required:!0,...e,label:"Full Name",error:l?.full_name?.message})}),r.jsx(o,{control:t,name:"email",render:({field:e})=>r.jsx(n,{required:!0,...e,type:"email",label:"Email",error:l?.email?.message})}),a&&r.jsx(o,{control:t,name:"employee_code",render:({field:e})=>r.jsx(n,{required:!0,...e,value:e.value??"",color:"white",label:"Employee Code",error:l?.employee_code?.message,disabled:!0})}),r.jsx(o,{control:t,name:"username",render:({field:e})=>r.jsx(n,{required:!0,...e,label:"Username",error:l?.username?.message,disabled:!!a})}),!a&&r.jsx(o,{control:t,name:"password",render:({field:e})=>r.jsx(n,{required:!0,...e,type:"password",label:"Password",error:l?.password?.message})}),!a&&r.jsx(o,{control:t,name:"password_confirmation",render:({field:e})=>r.jsx(n,{required:!0,...e,type:"password",label:"Confirm Password",error:l?.password_confirmation?.message})}),r.jsx(o,{control:t,name:"role_id",render:({field:e})=>r.jsxs(u,{...e,label:"Role",required:!0,disabled:!!a,error:l?.role_id?.message,children:[r.jsx("option",{value:"",children:"Select Role"}),w.map(s=>r.jsx("option",{value:s.id,children:s.role_name},s.id))]})}),r.jsx(o,{control:t,name:"branch_id",render:({field:e})=>r.jsxs(u,{...e,label:"Branch",required:!0,disabled:!!a,error:l?.branch_id?.message,children:[r.jsx("option",{value:"",children:"Select Branch"}),v.map(s=>r.jsx("option",{value:s.id,children:s.branch_name},s.id))]})}),r.jsx(o,{control:t,name:"is_active",render:({field:e})=>r.jsxs(u,{...e,label:"Is Active",required:!0,value:e.value?"true":"false",onChange:s=>e.onChange(s.target.value==="true"),children:[r.jsx("option",{value:"true",children:"Active"}),r.jsx("option",{value:"false",children:"Inactive"})]})})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[r.jsx(g,{onClick:()=>p(x.USER_MANAGEMENT.LIST),variant:"outline",children:"Cancel"}),r.jsx(g,{onClick:C(F),loading:_,disabled:_,className:"bg-red-600 text-white",children:a?"Update User":"Create User"})]})]})]})};export{W as default};
