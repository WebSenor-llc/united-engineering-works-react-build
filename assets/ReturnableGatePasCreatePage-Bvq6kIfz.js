import{r as o,j as e,h as v,e as w,u as B,i as F,a as U,B as E,A as I,y as N}from"./index-CbNhh14T.js";import{T as x}from"./TextInput-B3FUDRfG.js";import{L as O}from"./ListWrapper-CtE9blfZ.js";import{T as H,a as V}from"./TableDelete-BtQ4bCNH.js";import{C as n,u as W,b as J}from"./index.esm-CzaEKZ5d.js";import{S as Q}from"./Select-DdY8wYe_.js";import{T as z,a as K,b as g}from"./TableWrapper-tM3Cun3B.js";import{o as M,n as X}from"./yup-3BgDdNf1.js";import{u as Y}from"./useItemsStore-rfcQJPL5.js";import{F as Z}from"./FormHeader-Ck__6gFL.js";import{L as D}from"./Loading-DBMuoTO4.js";import{u as ee}from"./usePartyStore-8wvpsiGV.js";const se=({control:h,name:P,required:l=!1,error:A,disabled:u=!1,onChange:b})=>{const[j,S]=o.useState([]),[y,_]=o.useState(!1);return o.useEffect(()=>{(async()=>{_(!0);try{const t=await v.get(w.item_master.all),f=t.data?.items||t.data?.data||t.data||[];S(f)}catch(t){console.error("Failed to fetch items",t)}finally{_(!1)}})()},[]),e.jsx(n,{name:P,control:h,render:({field:p})=>e.jsxs(Q,{...p,required:l,error:A,disabled:u||y,onChange:t=>{const f=Number(t.target.value);p.onChange(f),b&&b(f)},value:p.value||"",children:[e.jsx("option",{value:"",children:y?"Loading...":"Select Item"}),j.map(t=>e.jsxs("option",{value:t.id,children:[t.item_name," (",t.item_code,")"]},t.id))]})})},k={branch_name:"",branch_address:"",party_name:"",party_address:"",employee_name:"",employee_address:"",purpose:"",vehicle_number:"",driver:"",items:[{item_id:0,item_name:"",item_code:"",item_unit:"",item_description:"",quantity_out:0}]},xe=()=>{const h=B(),[P]=F(),l=P.get("editId"),{selectedBranchId:A,user:u}=U(),{parties:b,fetchParties:j}=ee(),[S,y]=o.useState(!1),[_,p]=o.useState(!1);console.log("parties",b);const{control:t,handleSubmit:f,setValue:i,reset:T,formState:{errors:c}}=W({resolver:M(X),defaultValues:k}),{fields:R,append:G,remove:L}=J({control:t,name:"items"}),{items:$,fetchItems:C}=Y();o.useEffect(()=>{C(),j()},[C,j]),o.useEffect(()=>{u?.branch&&(i("branch_name",u.branch.branch_name||""),i("branch_address",u.branch.address||""))},[u,i]),o.useEffect(()=>{if(!l)return;(async()=>{y(!0);try{const r=await v.get(w.returnable_gate_pass.details(parseInt(l,10))),s=r.data?.gate_pass||r.data?.data||r.data,d=s.items?.map(m=>({item_id:m.item_id||0,item_name:m.item?.item_name||"",item_code:m.item?.item_code||"",item_unit:m.item?.unit?.unit_name||"",item_description:m.item_description||"",quantity_out:m.quantity_out||0}))||k.items;T({branch_name:s.branch_id?.toString()||"",branch_address:s.branch?.address||"",party_name:s.party_name||"",party_address:s.party_contact||"",employee_name:s.emp_name||"",employee_address:s.emp_address||"",purpose:s.purpose||"",vehicle_number:s.vehicle_number||"",driver:s.driver_name||"",items:d})}catch(r){console.error(r),N.error("Failed to load gate pass details"),h(I.RETURNABLE_GATEPAS.LIST)}finally{y(!1)}})()},[l,T,h]);const q=async a=>{const r={branch_id:A,purpose:a.purpose,party_name:a.party_name,emp_name:a.employee_name,emp_address:a.employee_address,vehicle_number:a.vehicle_number,driver_name:a.driver,items:a.items.map(s=>({item_id:s.item_id,quantity_out:Number(s.quantity_out),item_description:s.item_description}))};try{p(!0),l?(await v.put(w.returnable_gate_pass.update(parseInt(l,10)),r),N.success("Returnable Gate Pass updated successfully!")):(await v.post(w.returnable_gate_pass.create,r),N.success("Returnable Gate Pass created successfully!")),h(I.RETURNABLE_GATEPAS.LIST)}catch(s){console.error("Error submitting:",s),N.error(s.response?.data?.message||`Failed to ${l?"update":"create"} returnable gate pass`)}finally{p(!1)}};return S?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(D,{})}):e.jsxs("div",{className:"w-full h-full overflow-auto space-y-6 md:space-y-8 p-2 md:p-4 pb-20",children:[e.jsx("div",{className:"space-y-1 px-2 md:px-0 md:ml-2",children:e.jsx(Z,{title:l?"Edit Returnable Gate Pass":"Create Returnable Gate Pass",subtitle:l?"Update the Returnable Gate Pass details":"Fill out the form to submit a new Returnable Gate Pass."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-5 px-2 md:px-0 md:ml-2 md:mr-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Party Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"party_name",control:t,render:({field:a})=>e.jsxs("select",{...a,value:a.value||"",className:"w-full h-[44px] border border-gray-300 rounded-lg text-sm px-4 py-2 mt-1 focus:outline-none  focus:border-blue-500 focus:ring-2 focus:ring-blue-500 bg-white",onChange:r=>{const s=r.target.value;a.onChange(s);const d=b.find(m=>m.company_name===s);d?i("party_address",d.address||""):i("party_address","")},children:[e.jsx("option",{value:"",children:"Select party for gate pass"}),b.map(r=>e.jsx("option",{value:r.company_name,children:r.company_name},r.id))]})}),c.party_name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.party_name.message})]}),e.jsx(n,{name:"party_address",control:t,render:({field:a})=>e.jsx(x,{...a,label:"Party Address",placeholder:"Auto-filled from selected party",error:c.party_address?.message,readOnly:!0})}),e.jsxs("div",{className:"w-full",children:[e.jsxs("label",{className:"block text-sm text-gray-700 font-medium mb-1",children:["Branch ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"w-full h-[42px] rounded-lg border border-gray-300 px-3 bg-gray-50 text-gray-900 text-sm flex items-center",children:u?.branch?.branch_name||"N/A"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Branch Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"branch_address",control:t,render:({field:a})=>e.jsx(x,{...a,placeholder:"Enter branch address",error:c.branch_address?.message})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Employee Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"employee_name",control:t,render:({field:a})=>e.jsx(x,{...a,placeholder:"Enter employee name",error:c.employee_name?.message})})]}),e.jsx(n,{name:"employee_address",control:t,render:({field:a})=>e.jsx(x,{...a,label:"Employee Address",placeholder:"Enter employee address",error:c.employee_address?.message})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Purpose ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"purpose",control:t,render:({field:a})=>e.jsx(x,{...a,placeholder:"Enter purpose of gate pass",error:c.purpose?.message})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Vehicle Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"vehicle_number",control:t,render:({field:a})=>e.jsx(x,{...a,placeholder:"e.g., RJ14AB1234",error:c.vehicle_number?.message})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Driver Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"driver",control:t,render:({field:a})=>e.jsx(x,{...a,placeholder:"Enter driver name",error:c.driver?.message})})]})]}),e.jsx("div",{className:"px-2 md:px-0",children:e.jsxs(O,{title:"Items Requested",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(E,{className:"bg-red-600 text-white px-3 py-1 text-sm",onClick:()=>G({item_id:0,item_name:"",item_code:"",item_unit:"",item_description:"",quantity_out:0}),children:"+ Add Item"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(z,{children:[e.jsx(K,{cols:[{title:"Item Name"},{title:"Item Code"},{title:"Item Unit"},{title:"Out Qty"},{title:"Remarks"},{title:"Action"}]}),e.jsx("tbody",{children:R.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8 text-gray-500",children:'No items added. Click "Add Item" to get started.'})}):R.map((a,r)=>e.jsxs("tr",{className:"align-middle",children:[e.jsx(g,{className:"text-center w-12",children:r+1}),e.jsx(g,{className:"min-w-[120px]",children:e.jsx(se,{control:t,name:`items.${r}.item_id`,onChange:s=>{const d=$.find(m=>m.id===s);d&&(i(`items.${r}.item_id`,d.id),i(`items.${r}.item_code`,d.item_code),i(`items.${r}.item_name`,d.item_name),i(`items.${r}.item_unit`,d.unit?.unit_name||""))}})}),e.jsx(g,{className:"min-w-[120px]",children:e.jsx(n,{name:`items.${r}.item_code`,control:t,render:({field:s})=>e.jsx("input",{...s,className:"w-full h-10 border focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none  rounded-lg px-3 text-sm bg-gray-50",placeholder:"Auto-filled",readOnly:!0})})}),e.jsx(g,{className:"min-w-[100px]",children:e.jsx(n,{name:`items.${r}.item_unit`,control:t,render:({field:s})=>e.jsx("input",{...s,className:"w-full h-10 border focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none  rounded-lg px-3 text-sm bg-gray-50",placeholder:"Auto-filled",readOnly:!0})})}),e.jsx(g,{className:"min-w-[120px]",children:e.jsx(n,{name:`items.${r}.quantity_out`,control:t,render:({field:s})=>e.jsx("input",{...s,type:"number",min:"0",step:"0.01",className:"w-full h-10 border focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none  rounded-lg px-3 text-sm bg-gray-50",placeholder:"Enter qty"})})}),e.jsx(g,{className:"min-w-[150px]",children:e.jsx(n,{name:`items.${r}.item_description`,control:t,render:({field:s})=>e.jsx("input",{...s,className:"w-full h-10 border focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none  rounded-lg px-3 text-sm bg-gray-50",placeholder:"Add remarks"})})}),e.jsx(H,{children:e.jsx(V,{onClick:()=>L(r)})})]},a.id))})]})})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 px-2 md:px-0 md:mr-4",children:[e.jsx(E,{variant:"outline",className:"w-full sm:w-auto",onClick:()=>h(I.RETURNABLE_GATEPAS.LIST),disabled:_,children:"Cancel"}),e.jsx(E,{className:"bg-red-600 text-white w-full sm:w-auto",onClick:f(q),loading:_,disabled:_,children:l?"Update Gate Pass":"Submit Gate Pass"})]})]})};export{xe as default};
