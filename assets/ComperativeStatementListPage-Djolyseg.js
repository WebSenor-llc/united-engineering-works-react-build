import{u as E,r as m,a as P,j as t,A as F,h,e as _,y as j}from"./index-CHv2um3-.js";import{L as D}from"./ListWrapper-uuw8VAoB.js";import{T as V,a as L,b as s}from"./TableWrapper-BsErbKM7.js";import{T as R}from"./TableRow-sHM44jzA.js";import{u as k}from"./usePagination-BO2EGb_0.js";import{T as M}from"./TableActions-FoDa3IvB.js";import{T as $}from"./TableView-CprmXlIL.js";import{T as B}from"./TableDelete-B3qkP8R2.js";import{C as H}from"./CommonFilter-clCwQ7l9.js";import"./index.esm-BXq0dTbn.js";import"./TextInput-DLaHSu5O.js";const Y=()=>{const{page:i,rowsPerPage:l,setTotal:b,renderPagination:f}=k(),y=E(),[d,g]=m.useState([]),{user:v,selectedBranchId:p}=P(),[x,N]=m.useState({}),T=[{name:"statement_number",label:"Statement Number",placeholder:"Enter Statement Number"},{name:"mr_number",label:"MR Number",placeholder:"Enter MR Number"},{name:"date_from",label:"Date From",type:"date"},{name:"date_to",label:"Date To",type:"date"}],S=e=>{if(!e)return{ymd:"",dmy:""};const[a]=e.split("T"),[r,n,o]=a.split("-");return{ymd:a,dmy:`${o}-${n}-${r}`}},[A,u]=m.useState(!0),c=async e=>{u(!0);try{const a={page:i+1,rowsPerPage:l,branch_id:p};e&&(e.statement_number&&(a.statement_number=e.statement_number),e.mr_number&&(a.mr_number=e.mr_number),e.date_from&&e.date_to?e.date_from===e.date_to?a.date=e.date_from:(a.date_from=e.date_from,a.date_to=e.date_to):(e.date_from&&(a.date_from=e.date_from),e.date_to&&(a.date_to=e.date_to)));const r=await h.get(_.comparative_statement.items,{params:a}),n=r.data?.statements||[],o=r.data.pagination;o?.total!==void 0&&b(o.total),g(Array.isArray(n)?n:[])}catch(a){console.error("Failed to fetch comparative statements",a)}finally{u(!1)}};m.useEffect(()=>{c(x)},[i,l,p,v]);const w=async e=>{N(e),await c(e)},C=async e=>{try{await h.delete(_.comparative_statement.delete(e)),j.success("Comparative statement deleted successfully"),c()}catch(a){console.error("Failed to delete comparative statement",a),j.error("Failed to delete comparative statement")}};return t.jsxs("div",{className:"space-y-6",children:[t.jsx(H,{fields:T,onFilter:w,defaultValues:x}),t.jsxs(D,{title:"Comparative Statements",createOnClick:()=>y(F.COMPERATIVE_STATEMENT.CREATE),children:[t.jsxs(V,{children:[t.jsx(L,{cols:[{title:"Date"},{title:"Comparative Statement"},{title:"Material Requisition"},{title:"Actions"}]}),t.jsx("tbody",{children:A?t.jsx("tr",{children:t.jsx("td",{colSpan:5,className:"text-center p-4",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),t.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Loading comparative statements..."})]})})}):d.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:5,className:"text-center py-8",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No comparative statements"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new comparative statement."})]})})}):d.map((e,a)=>t.jsxs(R,{children:[t.jsx(s,{className:"px-5",children:i*l+a+1}),t.jsx(s,{children:t.jsx("span",{className:"text-sm text-gray-900",children:S(e.created_at).dmy})}),t.jsx(s,{children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.statement_number||"â€”"})}),t.jsx(s,{children:t.jsx("span",{className:"text-sm text-gray-900",children:e.material_requisition?.mr_number||"N/A"})}),t.jsx(s,{children:t.jsxs(M,{children:[t.jsx($,{url:`/comperative-statement/${e.id}`,tooltip:"View Details"}),t.jsx(B,{onClick:()=>C(e.id)})]})})]},e.id))})]}),f()]})]})};export{Y as default};
