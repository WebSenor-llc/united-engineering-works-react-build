import{j as t,u as A,r as _,a as q,A as f,h as C,e as b,y}from"./index-DwoM2qi7.js";import{L as B}from"./ListWrapper-mZr8QSqo.js";import{T as L,a as z,b as j}from"./TableWrapper-DLZJWVQL.js";import{T as U}from"./TableRow-BkphMLHV.js";import{u as W}from"./usePagination-DH6j26d8.js";import{T as k}from"./TableActions-D7fIJDeW.js";import{T as F}from"./TableEdit-g6OANowM.js";import{T as $}from"./TableDelete-DctBftCp.js";import{D as H,P as V,S as G,V as l,I as O,T as s,a as v,p as M}from"./react-pdf.browser-DIv_jgUn.js";import{T as K}from"./TableView-DD483SlN.js";const Q=({data:d})=>{if(!d)return console.error("IssueSlipPdf: No data provided"),null;const x=Array.isArray(d.items)?d.items:[],a=r=>typeof r=="string"?r:typeof r=="object"&&r!==null?r.name?r.name:r.machine_name?r.machine_name:JSON.stringify(r):r?String(r):"-";return t.jsx(H,{children:t.jsxs(V,{size:"A4",style:e.page,children:[t.jsxs(l,{style:e.headerContainer,children:[t.jsx(l,{style:e.logoSection,children:t.jsx(O,{src:"/assets/images/logo.png",style:e.logo})}),t.jsxs(l,{style:e.companyInfo,children:[t.jsx(s,{style:e.companyName,children:"UNITED ENGINEERING WORKS"}),t.jsx(s,{style:e.companyAddress,children:"N.H. 8, Nehla Village, By Pass Road, Near Govardhan Vilas, Udaipur- 313001 (Raj.) INDIA"}),t.jsx(s,{style:e.companyContact,children:"Phone: +91-9829232445 +91-9829657145 | GSTIN: 08ABQPK8948J3ZP | Email: info@unitedengineeringworks.com"})]})]}),t.jsx(s,{style:e.title,children:"ISSUE SLIP"}),t.jsxs(l,{style:e.infoContainer,children:[t.jsxs(l,{style:e.detailRow,children:[t.jsx(s,{style:e.label,children:"MR:"}),t.jsx(s,{style:e.value,children:a(d.mr)})]}),t.jsxs(l,{style:e.detailRow,children:[t.jsx(s,{style:e.label,children:"Machine:"}),t.jsx(s,{style:e.value,children:a(d.machine)})]}),t.jsxs(l,{style:e.detailRow,children:[t.jsx(s,{style:e.label,children:"For Party:"}),t.jsx(s,{style:e.value,children:a(d.for_party)})]}),t.jsxs(l,{style:e.detailRow,children:[t.jsx(s,{style:e.label,children:"For Mines:"}),t.jsx(s,{style:e.value,children:a(d.for_mines)})]}),t.jsxs(l,{style:e.detailRow,children:[t.jsx(s,{style:e.label,children:"Purpose:"}),t.jsx(s,{style:e.value,children:a(d.purpose)})]})]}),t.jsxs(l,{style:e.tableContainer,children:[t.jsxs(l,{style:e.tableHeaderRow,children:[t.jsx(l,{style:[e.tableCell,e.snoCol],children:t.jsx(s,{style:e.headerText,children:"S.No"})}),t.jsx(l,{style:[e.tableCell,e.itemNameCol],children:t.jsx(s,{style:e.headerText,children:"Item Name"})}),t.jsx(l,{style:[e.tableCell,e.itemCodeCol],children:t.jsx(s,{style:e.headerText,children:"Item Code"})}),t.jsx(l,{style:[e.tableCell,e.unitCol],children:t.jsx(s,{style:e.headerText,children:"Unit"})}),t.jsx(l,{style:[e.tableCell,e.qtyCol],children:t.jsx(s,{style:e.headerText,children:"Required QTY"})}),t.jsx(l,{style:[e.tableCell,e.qtyCol],children:t.jsx(s,{style:e.headerText,children:"Issued QTY"})})]}),x.length>0?x.map((r,m)=>t.jsxs(l,{style:e.tableRow,children:[t.jsx(l,{style:[e.tableCell,e.snoCol],children:t.jsx(s,{style:e.cellText,children:m+1})}),t.jsx(l,{style:[e.tableCell,e.itemNameCol],children:t.jsx(s,{style:e.cellText,children:a(r?.item_name)})}),t.jsx(l,{style:[e.tableCell,e.itemCodeCol],children:t.jsx(s,{style:e.cellText,children:a(r?.item_code)})}),t.jsx(l,{style:[e.tableCell,e.unitCol],children:t.jsx(s,{style:e.cellText,children:a(r?.item_unit)})}),t.jsx(l,{style:[e.tableCell,e.qtyCol],children:t.jsx(s,{style:e.cellText,children:a(r?.required_qty)||"0"})}),t.jsx(l,{style:[e.tableCell,e.qtyCol],children:t.jsx(s,{style:e.cellText,children:a(r?.issued_qty)||"0"})})]},m)):Array.from({length:3}).map((r,m)=>t.jsxs(l,{style:e.tableRow,children:[t.jsx(l,{style:[e.tableCell,e.snoCol],children:t.jsx(s,{style:e.cellText,children:"-"})}),t.jsx(l,{style:[e.tableCell,e.itemNameCol],children:t.jsx(s,{style:e.cellText,children:"-"})}),t.jsx(l,{style:[e.tableCell,e.itemCodeCol],children:t.jsx(s,{style:e.cellText,children:"-"})}),t.jsx(l,{style:[e.tableCell,e.unitCol],children:t.jsx(s,{style:e.cellText,children:"-"})}),t.jsx(l,{style:[e.tableCell,e.qtyCol],children:t.jsx(s,{style:e.cellText,children:"-"})}),t.jsx(l,{style:[e.tableCell,e.qtyCol],children:t.jsx(s,{style:e.cellText,children:"-"})})]},m))]}),t.jsx(l,{style:e.signatureContainer,children:t.jsxs(l,{style:e.signatureBox,children:[t.jsx(s,{style:e.signatureTitle,children:"For: UNITED ENGINEERING WORKS"}),t.jsx(l,{style:e.signatureLine}),t.jsx(s,{style:e.signatureText,children:"Authorized Signatory"})]})})]})})},e=G.create({page:{padding:20,fontSize:10,fontFamily:"Helvetica",lineHeight:1.3},headerContainer:{flexDirection:"row",alignItems:"center",marginBottom:15,gap:15,borderBottomWidth:2,borderBottomColor:"#000",paddingBottom:8},logoSection:{width:"20%"},logo:{width:90,height:50},companyInfo:{width:"80%",paddingLeft:10},companyName:{fontSize:14,fontWeight:"bold"},companyAddress:{fontSize:9},companyContact:{fontSize:9},title:{fontSize:16,textAlign:"center",marginVertical:10,fontWeight:"bold",textDecoration:"underline"},infoContainer:{marginBottom:15},detailRow:{flexDirection:"row",marginBottom:3},label:{width:"25%",fontSize:9,fontWeight:"bold"},value:{width:"75%",fontSize:9},tableContainer:{borderWidth:.25,borderColor:"#000",marginBottom:20},tableHeaderRow:{flexDirection:"row",backgroundColor:"#e0e0e0"},tableRow:{flexDirection:"row"},tableCell:{borderWidth:.25,borderColor:"#000",padding:2,justifyContent:"center",alignItems:"center"},headerText:{fontSize:9,fontWeight:"bold",textAlign:"center"},cellText:{fontSize:8,textAlign:"center"},snoCol:{width:"8%"},itemNameCol:{width:"30%"},itemCodeCol:{width:"20%"},unitCol:{width:"12%"},qtyCol:{width:"15%"},signatureContainer:{marginTop:40,alignItems:"flex-end"},signatureBox:{width:200,alignItems:"center"},signatureTitle:{fontSize:10,fontWeight:"bold",marginBottom:25},signatureLine:{width:150,height:1,backgroundColor:"#000",marginBottom:5},signatureText:{fontSize:9}}),ne=()=>{const{page:d,rowsPerPage:x,setTotal:a,renderPagination:r}=W(),m=A(),[I,N]=_.useState([]),{user:R,selectedBranchId:p}=q(),P=i=>{if(!i)return{ymd:"",dmy:""};const[o]=i.split("T"),[h,n,g]=o.split("-");return{ymd:o,dmy:`${g}-${n}-${h}`}},T=async()=>{try{const i=await C.get(b.issue_slips.items,{params:{page:d+1,rowsPerPage:x,...p&&{branch_id:p}}}),o=i.data?.data?.slips||i.data?.slips||[],h=i.data?.pagination;N(o),h?.total!==void 0&&a(h.total)}catch(i){console.error("Failed to fetch issue slips",i)}};_.useEffect(()=>{T()},[d,x,p,R]);const E=async i=>{try{if(!i)throw new Error("No slip data provided");const o=y.loading("Preparing issue slip for download..."),h=await C.get(b.issue_slips.details(Number(i.id))),n=h.data.slip||h.data.data||h.data,g={id:n.id?.toString()||i.id,mr:n.mr||i.mr||"-",machine:typeof n.machine=="object"&&n.machine?.name?n.machine.name:n.machine||i.machine||"-",for_party:n.for_party||i.for_party||"-",for_mines:n.for_mines||i.for_mines||"-",purpose:n.purpose||i.purpose||"-",issued_to:n.issued_for||i.issued_to||"-",created_at:n.created_at||i.created_at||"",items:(n.items||[]).map(c=>({item_id:c.item_id?.toString()||"",item_name:c.item?.item_name||c.item_name||"-",item_code:c.item?.item_code||c.item_code||"-",item_unit:c.item?.unit?.unit_name||c.item_unit||"-",required_qty:c.required_qty?.toString()||"0",issued_qty:c.issued_qty?.toString()||"0"}))},w=await M(t.jsx(Q,{data:g})).toBlob();if(!w)throw new Error("Failed to generate PDF blob");const S=URL.createObjectURL(w),u=document.createElement("a");u.href=S,u.download=`issue-slip-${i.id||"unknown"}.pdf`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(S),y.dismiss(o),y.success("Issue slip downloaded successfully")}catch(o){console.error("Failed to download issue slip:",o),y.error(`Failed to download issue slip: ${o.message||"Unknown error"}`)}},D=async i=>{try{await C.delete(b.issue_slips.delete(i)),y.success("Issue slip deleted successfully"),T()}catch(o){console.error("Failed to delete issue slip",o),y.error("Failed to delete issue slip")}};return t.jsxs(B,{title:"Issue Slip List",createOnClick:()=>m(f.ISSUE_SLIP.CREATE),children:[t.jsxs(L,{children:[t.jsx(z,{cols:[{title:"Date"},{title:"Issued to MR"},{title:"Purpose"},{title:"Actions"}]}),t.jsx("tbody",{children:I.map((i,o)=>t.jsxs(U,{children:[t.jsx(j,{className:"px-5",children:o+1}),t.jsx(j,{children:P(i.created_at).dmy}),t.jsx(j,{children:i?.mr||"N/A"}),t.jsx(j,{children:i.purpose||"N/A"}),t.jsx(j,{children:t.jsxs(k,{children:[t.jsx(K,{url:`${f.ISSUE_SLIP.DETAILS.replace(":id","")}${i.id}`,tooltip:"View Issue Slip Details"}),t.jsx(v,{title:"Download Issue slip",onClick:()=>E(i)}),t.jsx(F,{onClick:()=>m(`${f.ISSUE_SLIP.CREATE}?editId=${i.id}`)}),t.jsx($,{onClick:()=>D(Number(i.id))})]})})]},i.id))})]}),r()]})};export{ne as default};
