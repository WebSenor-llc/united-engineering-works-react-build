import{u as T,i as O,a as U,r as o,j as e,B as x,h as m,e as u,y as h,A}from"./index-CyRDNjis.js";import{F as R}from"./FormHeader-BOf-iER0.js";import{T as l}from"./TextInput-DXETAqIv.js";import{S as B}from"./Select-DOk7PkI7.js";import{u as D,C as j}from"./index.esm-w4ySVjAd.js";import{u as H}from"./useItemsStore-BK39TivQ.js";import{L as V}from"./Loading-BBJJw7ob.js";import"./BackButton-Brb_nHm3.js";const G={item_id:"",item_name:"",item_code:"",item_unit:"",quantity:"",branch_id:""},Z=()=>{const p=T(),[I]=O(),a=I.get("editId"),{selectedBranchId:n}=U(),{items:g,fetchItems:_}=H(),{control:f,handleSubmit:k,setValue:d,reset:v,watch:c,formState:{errors:N}}=D({defaultValues:G}),[C,y]=o.useState(!1),[S,b]=o.useState(!1),L=c("item_code"),w=c("item_name"),E=c("item_unit");o.useEffect(()=>{_()},[_]);const q=async()=>{if(a){y(!0);try{const t=(await m.get(u.stock_ledger.details(Number(a)))).data?.entry;t&&v({item_id:t.item_id||"",item_name:t.item?.item_name||"",item_code:t.item?.item_code||"",item_unit:t.item?.unit?.unit_name||"",quantity:t.quantity_in||"",branch_id:t.branch_id?String(t.branch_id):n?String(n):""})}catch(s){console.error("Failed to load details:",s),h.error("Failed to load stock ledger details")}finally{y(!1)}}};o.useEffect(()=>{a&&q()},[a,n]);const F=async s=>{b(!0);const t={item_id:Number(s.item_id),branch_id:n,quantity:Number(s.quantity)};try{let r,i;a?(r=u.stock_ledger.update(Number(a)),i=m.put):(r=u.stock_ledger.create,i=m.post),await i(r,t),h.success(a?"Stock ledger updated successfully":"Stock ledger created successfully"),p(A.STOCK_LEDGER_REPORT.LIST)}catch(r){console.error(r),h.error(r.response?.data?.message||"Failed to save stock ledger")}finally{b(!1)}};return C?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(V,{})}):e.jsxs("div",{className:"w-full h-full overflow-auto space-y-8 p-4 pb-20",children:[e.jsx("div",{className:"space-y-1 ml-2",children:e.jsx(R,{title:a?"Edit Stock Ledger":"Create Stock Ledger",subtitle:a?"Update the Stock Ledger details":"Fill out the form to submit a new Stock Ledger entry"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-5 ml-2 mr-5",children:[e.jsx(j,{name:"item_id",control:f,render:({field:s})=>e.jsxs(B,{...s,label:"Select Item",onChange:t=>{const r=Number(t.target.value);s.onChange(r);const i=g.find(P=>P.id===r);i&&(d("item_name",i.item_name),d("item_code",i.item_code),d("item_unit",i.unit?.unit_name||""))},children:[e.jsx("option",{value:"",children:"Select Item"}),g.map(t=>e.jsxs("option",{value:t.id,children:[t.item_name," (",t.item_code,")"]},t.id))]})}),e.jsx(l,{label:"Item Code",placeholder:"Item Code",readOnly:!0,value:L}),e.jsx(l,{label:"Item Name",placeholder:"Item Name",readOnly:!0,value:w}),e.jsx(l,{label:"Item Unit",placeholder:"Item Unit",readOnly:!0,value:E}),e.jsx(j,{name:"quantity",control:f,render:({field:s})=>e.jsx(l,{...s,type:"number",label:"Quantity",placeholder:"Enter quantity",error:N.quantity?.message})})]}),e.jsxs("div",{className:"flex justify-end gap-3 mr-5",children:[e.jsx(x,{variant:"outline",onClick:()=>p(-1),children:"Cancel"}),e.jsx(x,{className:"bg-red-600 text-white",onClick:k(F),loading:S,disabled:S,children:a?"Update Stock Ledger":"Submit Stock Ledger"})]})]})};export{Z as default};
