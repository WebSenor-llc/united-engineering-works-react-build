import{j as t,u as L,r as b,a as z,A as I,h as C,e as _,y as u}from"./index-BrwORqfZ.js";import{L as U}from"./ListWrapper-BaH-EqLI.js";import{T as W,a as k,b as p}from"./TableWrapper-6sipL8t3.js";import{T as V}from"./TableRow-rusg7Z8k.js";import{u as H}from"./usePagination-B-ndTwCk.js";import{T as $}from"./TableActions-CxOZpC0K.js";import{T as v}from"./TableDelete-BqsgYPpv.js";import{D as G,P as M,S as O,V as s,I as K,T as i,a as Q,p as J}from"./react-pdf.browser-DEu51aZe.js";import{T as Y}from"./TableView-DJfSE88p.js";import{C as Z}from"./CommonFilter-cd2KA1z9.js";import"./index.esm-DAnzzIlF.js";import"./TextInput-BNvsxhCk.js";const X=({data:a})=>{if(!a)return console.error("IssueSlipPdf: No data provided"),null;const h=Array.isArray(a.items)?a.items:[],d=r=>typeof r=="string"?r:typeof r=="object"&&r!==null?r.name?r.name:r.machine_name?r.machine_name:JSON.stringify(r):r?String(r):"-";return t.jsx(G,{children:t.jsxs(M,{size:"A4",style:e.page,children:[t.jsxs(s,{style:e.headerContainer,children:[t.jsx(s,{style:e.logoSection,children:t.jsx(K,{src:"/assets/images/logo.png",style:e.logo})}),t.jsxs(s,{style:e.companyInfo,children:[t.jsx(i,{style:e.companyName,children:"UNITED ENGINEERING WORKS"}),t.jsx(i,{style:e.companyAddress,children:"N.H. 8, Nehla Village, By Pass Road, Near Govardhan Vilas, Udaipur- 313001 (Raj.) INDIA"}),t.jsx(i,{style:e.companyContact,children:"Phone: +91-9829232445 +91-9829657145 | GSTIN: 08ABQPK8948J3ZP | Email: info@unitedengineeringworks.com"})]})]}),t.jsx(i,{style:e.title,children:"ISSUE SLIP"}),t.jsxs(s,{style:e.infoContainer,children:[t.jsxs(s,{style:e.detailRow,children:[t.jsx(i,{style:e.label,children:"MR:"}),t.jsx(i,{style:e.value,children:d(a.mr)})]}),t.jsxs(s,{style:e.detailRow,children:[t.jsx(i,{style:e.label,children:"Machine:"}),t.jsx(i,{style:e.value,children:d(a.machine)})]}),t.jsxs(s,{style:e.detailRow,children:[t.jsx(i,{style:e.label,children:"For Party:"}),t.jsx(i,{style:e.value,children:d(a.for_party)})]}),t.jsxs(s,{style:e.detailRow,children:[t.jsx(i,{style:e.label,children:"For Mines:"}),t.jsx(i,{style:e.value,children:d(a.for_mines)})]}),t.jsxs(s,{style:e.detailRow,children:[t.jsx(i,{style:e.label,children:"Purpose:"}),t.jsx(i,{style:e.value,children:d(a.purpose)})]})]}),t.jsxs(s,{style:e.tableContainer,children:[t.jsxs(s,{style:e.tableHeaderRow,children:[t.jsx(s,{style:[e.tableCell,e.snoCol],children:t.jsx(i,{style:e.headerText,children:"S.No"})}),t.jsx(s,{style:[e.tableCell,e.itemNameCol],children:t.jsx(i,{style:e.headerText,children:"Item Name"})}),t.jsx(s,{style:[e.tableCell,e.itemCodeCol],children:t.jsx(i,{style:e.headerText,children:"Item Code"})}),t.jsx(s,{style:[e.tableCell,e.unitCol],children:t.jsx(i,{style:e.headerText,children:"Unit"})}),t.jsx(s,{style:[e.tableCell,e.qtyCol],children:t.jsx(i,{style:e.headerText,children:"Required QTY"})}),t.jsx(s,{style:[e.tableCell,e.qtyCol],children:t.jsx(i,{style:e.headerText,children:"Issued QTY"})})]}),h.length>0?h.map((r,y)=>t.jsxs(s,{style:e.tableRow,children:[t.jsx(s,{style:[e.tableCell,e.snoCol],children:t.jsx(i,{style:e.cellText,children:y+1})}),t.jsx(s,{style:[e.tableCell,e.itemNameCol],children:t.jsx(i,{style:e.cellText,children:d(r?.item_name)})}),t.jsx(s,{style:[e.tableCell,e.itemCodeCol],children:t.jsx(i,{style:e.cellText,children:d(r?.item_code)})}),t.jsx(s,{style:[e.tableCell,e.unitCol],children:t.jsx(i,{style:e.cellText,children:d(r?.item_unit)})}),t.jsx(s,{style:[e.tableCell,e.qtyCol],children:t.jsx(i,{style:e.cellText,children:d(r?.required_qty)||"0"})}),t.jsx(s,{style:[e.tableCell,e.qtyCol],children:t.jsx(i,{style:e.cellText,children:d(r?.issued_qty)||"0"})})]},y)):Array.from({length:3}).map((r,y)=>t.jsxs(s,{style:e.tableRow,children:[t.jsx(s,{style:[e.tableCell,e.snoCol],children:t.jsx(i,{style:e.cellText,children:"-"})}),t.jsx(s,{style:[e.tableCell,e.itemNameCol],children:t.jsx(i,{style:e.cellText,children:"-"})}),t.jsx(s,{style:[e.tableCell,e.itemCodeCol],children:t.jsx(i,{style:e.cellText,children:"-"})}),t.jsx(s,{style:[e.tableCell,e.unitCol],children:t.jsx(i,{style:e.cellText,children:"-"})}),t.jsx(s,{style:[e.tableCell,e.qtyCol],children:t.jsx(i,{style:e.cellText,children:"-"})}),t.jsx(s,{style:[e.tableCell,e.qtyCol],children:t.jsx(i,{style:e.cellText,children:"-"})})]},y))]}),t.jsx(s,{style:e.signatureContainer,children:t.jsxs(s,{style:e.signatureBox,children:[t.jsx(i,{style:e.signatureTitle,children:"For: UNITED ENGINEERING WORKS"}),t.jsx(s,{style:e.signatureLine}),t.jsx(i,{style:e.signatureText,children:"Authorized Signatory"})]})})]})})},e=O.create({page:{padding:20,fontSize:10,fontFamily:"Helvetica",lineHeight:1.3},headerContainer:{flexDirection:"row",alignItems:"center",marginBottom:15,gap:15,borderBottomWidth:2,borderBottomColor:"#000",paddingBottom:8},logoSection:{width:"20%"},logo:{width:90,height:50},companyInfo:{width:"80%",paddingLeft:10},companyName:{fontSize:14,fontWeight:"bold"},companyAddress:{fontSize:9},companyContact:{fontSize:9},title:{fontSize:16,textAlign:"center",marginVertical:10,fontWeight:"bold",textDecoration:"underline"},infoContainer:{marginBottom:15},detailRow:{flexDirection:"row",marginBottom:3},label:{width:"25%",fontSize:9,fontWeight:"bold"},value:{width:"75%",fontSize:9},tableContainer:{borderWidth:.25,borderColor:"#000",marginBottom:20},tableHeaderRow:{flexDirection:"row",backgroundColor:"#e0e0e0"},tableRow:{flexDirection:"row"},tableCell:{borderWidth:.25,borderColor:"#000",padding:2,justifyContent:"center",alignItems:"center"},headerText:{fontSize:9,fontWeight:"bold",textAlign:"center"},cellText:{fontSize:8,textAlign:"center"},snoCol:{width:"8%"},itemNameCol:{width:"30%"},itemCodeCol:{width:"20%"},unitCol:{width:"12%"},qtyCol:{width:"15%"},signatureContainer:{marginTop:40,alignItems:"flex-end"},signatureBox:{width:200,alignItems:"center"},signatureTitle:{fontSize:10,fontWeight:"bold",marginBottom:25},signatureLine:{width:150,height:1,backgroundColor:"#000",marginBottom:5},signatureText:{fontSize:9}}),he=()=>{const{page:a,rowsPerPage:h,setTotal:d,renderPagination:r}=H(),y=L(),[N,R]=b.useState([]),{user:D,selectedBranchId:f}=z(),[w,P]=b.useState({}),A=[{name:"mr_number",label:"MR Number",placeholder:"Enter MR Number"},{name:"date_from",label:"Date From",type:"date"},{name:"date_to",label:"Date To",type:"date"}],E=l=>{if(!l)return{ymd:"",dmy:""};const[o]=l.split("T"),[c,n,x]=o.split("-");return{ymd:o,dmy:`${x}-${n}-${c}`}},g=async l=>{try{const o={page:a+1,rowsPerPage:h,...f&&{branch_id:f}};l&&(l.mr_number&&(o.mr_number=l.mr_number),l.date_from&&l.date_to?l.date_from===l.date_to?o.date=l.date_from:(o.date_from=l.date_from,o.date_to=l.date_to):(l.date_from&&(o.date_from=l.date_from),l.date_to&&(o.date_to=l.date_to)));const c=await C.get(_.issue_slips.items,{params:o}),n=c.data?.data?.slips||c.data?.slips||[],x=c.data?.pagination;R(n),x?.total!==void 0&&d(x.total)}catch(o){console.error("Failed to fetch issue slips",o)}};b.useEffect(()=>{g(w)},[a,h,f,D]);const q=async l=>{P(l),await g(l)},F=async l=>{try{if(!l)throw new Error("No slip data provided");const o=u.loading("Preparing issue slip for download..."),c=await C.get(_.issue_slips.details(Number(l.id))),n=c.data.slip||c.data.data||c.data,x={id:n.id?.toString()||l.id,mr:n.mr||l.mr||"-",machine:typeof n.machine=="object"&&n.machine?.name?n.machine.name:n.machine||l.machine||"-",for_party:n.for_party||l.for_party||"-",for_mines:n.for_mines||l.for_mines||"-",purpose:n.purpose||l.purpose||"-",issued_to:n.issued_for||l.issued_to||"-",created_at:n.created_at||l.created_at||"",items:(n.items||[]).map(m=>({item_id:m.item_id?.toString()||"",item_name:m.item?.item_name||m.item_name||"-",item_code:m.item?.item_code||m.item_code||"-",item_unit:m.item?.unit?.unit_name||m.item_unit||"-",required_qty:m.required_qty?.toString()||"0",issued_qty:m.issued_qty?.toString()||"0"}))},T=await J(t.jsx(X,{data:x})).toBlob();if(!T)throw new Error("Failed to generate PDF blob");const S=URL.createObjectURL(T),j=document.createElement("a");j.href=S,j.download=`issue-slip-${l.id||"unknown"}.pdf`,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(S),u.dismiss(o),u.success("Issue slip downloaded successfully")}catch(o){console.error("Failed to download issue slip:",o),u.error(`Failed to download issue slip: ${o.message||"Unknown error"}`)}},B=async l=>{try{await C.delete(_.issue_slips.delete(l)),u.success("Issue slip deleted successfully"),g()}catch(o){console.error("Failed to delete issue slip",o),u.error("Failed to delete issue slip")}};return t.jsxs("div",{className:"space-y-6",children:[t.jsx(Z,{fields:A,onFilter:q,defaultValues:w}),t.jsxs(U,{title:"Issue Slip List",createOnClick:()=>y(I.ISSUE_SLIP.CREATE),children:[t.jsxs(W,{children:[t.jsx(k,{cols:[{title:"Date"},{title:"Issued to MR"},{title:"Purpose"},{title:"Actions"}]}),t.jsx("tbody",{children:N.map((l,o)=>t.jsxs(V,{children:[t.jsx(p,{className:"px-5",children:a*h+o+1}),t.jsx(p,{children:E(l.created_at).dmy}),t.jsx(p,{children:l?.mr||"N/A"}),t.jsx(p,{children:l.purpose||"N/A"}),t.jsx(p,{children:t.jsxs($,{children:[t.jsx(Y,{url:`${I.ISSUE_SLIP.DETAILS.replace(":id","")}${l.id}`,tooltip:"View Issue Slip Details"}),t.jsx(Q,{title:"Download Issue slip",onClick:()=>F(l)}),t.jsx(v,{onClick:()=>B(Number(l.id))})]})})]},l.id))})]}),r()]})]})};export{he as default};
