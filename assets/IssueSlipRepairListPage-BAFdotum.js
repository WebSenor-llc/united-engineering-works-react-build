const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-pdf.browser-BNJ8mn34.js","assets/index-XrqdkMlQ.js","assets/index-BuVjEwMM.css","assets/IssueSlipRepairReqPDF-BqBqDk7e.js"])))=>i.map(i=>d[i]);
import{u as b,r as m,j as e,D as w,A as x,_ as P,y as R,e as n,P as N,h}from"./index-XrqdkMlQ.js";import{L as v}from"./ListWrapper-n8s5LAbo.js";import{T as l}from"./TableData-D2335yaW.js";import{T as A,a as L}from"./TableWrapper-BfKmYKz6.js";import{T as F}from"./TableRow-DbFK36gc.js";import{T as U}from"./TableActions-BqxsRnCX.js";import{T as C}from"./TableEdit-sJQZlFPJ.js";import{T as q}from"./TableDelete-RE0NQPTb.js";import{T as k,a as $}from"./TableDownload-CUDJc0ej.js";import{u as O}from"./usePagination-1AUtPZm0.js";const Y=()=>{const{page:c,rowsPerPage:d,setTotal:S,renderPagination:y}=O(),_=b(),[i,D]=m.useState([]),[E,f]=m.useState(!0),T=async s=>{try{const a=await h.get(n.repair_issue_slip.details(s)),r=a.data?.data||a.data;if(r.inhouse_deposit_slip_id)try{const t=await h.get(n.repair_requisition.details(r.inhouse_deposit_slip_id)),p=t.data?.data||t.data;r.repair_requisition=p}catch(t){console.error("Error fetching repair requisition details:",t)}return r}catch(a){return console.error("Error fetching issue slip for PDF:",a),R.error("Failed to fetch issue slip details for PDF"),null}},g=async()=>{f(!0);try{const s={page:c+1,per_page:d},a=await h.get(n.repair_issue_slip.list,{params:s}),r=a.data?.data||[],t=a.data?.pagination;D(r),t?.last_page!==void 0&&S(t.last_page)}catch(s){console.error("Error fetching issue slips:",s)}finally{f(!1)}};return m.useEffect(()=>{g()},[c,d]),e.jsx("div",{className:"space-y-6",children:e.jsxs(v,{title:`Repair Issue Slips (${i.length})`,createOnClick:N.hasPermission("inhouse_repair_create")?()=>_(x.REPAIR_ISSUE_SLIP.CREATE):void 0,children:[e.jsxs(A,{children:[e.jsx(L,{cols:[{title:"Repair Item"},{title:"To Whom"},{title:"Created Date"},{title:"Actions"}]}),e.jsx("tbody",{children:E&&i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-sm text-gray-500",children:"Loading issue slips..."})]})})}):i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"No issue slips found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Issue slips will appear here once created."})]})})}):i.map((s,a)=>e.jsxs(F,{children:[e.jsx(l,{className:"px-5",children:c*d+a+1}),e.jsx(l,{children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.inhouse_deposit_slip?.repair_item||"N/A"})}),e.jsx(l,{children:e.jsx("div",{className:"text-sm text-gray-900",children:s.to_whom_user?.full_name||s.other||"N/A"})}),e.jsx(l,{className:"w-40",children:e.jsx("div",{className:"text-sm text-gray-500",children:w.date(s.created_at)})}),e.jsx(l,{className:"w-32",children:e.jsxs(U,{children:[e.jsx(k,{url:`${x.REPAIR_ISSUE_SLIP.DETAILS.replace(":id","")}${s.id}`,tooltip:"View Issue Slip Details"}),e.jsx($,{onClick:async()=>{const r=await T(s.id);if(r)try{const{pdf:t}=await P(async()=>{const{pdf:u}=await import("./react-pdf.browser-BNJ8mn34.js");return{pdf:u}},__vite__mapDeps([0,1,2])),{default:p}=await P(async()=>{const{default:u}=await import("./IssueSlipRepairReqPDF-BqBqDk7e.js");return{default:u}},__vite__mapDeps([3,1,2,0])),I=await t(e.jsx(p,{issueSlip:r})).toBlob(),j=URL.createObjectURL(I),o=document.createElement("a");o.href=j,o.download=`Issue-Slip-${s.id}.pdf`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(j)}catch(t){console.error("Error generating PDF:",t),R.error("Failed to generate PDF")}},title:"Download Issue Slip PDF"}),e.jsx(C,{onClick:()=>_(`${x.REPAIR_ISSUE_SLIP.CREATE}?editId=${s.id}`)}),e.jsx(q,{refetch:g,endpoint:n.repair_issue_slip.delete(s.id)})]})})]},s.id))})]}),i.length>0&&y()]})})};export{Y as default};
