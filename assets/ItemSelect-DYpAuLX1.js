import{r as t,j as a,ae as k,m as z,h as O,e as T}from"./index-9KeMeSmC.js";import{C as _}from"./index.esm-DW5kOZiJ.js";const A=({options:h,value:g,onChange:x,placeholder:b="Select",disabled:m,error:c,className:w,onSearch:d})=>{const[n,o]=t.useState(!1),[l,u]=t.useState(""),[s,r]=t.useState(""),[i,j]=t.useState({top:0,left:0,width:0}),p=t.useRef(null),S=t.useRef(null),L=t.useRef(null),v=h??[],I=v.find(e=>e.value===g);t.useEffect(()=>{const e=setTimeout(()=>{r(l),d?.(l)},300);return()=>clearTimeout(e)},[l,d]);const E=s.length>=3?v.filter(e=>e.label.toLowerCase().includes(s.toLowerCase())):v,f=()=>{if(p.current){const e=p.current.getBoundingClientRect();j({top:e.bottom+window.scrollY,left:e.left+window.scrollX,width:e.width})}};t.useEffect(()=>(n&&(f(),window.addEventListener("resize",f),window.addEventListener("scroll",f,!0)),()=>{window.removeEventListener("resize",f),window.removeEventListener("scroll",f,!0)}),[n]),t.useEffect(()=>{const e=y=>{const C=y.target,R=p.current?.contains(C),D=S.current?.contains(C);!R&&!D&&(o(!1),u(""))};return n&&document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[n]);const N=()=>n?l:I?.label||"";return a.jsxs("div",{className:"relative w-full",ref:p,children:[a.jsx("input",{ref:L,type:"text",disabled:m,value:N(),placeholder:b,onFocus:()=>{o(!0)},onChange:e=>{u(e.target.value),o(!0)},className:z("disabled:cursor-not-allowed disabled:opacity-80 w-full rounded-lg border px-4 py-3 text-gray-900 focus:outline-none text-sm",c?"border-red-500 focus:ring-2 focus:ring-red-200":"border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500","bg-gray-50",w)}),n&&!m&&k.createPortal(a.jsxs("div",{ref:S,className:"absolute z-[9999] rounded-lg border border-gray-300 bg-white shadow-lg max-h-60 overflow-auto",style:{top:i.top+4,left:i.left,width:i.width,boxShadow:"0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)"},children:[s.length>0&&s.length<3&&a.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"Type at least 3 characters"}),s.length>=3&&E.length===0&&a.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No results found"}),E.map(e=>a.jsx("div",{className:"px-4 py-2 text-sm cursor-pointer hover:bg-blue-50 border-b border-gray-100 last:border-b-0",onMouseDown:y=>{y.preventDefault()},onClick:()=>{x(e.value),o(!1),u("")},children:e.label},e.value))]}),document.body),c&&a.jsx("p",{className:"text-xs text-red-500 mt-1 font-medium",children:c})]})},$=({control:h,name:g,error:x,disabled:b=!1,onChange:m})=>{const[c,w]=t.useState([]),[d,n]=t.useState(!1),[o,l]=t.useState("");t.useEffect(()=>{if(console.log("SEARCH VALUE:",o),o&&o.length<3)return;(async()=>{n(!0);try{const r=await O.get(T.item_master.all,{params:{search:o}}),i=r.data?.items||r.data?.data||r.data||[];w(i)}catch(r){console.error("Failed to fetch items",r)}finally{n(!1)}})()},[o]);const u=c.map(s=>({value:s.id,label:`${s.item_name} (${s.item_code})`}));return a.jsx(_,{name:g,control:h,render:({field:s})=>a.jsx(A,{options:u,value:s.value,disabled:b||d,error:x,placeholder:d?"Loading...":"Select Item",onChange:r=>{s.onChange(r),m?.(r)},onSearch:l})})};export{$ as I};
