import{u as O,b as H,a as V,r as u,j as e,B as j,A as f,h as g,e as N,y as _}from"./index-CRQb4Yqg.js";import{T as l}from"./TextInput-CzX_TrPD.js";import{L as W}from"./ListWrapper-CR4DwgHS.js";import{T as z}from"./TableActions-0FNBzKkW.js";import{I as J}from"./ItemSelect-BGQIYTmP.js";import{T as p}from"./TableData-CkLqvJ1i.js";import{T as Q}from"./TableDelete-D7zkuIZO.js";import{T as K,a as M}from"./TableWrapper-C6CZttTh.js";import{u as X,b as Y,C as i}from"./index.esm-WRMWCj7W.js";import{o as Z,q as D}from"./yup-DTrWT5lm.js";import{u as ee}from"./useItemsStore-Cp1yXBzI.js";import{F as se}from"./FormHeader-Bu48ZAf1.js";import{L as ae}from"./Loading-DoP4UBIK.js";import{u as te}from"./usePartyStore-COd4VId-.js";import{S as re}from"./Select-CnXyV_N3.js";import{u as me}from"./useBranchStore-C0BC-4A9.js";import{S as ie}from"./SearchableSelect-Cb8Eg5jM.js";import"./BackButton-BvQEtBeB.js";const R={branch_name:"",branch_address:"",party_name:"",party_address:"",employee_name:"",employee_address:"",purpose:"",vehicle_number:"",driver:"",items:[{item_id:0,item_name:"",item_code:"",item_unit:"",item_description:"",quantity_out:0}]},Pe=()=>{const h=O(),[k]=H(),d=k.get("editId"),{selectedBranchId:v,user:x}=V(),{parties:b,fetchParties:S}=te(),{branches:C,fetchBranches:P}=me(),[G,A]=u.useState(!1),[y,E]=u.useState(!1),{control:r,handleSubmit:B,setValue:o,reset:w,formState:{errors:c}}=X({resolver:Z(D),defaultValues:R}),{fields:I,append:q,remove:L}=Y({control:r,name:"items"}),{items:$,fetchItems:T}=ee();u.useEffect(()=>{T(),S(),P()},[T,S,P]),u.useEffect(()=>{x?.branch&&(o("branch_name",x.branch.branch_name||""),o("branch_address",x.branch.address||""))},[x,o]),u.useEffect(()=>{if(!d)return;(async()=>{A(!0);try{const t=await g.get(N.returnable_gate_pass.details(parseInt(d,10))),a=t.data?.gate_pass||t.data?.data||t.data,m=a.items?.map(n=>({item_id:n.item_id||0,item_name:n.item?.item_name||"",item_code:n.item?.item_code||"",item_unit:n.item?.unit?.unit_name||"",item_description:n.item_description||"",quantity_out:n.quantity_out||0}))||R.items;w({branch_name:a.branch_id?.toString()||"",branch_address:a.branch?.address||"",party_name:a.party_name||"",party_address:a.party_contact||"",employee_name:a.emp_name||"",employee_address:a.emp_address||"",purpose:a.purpose||"",vehicle_number:a.vehicle_number||"",driver:a.driver_name||"",items:m})}catch(t){console.error(t),_.error("Failed to load gate pass details"),h(f.RETURNABLE_GATEPAS.LIST)}finally{A(!1)}})()},[d,w,v,h]);const F=async s=>{const t={branch_id:v,purpose:s.purpose,party_name:s.party_name,emp_name:s.employee_name,emp_address:s.employee_address,vehicle_number:s.vehicle_number,driver_name:s.driver,items:s.items.map(a=>({item_id:a.item_id,quantity_out:Number(a.quantity_out),item_description:a.item_description}))};try{E(!0),d?(await g.put(N.returnable_gate_pass.update(parseInt(d,10)),t),_.success("Returnable Gate Pass updated successfully!")):(await g.post(N.returnable_gate_pass.create,t),_.success("Returnable Gate Pass created successfully!")),h(f.RETURNABLE_GATEPAS.LIST)}catch(a){console.error("Error submitting:",a),_.error(a.response?.data?.message||`Failed to ${d?"update":"create"} returnable gate pass`)}finally{E(!1)}};return G?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(ae,{})}):e.jsxs("div",{className:"w-full h-full flex flex-col overflow-hidden bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-white border-b sticky top-0 z-10 shadow-sm shrink-0",children:[e.jsx("div",{className:"space-y-1 px-2 md:px-0 md:ml-2",children:e.jsx(se,{title:d?"Edit Returnable Gate Pass":"Create Returnable Gate Pass",subtitle:d?"Update the Returnable Gate Pass details":"Fill out the form to submit a new Returnable Gate Pass."})}),e.jsxs("div",{className:"flex justify-end gap-3 px-2 md:px-0 md:mr-4",children:[e.jsx(j,{variant:"outline",className:"w-full sm:w-auto",onClick:()=>h(f.RETURNABLE_GATEPAS.LIST),disabled:y,children:"Cancel"}),e.jsx(j,{className:"bg-red-600 text-white w-full sm:w-auto",onClick:B(F),loading:y,disabled:y,children:d?"Update Gate Pass":"Submit Gate Pass"})]})]}),e.jsxs("div",{className:"flex-1 overflow-auto space-y-6 md:space-y-8 p-2 md:p-4 pb-20",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-5 px-2 md:px-0 md:ml-2 md:mr-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Party Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(i,{name:"party_name",control:r,render:({field:s})=>{const t=b.map(m=>({value:m.id,label:m.company_name})),a=b.find(m=>m.company_name===s.value)?.id;return e.jsx(ie,{options:t,value:a,onChange:m=>{const n=b.find(U=>U.id===m);n&&(s.onChange(n.company_name),o("party_address",n.address||""))},placeholder:"Select party for gate pass",error:c.party_name?.message})}})]}),e.jsx(i,{name:"party_address",control:r,render:({field:s})=>e.jsx(l,{...s,label:"Party Address",placeholder:"Auto-filled from selected party",error:c.party_address?.message,readOnly:!0})}),e.jsx(i,{name:"branch_name",control:r,render:({field:s})=>e.jsxs(re,{...s,label:"Branch",required:!0,error:c.branch_name?.message,children:[e.jsx("option",{value:"",children:"Select Branch"}),C.map(t=>e.jsx("option",{value:t.id,children:t.branch_name},t.id))]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Branch Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(i,{name:"branch_address",control:r,render:({field:s})=>e.jsx(l,{...s,placeholder:"Enter branch address",error:c.branch_address?.message})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Employee Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(i,{name:"employee_name",control:r,render:({field:s})=>e.jsx(l,{...s,placeholder:"Enter employee name",error:c.employee_name?.message})})]}),e.jsx(i,{name:"employee_address",control:r,render:({field:s})=>e.jsx(l,{...s,label:"Employee Address",placeholder:"Enter employee address",error:c.employee_address?.message})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Purpose ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(i,{name:"purpose",control:r,render:({field:s})=>e.jsx(l,{...s,placeholder:"Enter purpose of gate pass",error:c.purpose?.message})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Vehicle Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(i,{name:"vehicle_number",control:r,render:({field:s})=>e.jsx(l,{...s,placeholder:"e.g., RJ14AB1234",error:c.vehicle_number?.message})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Driver Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(i,{name:"driver",control:r,render:({field:s})=>e.jsx(l,{...s,placeholder:"Enter driver name",error:c.driver?.message})})]})]}),e.jsx("div",{className:"px-2 md:px-0",children:e.jsxs(W,{title:"Items Requested",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(j,{className:"bg-red-600 text-white px-3 py-1 text-sm",onClick:()=>q({item_id:0,item_name:"",item_code:"",item_unit:"",item_description:"",quantity_out:0}),children:"+ Add Item"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(K,{children:[e.jsx(M,{cols:[{title:"Item Name"},{title:"Item Code"},{title:"Item Unit"},{title:"Out Qty"},{title:"Remarks"},{title:"Action"}]}),e.jsx("tbody",{children:I.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8 text-gray-500",children:'No items added. Click "Add Item" to get started.'})}):I.map((s,t)=>e.jsxs("tr",{className:"align-middle",children:[e.jsx(p,{className:"text-center w-12",children:t+1}),e.jsx(p,{className:"min-w-[120px]",children:e.jsx(J,{control:r,name:`items.${t}.item_id`,onChange:a=>{const m=$.find(n=>n.id===a);m&&(o(`items.${t}.item_id`,m.id),o(`items.${t}.item_code`,m.item_code),o(`items.${t}.item_name`,m.item_name),o(`items.${t}.item_unit`,m.unit?.unit_symbol||""))}})}),e.jsx(p,{className:"min-w-[120px]",children:e.jsx(i,{name:`items.${t}.item_code`,control:r,render:({field:a})=>e.jsx(l,{...a,className:"mb-0 h-10 bg-gray-50",placeholder:"Auto-filled",readOnly:!0})})}),e.jsx(p,{className:"min-w-[100px]",children:e.jsx(i,{name:`items.${t}.item_unit`,control:r,render:({field:a})=>e.jsx(l,{...a,className:"mb-0 h-10 bg-gray-50",placeholder:"Auto-filled",readOnly:!0})})}),e.jsx(p,{className:"min-w-[120px]",children:e.jsx(i,{name:`items.${t}.quantity_out`,control:r,render:({field:a})=>e.jsx(l,{...a,type:"number",min:"0",step:"0.01",className:"mb-0 h-10 bg-gray-50",placeholder:"Enter qty"})})}),e.jsx(p,{className:"min-w-[150px]",children:e.jsx(i,{name:`items.${t}.item_description`,control:r,render:({field:a})=>e.jsx(l,{...a,className:"mb-0 h-10 bg-gray-50",placeholder:"Add remarks"})})}),e.jsx(p,{children:e.jsx(z,{children:e.jsx(Q,{onClick:()=>L(t)})})})]},s.id))})]})})]})})]})]})};export{Pe as default};
