import{r as u,a as z,j as e,h as I,e as B,y as O,u as U,f as $,P as E,A as L}from"./index-B2jzE3KR.js";import{L as H}from"./ListWrapper-BCPK_3oF.js";import{T as h}from"./TableData-kP0iDjWa.js";import{T as q,a as M}from"./TableWrapper-COpFbzLV.js";import{T as K}from"./TableRow-BTYyu-1e.js";import{u as Q}from"./usePagination-LT8jskJh.js";import{T as J}from"./TableActions-BfJ7Aaus.js";import{T as Z}from"./TableDelete-BO_nTUXR.js";import{L as X}from"./Loading-CTHClYOp.js";import{R as V}from"./ReasonModal-DYv1qCP_.js";import{i as W}from"./rolePermissions-BvMMyxfj.js";import{T as Y,a as ee}from"./TableDownload-CPqqWuAc.js";import{Document as te,Page as le,StyleSheet as se,View as s,Image as ae,Text as l,pdf as re}from"./react-pdf.browser-UupAjTf3.js";import{C as ne}from"./CommonFilter-CY8kfyCZ.js";import"./enum-SoLNwffs.js";import"./index.esm-BJtmoOhw.js";import"./TextInput-p-2I97j_.js";const oe=({purchaseOrder:r,onStatusUpdate:g})=>{const[v,b]=u.useState(!1),{user:w}=z(),[f,n]=u.useState(!1),[x,y]=u.useState(null),[R,N]=u.useState(!1),j=()=>{const o=w?.role?.role_name,i=r.status,a=[];return o==="Super Admin"&&(i==="Pending_Approval"||i==="Pending Approval"||i==="pending_approval"||i==="pending_admin_approval")&&a.push({label:"Approve",value:"Approved",variant:"success"},{label:"Reject",value:"Cancelled",variant:"danger"}),W(o||"")&&(i==="approve"||i==="approved")&&a.push({label:"Send to Vendor",value:"Sent_to_Vendor",variant:"primary"}),a},p=o=>{let i="";switch(o){case"Approved":i="approve";break;case"Sent_to_Vendor":i="sent_to_vendor";break;case"Cancelled":i="cancelled";break;default:i=o.toLowerCase()}if(i==="cancelled"){y(i),n(!0);return}T(i)},T=async(o,i)=>{b(!0);try{const a={status:o};o==="cancelled"&&(a.cancellation_reason=i||"No reason provided"),await I.post(B.purchase_order.status(r.id),a),O.success("Status updated successfully"),g()}catch(a){console.error("Failed to update status:",a),O.error(a.response?.data?.message||"Failed to update status")}finally{b(!1)}},c=o=>{x&&(T(x,o),y(null),n(!1))},m=j(),S=(()=>{switch(r.status){case"approve":return{text:"Approved",className:"border-gray-400 text-gray-800"};case"Pending_Approval":case"Pending Approval":case"pending_approval":case"pending_admin_approval":return{text:"Pending Approval",className:"border-gray-400 text-gray-800"};case"Sent_to_Vendor":case"Sent to Vendor":return{text:"Sent to Vendor",className:"border-gray-400 text-gray-800"};case"Cancelled":return{text:"Cancelled",className:"border-gray-300 text-gray-800"};default:return{text:r.status?.replace(/_/g," ")||"Unknown",className:"border-gray-400 text-gray-800"}}})();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:v?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Updating..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("select",{className:`text-xs border rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white min-w-[140px] ${m.length===0?"opacity-50 cursor-not-allowed":""} ${S.className}`,value:"",onChange:o=>{o.target.value&&m.length>0&&(p(o.target.value),o.target.value="")},disabled:v||m.length===0,children:[e.jsxs("option",{value:"",className:"font-medium",children:[S.text," ",m.length>0]}),m.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]}),r.status==="Cancelled"&&e.jsx(V,{open:R,onClose:()=>N(!1),title:"Cancellation Reason",message:r.cancellation_reason||"No reason provided",readonly:!0})]})}),e.jsx(V,{open:f,onClose:()=>{y(null),n(!1)},onSubmit:c,title:"Cancel Purchase Order",message:"Please provide a reason for cancelling this purchase order:"})]})},ie=r=>r?new Date(r).toLocaleDateString("en-IN",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",de=({po:r})=>{const v=(r.items||[]).map(n=>{const x=n.item?.item_name||"-",y=n.item?.item_code||"-",R=n.item?.unit?.unit_symbol||n.item?.unit?.unit_name||"-",N=Number(n.unit_price)||0;Number(n.quantity_ordered);const j=Number(n.discount_percentage)||0,p=Number(n.tax_percentage)||0,c=r.comparative_statement?.items?.find(_=>_.item_id===n.item_id)?.vendors?.find(_=>_.vendor_id===r.vendor_id),m=Number(c?.loading_charges)||0,C=Number(c?.loading_gst_percentage)||0,S=Number(c?.freight_charges)||0,o=Number(c?.freight_gst_percentage)||0,i=Number(c?.cutting_charges)||0,a=Number(c?.cutting_gst_percentage)||0,d=Number(n.total_price)||0;return{...n,item_name:x,item_code:y,item_unit:R,rate:N,loadingCharges:m,loadingGst:C,freightCharges:S,freightGst:o,cuttingCharges:i,cuttingGst:a,totalPrice:d,tax_percentage:p,discount_percentage:j}}),b=Number(r.tax_amount)||0,w=Number(r.total_amount)||0,f=w-b;return e.jsx(te,{children:e.jsxs(le,{size:"A4",style:t.page,children:[e.jsxs(s,{style:t.headerContainer,children:[e.jsx(s,{style:t.logoSection,children:e.jsx(ae,{src:"/assets/images/logo.png",style:t.logo})}),e.jsxs(s,{style:t.companyInfo,children:[e.jsx(l,{style:t.companyName,children:"UNITED ENGINEERING WORKS"}),e.jsx(l,{style:t.companyAddress,children:"N.H. 8, Nehla Village, By Pass Road, Near Govardhan Vilas, Udaipur- 313001 (Raj.) INDIA"}),e.jsx(l,{style:t.companyContact,children:"Phone: +91-9829232445 +91-9829657145 | GSTIN: 08ABQPK8948J3ZP"}),e.jsx(l,{style:t.companyContact,children:"Email: info@unitedengineeringworks.com"})]})]}),e.jsx(l,{style:t.title,children:"PURCHASE ORDER"}),e.jsxs(s,{style:t.infoContainer,children:[e.jsxs(s,{style:t.poDetailsBox,children:[e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"PO No:"}),e.jsx(l,{style:t.value,children:r.po_number})]}),e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"PO Date:"}),e.jsx(l,{style:t.value,children:ie(r.po_date)})]}),e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"Branch:"}),e.jsx(l,{style:t.value,children:r.branch?.branch_name||"-"})]}),e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"Delivery Address:"}),e.jsx(l,{style:t.value,children:r.delivery_address||"-"})]}),e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"Contact Person:"}),e.jsx(l,{style:t.value,children:r.delivery_contact_person||"-"})]}),e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"Phone:"}),e.jsx(l,{style:t.value,children:r.delivery_contact_phone||"-"})]})]}),e.jsxs(s,{style:t.vendorDetailsBox,children:[e.jsx(l,{style:t.vendorTitle,children:"VENDOR DETAILS"}),e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"Name:"}),e.jsx(l,{style:t.value,children:r.vendor?.party_name||"-"})]}),e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"Company:"}),e.jsx(l,{style:t.value,children:r.vendor?.company_name||"-"})]}),e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"Address:"}),e.jsxs(l,{style:t.value,children:[r.vendor?.address||"-",", ",r.vendor?.city||"-",","," ",r.vendor?.state||"-"," - ",r.vendor?.pincode||"-"]})]}),e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"Contact:"}),e.jsx(l,{style:t.value,children:r.vendor?.contact_person||"-"})]}),e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"Phone:"}),e.jsx(l,{style:t.value,children:r.vendor?.phone||"-"})]}),e.jsxs(s,{style:t.detailRow,children:[e.jsx(l,{style:t.label,children:"Email:"}),e.jsx(l,{style:t.value,children:r.vendor?.email||"-"})]})]})]}),e.jsxs(s,{style:t.tableContainer,children:[e.jsxs(s,{style:t.tableHeaderRow,children:[e.jsx(s,{style:[t.tableCell,t.snoCol,t.headerCell],children:e.jsx(l,{style:t.headerText,children:"S.No"})}),e.jsx(s,{style:[t.tableCell,t.itemNameCol,t.headerCell],children:e.jsx(l,{style:t.headerText,children:"Item Name"})}),e.jsx(s,{style:[t.tableCell,t.itemCodeCol,t.headerCell],children:e.jsx(l,{style:t.headerText,children:"Item Code"})}),e.jsx(s,{style:[t.tableCell,t.qtyCol,t.headerCell],children:e.jsx(l,{style:t.headerText,children:"Qty"})}),e.jsx(s,{style:[t.tableCell,t.unitCol,t.headerCell],children:e.jsx(l,{style:t.headerText,children:"Unit"})}),e.jsx(s,{style:[t.tableCell,t.rateCol,t.headerCell],children:e.jsx(l,{style:t.headerText,children:"Rate"})}),e.jsx(s,{style:[t.tableCell,t.discCol,t.headerCell],children:e.jsx(l,{style:t.headerText,children:"Disc%"})}),e.jsx(s,{style:[t.tableCell,t.gstCol,t.headerCell],children:e.jsx(l,{style:t.headerText,children:"GST%"})}),e.jsx(s,{style:[t.tableCell,t.chargeCol,t.headerCell],children:e.jsx(l,{style:t.headerText,children:"Loading"})}),e.jsx(s,{style:[t.tableCell,t.chargeCol,t.headerCell],children:e.jsx(l,{style:t.headerText,children:"Freight"})}),e.jsx(s,{style:[t.tableCell,t.chargeCol,t.headerCell],children:e.jsx(l,{style:t.headerText,children:"Cutting"})}),e.jsx(s,{style:[t.tableCell,t.amountCol,t.headerCell],children:e.jsx(l,{style:t.headerText,children:"Total"})})]}),v.map((n,x)=>e.jsxs(s,{style:t.tableRow,children:[e.jsx(s,{style:[t.tableCell,t.snoCol],children:e.jsx(l,{style:t.cellText,children:x+1})}),e.jsx(s,{style:[t.tableCell,t.itemNameCol],children:e.jsx(l,{style:t.cellText,children:n.item_name})}),e.jsx(s,{style:[t.tableCell,t.itemCodeCol],children:e.jsx(l,{style:t.cellText,children:n.item_code})}),e.jsx(s,{style:[t.tableCell,t.qtyCol],children:e.jsx(l,{style:t.cellText,children:String(n.quantity_ordered)})}),e.jsx(s,{style:[t.tableCell,t.unitCol],children:e.jsx(l,{style:t.cellText,children:n.item_unit})}),e.jsx(s,{style:[t.tableCell,t.rateCol],children:e.jsx(l,{style:t.cellText,children:n.rate.toFixed(2)})}),e.jsx(s,{style:[t.tableCell,t.discCol],children:e.jsxs(l,{style:t.cellText,children:[n.discount_percentage||0,"%"]})}),e.jsx(s,{style:[t.tableCell,t.gstCol],children:e.jsxs(l,{style:t.cellText,children:[n.tax_percentage||0,"%"]})}),e.jsx(s,{style:[t.tableCell,t.chargeCol],children:e.jsxs(l,{style:t.cellText,children:["₹",n.loadingCharges||0,n.loadingGst?` (+${n.loadingGst}%)`:""]})}),e.jsx(s,{style:[t.tableCell,t.chargeCol],children:e.jsxs(l,{style:t.cellText,children:["₹",n.freightCharges||0,n.freightGst?` (+${n.freightGst}%)`:""]})}),e.jsx(s,{style:[t.tableCell,t.chargeCol],children:e.jsxs(l,{style:t.cellText,children:["₹",n.cuttingCharges||0,n.cuttingGst?` (+${n.cuttingGst}%)`:""]})}),e.jsx(s,{style:[t.tableCell,t.amountCol],children:e.jsx(l,{style:t.cellText,children:n.totalPrice.toFixed(2)})})]},n.item_id||x))]}),e.jsxs(s,{style:t.totalsContainer,children:[e.jsxs(s,{style:t.totalRow,children:[e.jsx(l,{style:t.totalLabel,children:"Subtotal:"}),e.jsx(l,{style:t.totalValue,children:f.toFixed(2)})]}),e.jsxs(s,{style:t.totalRow,children:[e.jsx(l,{style:t.totalLabel,children:"Total GST:"}),e.jsx(l,{style:t.totalValue,children:b.toFixed(2)})]}),e.jsxs(s,{style:[t.totalRow,t.grandTotalRow],children:[e.jsx(l,{style:t.grandTotalLabel,children:"Grand Total:"}),e.jsx(l,{style:t.grandTotalValue,children:w.toFixed(2)})]})]}),e.jsxs(s,{style:t.termsSection,children:[e.jsx(l,{style:t.termsTitle,children:"Terms & Conditions:"}),r.special_instructions&&e.jsxs(l,{style:t.termsText,children:["4. ",r.special_instructions]})]}),e.jsx(s,{style:t.signatureContainer,children:e.jsxs(s,{style:t.signatureBox,children:[e.jsx(l,{style:t.signatureTitle,children:"For: UNITED ENGINEERING WORKS"}),e.jsx(s,{style:t.signatureLine}),e.jsx(l,{style:t.signatureText,children:"Authorized Signatory"})]})})]})})},t=se.create({page:{padding:20,fontSize:10,fontFamily:"Helvetica",lineHeight:1.3},headerContainer:{flexDirection:"row",alignItems:"center",marginBottom:15,paddingBottom:10,borderBottomWidth:2,borderBottomColor:"#000",gap:10},logoSection:{width:70,marginRight:20},logo:{width:60,height:50},companyInfo:{flex:1,alignItems:"flex-start"},companyName:{fontSize:16,fontWeight:"bold",marginBottom:4},companyAddress:{fontSize:10,marginBottom:2},companyContact:{fontSize:10},title:{fontSize:18,textAlign:"center",marginBottom:15,fontWeight:"bold",textDecoration:"underline"},infoContainer:{flexDirection:"row",marginBottom:15,justifyContent:"space-between"},poDetailsBox:{width:"48%",padding:8,marginTop:10},vendorDetailsBox:{width:"48%",padding:8,marginTop:10},vendorTitle:{fontSize:11,fontWeight:"bold",marginBottom:5,textAlign:"center"},detailRow:{flexDirection:"row",marginBottom:3},label:{width:"25%",fontSize:9,fontWeight:"bold",marginLeft:0},value:{width:"65%",fontSize:9},tableContainer:{marginBottom:15,borderWidth:.25,borderColor:"#000"},tableHeaderRow:{flexDirection:"row",backgroundColor:"#e0e0e0"},tableRow:{flexDirection:"row"},tableCell:{padding:2,borderWidth:.25,borderColor:"#000",justifyContent:"center",alignItems:"center"},headerCell:{backgroundColor:"#f0f0f0"},headerText:{fontSize:9,fontWeight:"bold",textAlign:"center"},cellText:{fontSize:8,textAlign:"center"},snoCol:{width:"4%"},itemNameCol:{width:"20%"},itemCodeCol:{width:"12%"},qtyCol:{width:"6%"},unitCol:{width:"6%"},rateCol:{width:"8%"},discCol:{width:"6%"},gstCol:{width:"6%"},chargeCol:{width:"8%"},amountCol:{width:"8%"},totalsContainer:{alignItems:"flex-end",marginBottom:15,paddingRight:20},totalRow:{flexDirection:"row",width:220,justifyContent:"space-between",marginBottom:3},totalLabel:{fontSize:10,fontWeight:"bold"},totalValue:{fontSize:10},grandTotalRow:{marginTop:5,paddingTop:5,borderTopWidth:1,borderTopColor:"#000"},grandTotalLabel:{fontSize:11,fontWeight:"bold"},grandTotalValue:{fontSize:11,fontWeight:"bold"},termsSection:{marginBottom:20,padding:8},termsTitle:{fontSize:9,fontWeight:"bold",marginBottom:10,textDecoration:"underline"},termsText:{fontSize:9,marginBottom:2},signatureContainer:{marginTop:50,alignItems:"flex-end"},signatureBox:{width:220,alignItems:"center"},signatureTitle:{fontSize:10,fontWeight:"bold",marginBottom:30},signatureLine:{width:150,height:1,backgroundColor:"#000",marginBottom:5},signatureText:{fontSize:9}}),ce=r=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:2}).format(r),F=r=>r?new Date(r).toLocaleDateString("en-IN",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",Re=()=>{const{page:r,rowsPerPage:g,setTotal:v,renderPagination:b}=Q(),w=U(),{selectedBranchId:f,user:n}=z(),{setPurchaseOrders:x}=$(),[y,R]=u.useState([]),[N,j]=u.useState(!1),[p]=u.useState(""),[T,c]=u.useState({}),m=[{name:"po_number",label:"PO Number",placeholder:"Enter PO Number"},{name:"date_from",label:"Date From",type:"date"},{name:"date_to",label:"Date To",type:"date"}],C=async a=>{j(!0);try{const d={page:r+1,per_page:g,...f&&{branch_id:f}};a&&(a.po_number&&(d.po_number=a.po_number),a.date_from&&a.date_to?a.date_from===a.date_to?d.date=a.date_from:(d.date_from=a.date_from,d.date_to=a.date_to):(a.date_from&&(d.date_from=a.date_from),a.date_to&&(d.date_to=a.date_to)));const _=await I.get(B.purchase_order.list,{params:d}),{purchase_orders:D,pagination:A}=_.data;R(D||[]),v(A?.last_page||0);const P=n?.role?.role_name;if(W(P||"")){const G=(D||[]).filter(k=>k.status==="Pending Approval").length;x(G)}}catch(d){console.log(d)}finally{j(!1)}};u.useEffect(()=>{C(T)},[r,g,f]);const S=async a=>{c(a),await C(a)},o=p?y.filter(a=>a.status===p):y,i=async a=>{j(!0);try{const d=await I.get(B.purchase_order.details(a.id)),_=d.data?.purchaseOrder||d.data?.purchase_order||d.data,D=await re(e.jsx(de,{po:_||a})).toBlob(),A=URL.createObjectURL(D),P=document.createElement("a");P.href=A,P.download=`${a?.po_number}.pdf`,P.click(),URL.revokeObjectURL(A)}catch(d){console.error("Error downloading PO:",d),O.error("Failed to download Purchase Order")}finally{j(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ne,{fields:m,onFilter:S,defaultValues:T}),e.jsxs(H,{title:`Purchase Orders (${o.length})`,createOnClick:E.hasPermission("purchase_management_create_pr")?()=>w(L.PURCHASE_ORDER.CREATE):void 0,children:[N?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(X,{})}):e.jsxs(q,{children:[e.jsx(M,{cols:[{title:"PO Number"},{title:"PO Date"},{title:"Expected Del Date"},{title:"Vendor"},{title:"Branch"},{title:"Items"},{title:"Total Amount"},{title:"Status"},{title:"Actions",width:"w-96"}]}),e.jsx("tbody",{children:N?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Loading purchase orders..."})]})})}):o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No purchase orders"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:p?`No orders found with status "${p}"`:"Get started by creating a new purchase order."})]})})}):o.map((a,d)=>e.jsxs(K,{children:[e.jsx(h,{className:"px-5",children:r*g+d+1}),e.jsx(h,{className:"w-40",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.po_number})})}),e.jsx(h,{className:"w-32",children:e.jsx("div",{className:"text-sm text-gray-900",children:F(a.po_date)})}),e.jsx(h,{className:"w-32",children:e.jsx("div",{className:"text-sm text-gray-900",children:a.expected_delivery_date?F(a.expected_delivery_date):"—"})}),e.jsx(h,{className:"w-48",children:e.jsx("div",{className:"text-sm text-gray-900",children:a.vendor?.party_name||"-"})}),e.jsx(h,{className:"w-32",children:e.jsx("div",{className:"text-sm text-gray-900",children:a.branch?.branch_name||"-"})}),e.jsx(h,{className:"w-20",children:e.jsx("div",{className:"text-sm text-gray-900",children:a.items?.length||0})}),e.jsx(h,{className:"w-32",children:e.jsx("div",{className:"text-sm text-gray-900",children:ce(a.total_amount||0)})}),e.jsx(h,{className:"w-40",children:e.jsx(oe,{purchaseOrder:{id:a.id,status:a.status,po_number:a.po_number},onStatusUpdate:C})}),e.jsx(h,{className:"w-20",children:e.jsxs(J,{children:[e.jsx(Y,{url:`${L.PURCHASE_ORDER.CREATE}?editId=${a.id}`,tooltip:`View Purchase Order ${a.po_number}`}),E.hasPermission("purchase_order_delete")&&e.jsx(Z,{refetch:C,endpoint:B.purchase_order.delete(a.id)}),e.jsx(ee,{title:"Download PO",onClick:()=>i(a)})]})})]},a.id))})]}),o.length>0&&b()]})]})};export{Re as default};
