const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-pdf.browser-DemeXHlN.js","assets/index-C-HhpDkY.js","assets/index-BBd5HntT.css","assets/GoodReceiveReportPDF-DF8u6GFF.js"])))=>i.map(i=>d[i]);
import{r as l,a as L,u as I,j as e,A as b,y as E,h as D,e as S,P as k,_ as A}from"./index-C-HhpDkY.js";import{L as F}from"./ListWrapper-DOgiLfWA.js";import{T as M}from"./TableActions-DN0qvBjN.js";import{T as V,a as $,b as o}from"./TableWrapper-ClISlYEF.js";import{T as U}from"./TableDelete-BioVSJwJ.js";import{T as B}from"./TableEdit-dm3GUF_S.js";import{T as z}from"./TableRow-CfaCzneu.js";import{T as H}from"./TableView-CQ-OPtVm.js";import{T as W}from"./TableDownload-BXTTOFoD.js";import{u as q}from"./usePagination-84yGnTMg.js";import{L as J}from"./Loading-C6uwP82P.js";import{S as K}from"./StatusFilter-DUwwVxTD.js";import{C as Q}from"./CommonFilter-Bd-y7X-d.js";import"./index.esm-BpE9IZoC.js";import"./TextInput-DE9vic5T.js";const X=({grn:r,onStatusUpdate:u})=>{const[c,N]=l.useState(!1),[i,p]=l.useState({open:!1,action:"",title:""}),[x,j]=l.useState(""),{user:y}=L(),v=I(),d=()=>{const a=y?.role?.role_name,t=r.status,s=[],n=a?.toLowerCase().replace(/\s+/g,"_");return(a==="Store Manager"||a==="Super Admin"||a==="Store Executive"||n==="store_manager"||n==="super_admin"||n==="store_executive")&&t==="pending_inspection"&&s.push({label:"Complete Inspection",value:"inspection_completed",variant:"success"}),(a==="Store Manager"||a==="Super Admin"||a==="Store Executive"||n==="store_manager"||n==="super_admin"||n==="store_executive")&&(t==="inspection_completed"||t==="pending_stock_update")&&s.push({label:"Update Stock",value:"stock_updated",variant:"primary"}),(a==="Store Manager"||a==="Super Admin"||a==="Store Executive"||n==="store_manager"||n==="super_admin"||n==="store_executive")&&["pending_inspection","inspection_completed","pending_stock_update"].includes(t)&&s.push({label:"Cancel",value:"cancelled",variant:"danger"}),s},T=async a=>{if(a==="cancelled"){p({open:!0,action:a,title:"Cancel GRN"});return}if(a==="inspection_completed"){v(`${b.MATERIAL_INSPECTION_REPORT.CREATE}?grnId=${r.id}`);return}if(a==="stock_updated"){await g("update_stock");return}await g(a)},g=async(a,t)=>{N(!0);try{const s={status:a};t&&(s.reason=t);const n=await D.post(S.grn.status(r.id),s);E.success("Status updated successfully"),u()}catch(s){console.error("Failed to update status:",s),E.error(s.response?.data?.message||"Failed to update status")}finally{N(!1)}},P=async()=>{if(!x.trim()){E.error("Please enter a reason");return}await g(i.action,x),R()},R=()=>{p({open:!1,action:"",title:""}),j("")},m=d(),w=(()=>{switch(r.status){case"inspection_completed":return{text:"Inspection Completed",className:"border-gray-400 text-gray-800"};case"pending_inspection":return{text:"Pending Inspection",className:"border-gray-400 text-gray-800"};case"stock_updated":return{text:"Stock Updated",className:"border-gray-400 text-gray-800"};case"pending_stock_update":return{text:"Pending Stock Update",className:"border-gray-400 text-gray-800"};case"cancelled":return{text:"Cancelled",className:"border-gray-400 text-gray-800"};default:return{text:r.status?.replace(/_/g," ")||"Unknown",className:"border-gray-300 text-gray-700"}}})();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:c?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Updating..."})]}):e.jsx(e.Fragment,{children:e.jsxs("select",{className:`text-xs border rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white min-w-[140px] ${m.length===0?"opacity-50 cursor-not-allowed":""} ${w.className}`,value:"",onChange:a=>{a.target.value&&m.length>0&&(T(a.target.value),a.target.value="")},disabled:c||m.length===0,children:[e.jsxs("option",{value:"",className:"font-medium",children:[w.text," ",m.length>0?"â–¼":""]}),m.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})})}),i.open&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:i.title}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:`Enter reason for ${i.action}...`,value:x,onChange:a=>j(a.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{className:"px-4 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50",onClick:R,disabled:c,children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 text-sm rounded-lg text-white bg-red-600 hover:bg-red-700",onClick:P,disabled:c,children:c?"Processing...":"Submit"})]})]})})]})},Y=r=>r?new Date(r).toLocaleDateString("en-IN",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",ge=()=>{const{page:r,rowsPerPage:u,setTotal:c,renderPagination:N}=q(),i=I(),{selectedBranchId:p}=L(),[x,j]=l.useState([]),[y,v]=l.useState(!1),[d,T]=l.useState(""),[g,P]=l.useState({}),R=async t=>{try{return(await D.get(S.grn.details(t))).data.grn}catch(s){return console.error("Error fetching GRN for PDF:",s),E.error("Failed to fetch GRN details for PDF"),null}},m=[{name:"grn_number",label:"GRN Number",placeholder:"Enter GRN Number"},{name:"date_from",label:"Date From",type:"date"},{name:"date_to",label:"Date To",type:"date"}],h=async t=>{v(!0);try{const s={page:r+1,rowsPerPage:u,...p&&{branch_id:p}};t&&(t.grn_number&&(s.grn_number=t.grn_number),t.date_from&&t.date_to?t.date_from===t.date_to?s.date=t.date_from:(s.date_from=t.date_from,s.date_to=t.date_to):(t.date_from&&(s.date_from=t.date_from),t.date_to&&(s.date_to=t.date_to)));const n=await D.get(S.grn.list,{params:s}),{grns:f,pagination:_}=n.data;j(f||[]),c(_?.total||0)}catch(s){console.log(s)}finally{v(!1)}};l.useEffect(()=>{h(g)},[r,u,p]);const w=async t=>{P(t),await h(t)},a=d?x.filter(t=>t.status===d):x;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Q,{fields:m,onFilter:w,defaultValues:g}),e.jsx(K,{module:"grn",selectedStatus:d,onChange:t=>T(t)}),e.jsxs(F,{title:`Goods Receipt Notes (${a.length})`,createOnClick:k.hasPermission("inventory_management_create_grn")?()=>i(b.GOOD_RECEIVE_REPORT.CREATE):void 0,children:[y?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(J,{})}):e.jsxs(V,{children:[e.jsx($,{cols:[{title:"GRN Number"},{title:"GRN Date"},{title:"PO Number"},{title:"Total Items"},{title:"M/S"},{title:"Bill Number"},{title:"Status"},{title:"Actions",width:"w-96"}]}),e.jsx("tbody",{children:y?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Loading GRNs..."})]})})}):a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No GRNs found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:d?`No GRNs found with status "${d}"`:"Get started by creating a new GRN."})]})})}):a.map((t,s)=>e.jsxs(z,{children:[e.jsx(o,{className:"px-5",children:r*u+s+1}),e.jsx(o,{className:"w-40",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.grn_number})})}),e.jsx(o,{className:"w-32",children:e.jsx("div",{className:"text-sm text-gray-900",children:Y(t.grn_date)})}),e.jsx(o,{className:"w-40",children:e.jsx("div",{className:"text-sm text-gray-900",children:t.purchase_order?.po_number||"-"})}),e.jsx(o,{className:"w-20",children:e.jsx("div",{className:"text-sm text-gray-900",children:t.items?.length||0})}),e.jsx(o,{className:"w-48",children:e.jsx("div",{className:"text-sm text-gray-900",children:t.vendor?.party_name||"-"})}),e.jsx(o,{className:"w-32",children:e.jsx("div",{className:"text-sm text-gray-900",children:t.invoice_no||"-"})}),e.jsx(o,{className:"w-40",children:e.jsx(X,{grn:{id:t.id,status:t.status,grn_number:t.grn_number,items:t.items},onStatusUpdate:h})}),e.jsx(o,{className:"w-20",children:e.jsxs(M,{children:[e.jsx(H,{url:`${b.GOOD_RECEIVE_REPORT.DETAILS.replace(":id","")}${t.id}`,tooltip:"View GRN Details"}),e.jsx(W,{onClick:async()=>{const n=await R(t.id);n&&A(async()=>{const{pdf:f}=await import("./react-pdf.browser-DemeXHlN.js");return{pdf:f}},__vite__mapDeps([0,1,2])).then(({pdf:f})=>{A(async()=>{const{default:_}=await import("./GoodReceiveReportPDF-DF8u6GFF.js");return{default:_}},__vite__mapDeps([3,1,2,0])).then(({default:_})=>{f(e.jsx(_,{grn:n})).toBlob().then(O=>{const G=URL.createObjectURL(O),C=document.createElement("a");C.href=G,C.download=`GRN-${t.grn_number||t.id}.pdf`,C.click(),URL.revokeObjectURL(G)})})})},title:"Download GRN PDF"}),t.status==="pending_inspection"&&e.jsx("button",{onClick:()=>i(`${b.MATERIAL_INSPECTION_REPORT.CREATE}?grnId=${t.id}`),className:`flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-full  \r
                             hover:bg-blue-200 hover:text-blue-700 transition\r
                             bg-blue-100 text-blue-600\r
                             disabled:cursor-not-allowed disabled:opacity-40 touch-manipulation`,title:"Generate Material Inspection Report",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),k.hasPermission("inventory_management_update_grn")&&e.jsx(B,{onClick:()=>i(`${b.GOOD_RECEIVE_REPORT.CREATE}?editId=${t.id}`)}),k.hasPermission("inventory_management_delete_grn")&&e.jsx(U,{refetch:h,endpoint:S.grn.delete(t.id)})]})})]},t.id))})]}),a.length>0&&N()]})]})};export{ge as default};
