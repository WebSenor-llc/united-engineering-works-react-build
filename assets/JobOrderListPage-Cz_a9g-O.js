import{j as e,ad as L,r as m,a5 as A,h as v,e as g,y as x,u as P,a as R,k,D as y,P as w,A as J}from"./index-CbNhh14T.js";import{L as E}from"./ListWrapper-CtE9blfZ.js";import{T as U,a as F,b as n}from"./TableWrapper-tM3Cun3B.js";import{T as B}from"./TableRow-XjmxnSZP.js";import{T as $,a as W}from"./TableDelete-BtQ4bCNH.js";import{T as z}from"./TableEdit-Bugrl_H8.js";import{L as H}from"./Loading-DBMuoTO4.js";import{u as M}from"./usePagination-DcXLmXSb.js";import{S as V}from"./StatusFilter-BkdONObd.js";const G=({onClick:a})=>e.jsx("button",{onClick:a,className:"flex items-center justify-center w-8 h-8 rounded-full bg-green-100 text-green-600 hover:bg-green-200 hover:text-green-700 transition",title:"Download Job Card",children:e.jsx(L,{size:16})}),I=({jobOrder:a,onStatusUpdate:u})=>{const[f,h]=m.useState(!1),b=async t=>{h(!0);try{await v.post(g.job_order.statusActions,{job_card_id:a.job_card_id,status:t}),x.success("Status updated successfully"),u()}catch(o){console.error("Failed to update status:",o),x.error(o.response?.data?.message||"Failed to update status")}finally{h(!1)}},i=Object.values(A).filter(t=>t!==a.status);return e.jsx("div",{className:"flex items-center gap-2",children:f?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Updating..."})]}):e.jsxs("select",{className:"text-xs border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white min-w-[120px]",value:a.status,onChange:t=>{t.target.value!==a.status&&b(t.target.value)},disabled:i.length===0,children:[e.jsx("option",{value:a.status,children:a.status.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}),i.map(t=>e.jsx("option",{value:t,children:t.replace(/_/g," ").replace(/\b\w/g,o=>o.toUpperCase())},t))]})})},te=()=>{const{renderPagination:a}=M(),u=P(),{selectedBranchId:f,user:h}=R(),{setJobOrders:b}=k(),[i,t]=m.useState([]),[o,_]=m.useState(!1),[c,T]=m.useState(""),N=async()=>{_(!0);try{const r=(await v.get(g.job_order.list)).data?.job_cards||[];t(r);const d=h?.role?.role_name;if(d==="Workshop Supervisor"||d==="Super Admin"){const l=r.filter(j=>j.status==="pending").length;b(l)}}catch(s){console.error("Failed to fetch job orders:",s),x.error("Failed to fetch job orders")}finally{_(!1)}},D=async s=>{try{const r=await v.get(g.job_order.download(s),{responseType:"blob"}),d=window.URL.createObjectURL(new Blob([r.data])),l=document.createElement("a");l.href=d;const j=r.headers["content-disposition"];let S=`job-card-${s}.pdf`;if(j){const C=j.match(/filename="(.+)"/);C&&(S=C[1])}l.setAttribute("download",S),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(d),x.success("Job card downloaded successfully")}catch(r){console.error("Failed to download job card:",r),x.error(r.response?.data?.message||"Failed to download job card")}};m.useEffect(()=>{N()},[f]);const p=c?i.filter(s=>s.status===c):i;return o?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(H,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(V,{module:"JobOrderStatus",selectedStatus:c,onChange:T}),e.jsxs(E,{title:`Job Orders (${p.length})`,createOnClick:w.hasPermission("job_card_management_create")?()=>u(J.JOB_ORDER.CREATE):void 0,children:[e.jsxs(U,{children:[e.jsx(F,{cols:[{title:"Job Card No"},{title:"Job Name"},{title:"Customer"},{title:"Job Date"},{title:"Expected Delivery"},{title:"Job Type"},{title:"Created At"},{title:"Status"},{title:"Actions"}]}),e.jsx("tbody",{children:o?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Loading job orders..."})]})})}):p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No job orders"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:c?`No job orders found with status "${c}"`:"Get started by creating a new job order."})]})})}):p.map((s,r)=>e.jsxs(B,{children:[e.jsx(n,{className:"w-12 text-center font-medium",children:e.jsx("div",{className:"text-sm text-gray-900",children:r+1})}),e.jsx(n,{className:"w-40",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.job_card_number||"-"})})}),e.jsx(n,{className:"w-48",children:e.jsx("div",{className:"text-sm text-gray-900",children:s.job_name||"-"})}),e.jsx(n,{className:"w-48",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.customer?.party_name||s.customer_name||"â€”"})})})}),e.jsx(n,{className:"w-32",children:e.jsx("div",{className:"text-sm text-gray-900",children:y.date(s.job_date)})}),e.jsx(n,{className:"w-32",children:e.jsx("div",{className:"text-sm text-gray-900",children:y.date(s.expected_delivery_date)})}),e.jsx(n,{className:"w-32",children:e.jsx("span",{className:"capitalize text-sm text-gray-900",children:s.job_type?.replace(/_/g," ")||"-"})}),e.jsx(n,{className:"w-32",children:e.jsx("div",{className:"text-sm text-gray-500",children:y.date(s.created_at)})}),e.jsx(n,{className:"w-40",children:e.jsx(I,{jobOrder:{job_card_id:s.id,status:s.status},onStatusUpdate:N})}),e.jsx(n,{className:"w-20",children:e.jsxs($,{children:[w.hasPermission("job_card_management_update")&&e.jsx(z,{onClick:()=>u(`${J.JOB_ORDER.CREATE}?editId=${s.id}`)}),e.jsx(G,{onClick:()=>D(s.id)}),w.hasPermission("job_card_management_delete")&&e.jsx(W,{refetch:N,endpoint:g.job_order.delete(s.id)})]})})]},s.id))})]}),p.length>0&&a()]})]})};export{te as default};
