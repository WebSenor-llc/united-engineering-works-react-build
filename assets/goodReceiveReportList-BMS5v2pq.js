import{r as c,a as T,u as k,j as t,A as y,y as R,h as P,e as E,P as S}from"./index-Dtfd8qjT.js";import{L as G}from"./ListWrapper-hoGOUdW1.js";import{T as I}from"./TableActions-BgZBRsUb.js";import{T as L,a as D,b as i}from"./TableWrapper-fkimiI7e.js";import{T as M}from"./TableDelete-z9MmpzJZ.js";import{T as O}from"./TableEdit-B8fVE-uo.js";import{T as F}from"./TableRow-DKSDSB8G.js";import{u as $}from"./usePagination-ClAJZ8c0.js";import{L as V}from"./Loading-F6CT88o7.js";import{S as U}from"./StatusFilter-C_kM98np.js";import{C as z}from"./CommonFilter-BO2Z5KtL.js";import"./index.esm-BEFVFIom.js";import"./TextInput-CKSwcBfK.js";const B=({grn:s,onStatusUpdate:x})=>{const[d,f]=c.useState(!1),[l,p]=c.useState({open:!1,action:"",title:""}),[g,b]=c.useState(""),{user:_}=T(),N=k(),m=()=>{const e=_?.role?.role_name,a=s.status,n=[],r=e?.toLowerCase().replace(/\s+/g,"_");return(e==="Store Manager"||e==="Super Admin"||e==="Store Executive"||r==="store_manager"||r==="super_admin"||r==="store_executive")&&a==="pending_inspection"&&n.push({label:"Complete Inspection",value:"inspection_completed",variant:"success"}),(e==="Store Manager"||e==="Super Admin"||e==="Store Executive"||r==="store_manager"||r==="super_admin"||r==="store_executive")&&(a==="inspection_completed"||a==="pending_stock_update")&&n.push({label:"Update Stock",value:"stock_updated",variant:"primary"}),(e==="Store Manager"||e==="Super Admin"||e==="Store Executive"||r==="store_manager"||r==="super_admin"||r==="store_executive")&&["pending_inspection","inspection_completed","pending_stock_update"].includes(a)&&n.push({label:"Cancel",value:"cancelled",variant:"danger"}),n},v=async e=>{if(e==="cancelled"){p({open:!0,action:e,title:"Cancel GRN"});return}if(e==="inspection_completed"){N(`${y.MATERIAL_INSPECTION_REPORT.CREATE}?grnId=${s.id}`);return}if(e==="stock_updated"){await h("update_stock");return}await h(e)},h=async(e,a)=>{f(!0);try{const n={status:e};a&&(n.reason=a);const r=await P.post(E.grn.status(s.id),n);R.success("Status updated successfully"),x()}catch(n){console.error("Failed to update status:",n),R.error(n.response?.data?.message||"Failed to update status")}finally{f(!1)}},w=async()=>{if(!g.trim()){R.error("Please enter a reason");return}await h(l.action,g),j()},j=()=>{p({open:!1,action:"",title:""}),b("")},o=m(),u=(()=>{switch(s.status){case"inspection_completed":return{text:"Inspection Completed",className:"border-gray-400 text-gray-800"};case"pending_inspection":return{text:"Pending Inspection",className:"border-gray-400 text-gray-800"};case"stock_updated":return{text:"Stock Updated",className:"border-gray-400 text-gray-800"};case"pending_stock_update":return{text:"Pending Stock Update",className:"border-gray-400 text-gray-800"};case"cancelled":return{text:"Cancelled",className:"border-gray-400 text-gray-800"};default:return{text:s.status?.replace(/_/g," ")||"Unknown",className:"border-gray-300 text-gray-700"}}})();return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:d?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Updating..."})]}):t.jsx(t.Fragment,{children:t.jsxs("select",{className:`text-xs border rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white min-w-[140px] ${o.length===0?"opacity-50 cursor-not-allowed":""} ${u.className}`,value:"",onChange:e=>{e.target.value&&o.length>0&&(v(e.target.value),e.target.value="")},disabled:d||o.length===0,children:[t.jsxs("option",{value:"",className:"font-medium",children:[u.text," ",o.length>0?"â–¼":""]}),o.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))]})})}),l.open&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:l.title}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Reason ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("textarea",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:`Enter reason for ${l.action}...`,value:g,onChange:e=>b(e.target.value)})]}),t.jsxs("div",{className:"flex justify-end gap-3",children:[t.jsx("button",{className:"px-4 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50",onClick:j,disabled:d,children:"Cancel"}),t.jsx("button",{className:"px-4 py-2 text-sm rounded-lg text-white bg-red-600 hover:bg-red-700",onClick:w,disabled:d,children:d?"Processing...":"Submit"})]})]})})]})},H=s=>s?new Date(s).toLocaleDateString("en-IN",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",re=()=>{const{page:s,rowsPerPage:x,setTotal:d,renderPagination:f}=$(),l=k(),{selectedBranchId:p}=T(),[g,b]=c.useState([]),[_,N]=c.useState(!1),[m,v]=c.useState(""),[h,w]=c.useState({}),j=[{name:"grn_number",label:"GRN Number",placeholder:"Enter GRN Number"},{name:"date_from",label:"Date From",type:"date"},{name:"date_to",label:"Date To",type:"date"}],o=async e=>{N(!0);try{const a={page:s+1,rowsPerPage:x,...p&&{branch_id:p}};e&&(e.grn_number&&(a.grn_number=e.grn_number),e.date_from&&e.date_to?e.date_from===e.date_to?a.date=e.date_from:(a.date_from=e.date_from,a.date_to=e.date_to):(e.date_from&&(a.date_from=e.date_from),e.date_to&&(a.date_to=e.date_to)));const n=await P.get(E.grn.list,{params:a}),{grns:r,pagination:A}=n.data;b(r||[]),d(A?.total||0)}catch(a){console.log(a)}finally{N(!1)}};c.useEffect(()=>{o(h)},[s,x,p]);const C=async e=>{w(e),await o(e)},u=m?g.filter(e=>e.status===m):g;return t.jsxs("div",{className:"space-y-6",children:[t.jsx(z,{fields:j,onFilter:C,defaultValues:h}),t.jsx(U,{module:"grn",selectedStatus:m,onChange:e=>v(e)}),t.jsxs(G,{title:`Goods Receipt Notes (${u.length})`,createOnClick:S.hasPermission("inventory_management_create_grn")?()=>l(y.GOOD_RECEIVE_REPORT.CREATE):void 0,children:[_?t.jsx("div",{className:"flex justify-center py-10",children:t.jsx(V,{})}):t.jsxs(L,{children:[t.jsx(D,{cols:[{title:"GRN Number"},{title:"GRN Date"},{title:"PO Number"},{title:"Total Items"},{title:"M/S"},{title:"Bill Number"},{title:"Status"},{title:"Actions",width:"w-96"}]}),t.jsx("tbody",{children:_?t.jsx("tr",{children:t.jsx("td",{colSpan:9,className:"px-6 py-12 text-center",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),t.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Loading GRNs..."})]})})}):u.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:9,className:"px-6 py-12 text-center",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No GRNs found"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:m?`No GRNs found with status "${m}"`:"Get started by creating a new GRN."})]})})}):u.map((e,a)=>t.jsxs(F,{children:[t.jsx(i,{className:"px-5",children:s*x+a+1}),t.jsx(i,{className:"w-40",children:t.jsx("div",{className:"flex items-center",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.grn_number})})}),t.jsx(i,{className:"w-32",children:t.jsx("div",{className:"text-sm text-gray-900",children:H(e.grn_date)})}),t.jsx(i,{className:"w-40",children:t.jsx("div",{className:"text-sm text-gray-900",children:e.purchase_order?.po_number||"-"})}),t.jsx(i,{className:"w-20",children:t.jsx("div",{className:"text-sm text-gray-900",children:e.items?.length||0})}),t.jsx(i,{className:"w-48",children:t.jsx("div",{className:"text-sm text-gray-900",children:e.vendor?.party_name||"-"})}),t.jsx(i,{className:"w-32",children:t.jsx("div",{className:"text-sm text-gray-900",children:e.invoice_no||"-"})}),t.jsx(i,{className:"w-40",children:t.jsx(B,{grn:{id:e.id,status:e.status,grn_number:e.grn_number,items:e.items},onStatusUpdate:o})}),t.jsx(i,{className:"w-20",children:t.jsxs(I,{children:[e.status==="pending_inspection"&&t.jsx("button",{onClick:()=>l(`${y.MATERIAL_INSPECTION_REPORT.CREATE}?grnId=${e.id}`),className:`flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-full  \r
                             hover:bg-blue-200 hover:text-blue-700 transition\r
                             bg-blue-100 text-blue-600\r
                             disabled:cursor-not-allowed disabled:opacity-40 touch-manipulation`,title:"Generate Material Inspection Report",children:t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),S.hasPermission("inventory_management_update_grn")&&t.jsx(O,{onClick:()=>l(`${y.GOOD_RECEIVE_REPORT.CREATE}?editId=${e.id}`)}),S.hasPermission("inventory_management_delete_grn")&&t.jsx(M,{refetch:o,endpoint:E.grn.delete(e.id)})]})})]},e.id))})]}),u.length>0&&f()]})]})};export{re as default};
