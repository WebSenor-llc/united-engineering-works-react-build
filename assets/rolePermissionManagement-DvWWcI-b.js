import{l as R,u as A,r as n,y as c,h as g,e as u,j as s,I as L,B as f}from"./index-DhMZcEWH.js";import{L as U}from"./ListWrapper-CgjZDznb.js";import{L as _}from"./Loading-DarExsNw.js";function B(){const{roleId:l}=R(),m=A(),[y,b]=n.useState({}),[a,p]=n.useState(new Set),[j,h]=n.useState(!1),[d,x]=n.useState(!1),[N,v]=n.useState("");n.useEffect(()=>{if(!l){c.error("Role ID is required"),m("/role-management/list");return}w()},[l]);const w=async()=>{h(!0);try{const r=await g.get(u.permission.permissions);r?.data?.grouped_permissions&&b(r.data.grouped_permissions);const e=await g.get(u.permission.update(Number(l)));if(e?.data?.role&&(v(e.data.role.role_name||""),e.data.role.permissions&&Array.isArray(e.data.role.permissions))){const t=e.data.role.permissions.map(i=>typeof i=="number"?i:i.id);p(new Set(t))}}catch(r){console.error("Error fetching permissions:",r),c.error("Failed to load permissions")}finally{h(!1)}},S=r=>{const e=new Set(a);e.has(r)?e.delete(r):e.add(r),p(e)},P=r=>{const e=r.map(o=>o.id),t=e.every(o=>a.has(o)),i=new Set(a);t?e.forEach(o=>i.delete(o)):e.forEach(o=>i.add(o)),p(i)},k=r=>r.every(e=>a.has(e.id)),C=r=>{const e=r.filter(t=>a.has(t.id)).length;return e>0&&e<r.length},E=r=>r.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),M=async()=>{if(l){x(!0);try{const r={permissions:Array.from(a)};await g.put(u.permission.update(Number(l)),r),c.success("Permissions updated successfully"),setTimeout(()=>{m("/role-management/list")},1e3)}catch(r){console.error("Error updating permissions:",r),c.error("Failed to update permissions")}finally{x(!1)}}};return j?s.jsx(_,{}):s.jsx(U,{title:`Manage Permissions - ${N}`,children:s.jsxs("div",{className:"mt-6 space-y-6",children:[Object.entries(y).map(([r,e])=>s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden",children:[s.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:E(r)}),s.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[s.jsx("input",{type:"checkbox",checked:k(e),ref:t=>{t&&(t.indeterminate=C(e))},onChange:()=>P(e),className:"w-5 h-5 text-primary border-gray-300 rounded focus:ring-primary focus:ring-2 cursor-pointer"}),s.jsx("span",{className:"text-sm font-medium text-gray-600 group-hover:text-primary transition-colors",children:"Select All"})]})]})}),s.jsx("div",{className:"p-6",children:s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map(t=>s.jsxs("label",{className:`flex items-start gap-3 p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 ${a.has(t.id)?"border-primary bg-red-50":"border-gray-200 bg-white hover:border-gray-300 hover:bg-gray-50"}`,children:[s.jsx("div",{className:"flex items-center h-5",children:s.jsx("input",{type:"checkbox",checked:a.has(t.id),onChange:()=>S(t.id),className:"w-5 h-5 text-primary border-gray-300 rounded focus:ring-primary focus:ring-2 cursor-pointer"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-semibold text-gray-800 capitalize",children:t.action.replace(/_/g," ")}),s.jsx("p",{className:"text-xs text-gray-600 mt-1",children:t.description})]})]},t.id))})})]},r)),s.jsx("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(L,{className:"text-green-600 w-5 h-5"}),s.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[a.size," permission",a.size!==1?"s":""," selected"]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(f,{variant:"outline",onClick:()=>m("/role-management/list"),disabled:d,children:"Cancel"}),s.jsx(f,{onClick:M,loading:d,disabled:d,className:"flex items-center gap-2",children:d?"Updating...":"Update Permissions"})]})]})})]})})}export{B as default};
