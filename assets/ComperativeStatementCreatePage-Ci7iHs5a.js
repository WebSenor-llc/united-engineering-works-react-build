import{r as x,j as e,B as A,h as E,e as F,y as q,u as Ce,i as we,a as Ve,A as re}from"./index-DwoM2qi7.js";import{T as h}from"./TextInput-B3xKsBn1.js";import{S as ne}from"./Select-B5dfGBP8.js";import{B as de}from"./BaseModal-B4YrvyCh.js";import{u as ce,C as y,b as qe}from"./index.esm-MBtrRDns.js";import{o as $e,p as Pe}from"./yup-CI06meJR.js";import{u as Ae}from"./useItemsStore-Ckm2arOn.js";import{u as Ee}from"./useMaterialRequestStore-DqKwaAwW.js";import{F as Fe}from"./FormHeader-BGoI8AUi.js";import{L as Te}from"./Loading-JYq8HBew.js";import{u as Me}from"./usePartyStore-DbSTfM_r.js";import{C as ke}from"./CommonFilter-BeUeKbVJ.js";import"./BackButton-DRzNQbUf.js";const Re=({open:j,onClose:L,onSuccess:g})=>{const[H,W]=x.useState([]),[S,T]=x.useState([]),[M,B]=x.useState([]),[U,Q]=x.useState(!1),{control:_,handleSubmit:X,reset:$,watch:z,formState:{errors:p}}=ce({defaultValues:{party_type:"vendor",party_name:"",company_name:"",address:"",city:"",state:"",pincode:"",gstin:"",contact_person:"",phone:"",credit_limit:"",email:"",country:"India",pan:"",bank_name:"",bank_account_number:"",bank_ifsc_code:"",is_active:!0},resolver:$e(Pe)}),o=z("country"),k=z("state");x.useEffect(()=>{j&&(async()=>{try{const d=await E.get(F.party_master.countries);W(d.data.data||d.data||[])}catch(d){console.error("Failed to fetch countries",d)}})()},[j]),x.useEffect(()=>{if(!o||!j){T([]);return}(async()=>{const d=H.find(u=>u.name===o);if(d)try{const u=await E.get(`${F.party_master.states}?country=${d.name}`);T(u.data.data||u.data||[])}catch(u){console.error("Failed to fetch states",u)}})()},[o,H,j]),x.useEffect(()=>{if(!k||!j){B([]);return}(async()=>{const d=S.find(u=>u.name===k);if(d)try{const u=await E.get(`${F.party_master.cities}?state=${d.name}`);B(u.data.data||u.data||[])}catch(u){console.error("Failed to fetch cities",u)}})()},[k,S,j]);const Y=async i=>{Q(!0);try{await E.post(F.party_master.create,i),q.success("Party Created Successfully"),g(),L(),$()}catch(d){console.error(d),q.error(d.response?.data?.message||"Failed to save party")}finally{Q(!1)}};return e.jsx(de,{open:j,onClose:()=>{L(),$()},title:"Create New Party",maxWidth:"max-w-4xl",children:e.jsxs("div",{className:"space-y-6 max-h-[80vh] overflow-y-auto px-1 py-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(y,{name:"party_type",control:_,render:({field:i})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["Party Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...i,className:"w-full rounded-lg border border-gray-300 mt-1 px-3 py-2 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"Select Party Type"}),e.jsx("option",{value:"vendor",children:"Vendor"}),e.jsx("option",{value:"customer",children:"Customer"})]}),p?.party_type?.message&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.party_type.message})]})}),e.jsx(y,{name:"party_name",control:_,render:({field:i})=>e.jsx(h,{required:!0,...i,label:"Party Name",error:p?.party_name?.message,className:"text-sm py-2"})}),e.jsx(y,{name:"contact_person",control:_,render:({field:i})=>e.jsx(h,{required:!0,...i,label:"Contact Person",error:p?.contact_person?.message,className:"text-sm py-2"})}),e.jsx(y,{name:"company_name",control:_,render:({field:i})=>e.jsx(h,{required:!0,...i,label:"Company Name",error:p?.company_name?.message,className:"text-sm py-2"})}),e.jsx(y,{name:"address",control:_,render:({field:i})=>e.jsx(h,{required:!0,...i,label:"Address",error:p?.address?.message,className:"text-sm py-2"})}),e.jsx(y,{name:"country",control:_,render:({field:i})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["Country ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...i,className:"w-full rounded-lg border border-gray-300 mt-1 px-3 py-2 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"Select Country"}),H.map(d=>e.jsx("option",{value:d.name,children:d.name},d.id||d.name))]}),p?.country?.message&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.country.message})]})}),e.jsx(y,{name:"state",control:_,render:({field:i})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["State ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...i,disabled:!S.length,className:"w-full rounded-lg border border-gray-300 mt-1 px-3 py-2 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white disabled:bg-gray-100",children:[e.jsx("option",{value:"",children:"Select State"}),S.map(d=>e.jsx("option",{value:d.name,children:d.name},d.id||d.name))]}),p?.state?.message&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.state.message})]})}),e.jsx(y,{name:"city",control:_,render:({field:i})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["City ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...i,disabled:!M.length,className:"w-full rounded-lg border border-gray-300 mt-1 px-3 py-2 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white disabled:bg-gray-100",children:[e.jsx("option",{value:"",children:"Select City"}),M.map(d=>e.jsx("option",{value:d.name,children:d.name},d.id||d.name))]}),p?.city?.message&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.city.message})]})}),e.jsx(y,{name:"pincode",control:_,render:({field:i})=>e.jsx(h,{required:!0,...i,label:"Pincode",error:p?.pincode?.message,className:"text-sm py-2"})}),e.jsx(y,{name:"phone",control:_,render:({field:i})=>e.jsx(h,{required:!0,...i,label:"Mobile No",type:"tel",error:p?.phone?.message,className:"text-sm py-2"})}),e.jsx(y,{name:"email",control:_,render:({field:i})=>e.jsx(h,{required:!0,...i,label:"Email",type:"email",error:p?.email?.message,className:"text-sm py-2"})}),e.jsx(y,{control:_,name:"is_active",render:({field:i})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:["Is Active ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...i,value:i.value?"true":"false",onChange:d=>i.onChange(d.target.value==="true"),className:"w-full border border-gray-300 rounded-lg px-3 py-2 bg-white text-gray-800 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-200",children:[e.jsx(A,{onClick:()=>{L(),$()},variant:"outline",className:"text-sm px-4",children:"Cancel"}),e.jsx(A,{onClick:X(Y),loading:U,disabled:U,className:"bg-red-600 text-white text-sm px-4",children:"Create Party"})]})]})})},K={quantity:"",rate:"",discount_percent:"",gst_percent:"",net_amount:"",total_amount:""},Ye=()=>{const j=Ce(),[L]=we(),g=L.get("editId"),{items:H,fetchItems:W}=Ae(),{materials:S,fetchMaterials:T}=Ee(),[M,B]=x.useState(!1),[U,Q]=x.useState(!1),{selectedBranchId:_}=Ve(),{parties:X,fetchParties:$}=Me(),[z,p]=x.useState(!1),[o,k]=x.useState(null),[Y,i]=x.useState(""),[d,u]=x.useState(""),[me,le]=x.useState(!1),{control:Z,handleSubmit:ue,getValues:P,watch:R,setValue:w,register:I,trigger:D}=ce({defaultValues:{branch_id:"",material_requisition_id:"",items:[]}}),{fields:J}=qe({control:Z,name:"items",keyName:"fieldId"}),xe=[{name:"mr_number",label:"MR Number",placeholder:"Enter MR number"},{name:"item_name",label:"Item Name",placeholder:"Enter Item Name"},{name:"date_from",label:"Date From",type:"date",placeholder:"Enter Date from"},{name:"date_to",label:"Date To",type:"date",placeholder:"Enter Date To"}],pe=async t=>{ge(t);const s={};t.mr_number&&(s.mr_number=t.mr_number),t.item_name&&(s.item_name=t.item_name),t.date_from&&t.date_to?t.date_from===t.date_to?s.date=t.date_from:(s.date_from=t.date_from,s.date_to=t.date_to):(t.date_from&&(s.date_from=t.date_from),t.date_to&&(s.date_to=t.date_to)),await T(s)},[f,C]=x.useState({}),[he,ge]=x.useState({}),oe=X.filter(t=>(t.party_type?.toLowerCase()==="vendor"||!t.party_type)&&t.is_active);x.useEffect(()=>{$()},[$]),x.useEffect(()=>{W(),T()},[W,T]);const _e=async()=>{if(g){B(!0);try{const s=(await E.get(F.comparative_statement.details(Number(g)))).data?.statement;if(!s){q.error("Comparative statement not found"),j(re.COMPERATIVE_STATEMENT.LIST);return}const a=s.items||[],c=s.material_requisition_id;if(a.length===0){q.error("No items found in comparative statement"),j(re.COMPERATIVE_STATEMENT.LIST);return}w("material_requisition_id",c?String(c):"");const r=[],n={};a.forEach((l,v)=>{const V={item_id:String(l.item_id||l.item?.id||""),item_name:l.item?.item_name||l.item_name||l.name||"",item_unit:l.item?.unit?.unit_name||l.item?.unit?.unit_symbol||l.item_unit||l.unit||"",quantity:String(l.quantity||""),last_purchase_rate:String(l.last_purchase_rate||"0"),selected_vendor_id:l.selected_vendor_id?`v_${l.selected_vendor_id}`:"",vendors:[]};n[v]={};const b=l.vendors||[],G=new Set;if(b.forEach(m=>{const O=`v_${m.vendor_id||m.id}`,ae=m.vendor?.party_name||m.party_name||`Vendor ${m.vendor_id}`;G.has(O)||(V.vendors.push({id:O,name:ae,vendor_id:m.vendor_id||m.id}),G.add(O)),n[v][O]={quantity:String(m.quantity||V.quantity||""),rate:String(m.rate??m.unit_price??m.price??""),discount_percent:String(m.discount_percent??m.discount_percentage??m.discount??""),gst_percent:String(m.gst_percent??m.gst_percentage??m.tax_percent??""),net_amount:String(m.net_amount??""),total_amount:String(m.total_amount??"")}}),l.selected_vendor&&l.selected_vendor_id){const m=`v_${l.selected_vendor_id}`;G.has(m)||(V.vendors.push({id:m,name:l.selected_vendor_rate_details?.vendor_name||l.selected_vendor?.party_name||"Selected Vendor",vendor_id:l.selected_vendor_rate_details?.vendor_id||l.selected_vendor_id}),n[v][m]||(n[v][m]={quantity:String(l.quantity||""),rate:String(l.selected_vendor_rate_details?.rate??""),discount_percent:String(l.selected_vendor_rate_details?.discount_percentage??""),gst_percent:String(l.selected_vendor_rate_details?.gst_percentage??""),net_amount:String(l.selected_vendor_rate_details?.net_amount??""),total_amount:String(l.selected_vendor_rate_details?.total_amount??"")}))}r.push(V)}),w("items",r),C(n),q.success("Comparative statement loaded successfully")}catch(t){console.error("Failed to load comparative statement:",t),console.error("Error response:",t.response?.data),q.error(t.response?.data?.message||"Failed to load comparative statement details")}finally{B(!1)}}};x.useEffect(()=>{g&&_e()},[g]);const be=t=>{if(!t){w("items",[]);return}const s=S?.find(a=>a.id===Number(t));if(s&&s.items&&s.items.length>0){const a=s.items.map(r=>({item_id:String(r.item?.id||r.item_id||""),item_name:r.item?.item_name||r.item_name||r.name||"",item_unit:r.item?.unit?.unit_name||r.item?.unit?.unit_symbol||r.item_unit||r.unit||"",quantity:String(r.quantity_required||r.quantity||""),last_purchase_rate:"0",selected_vendor_id:"",vendors:[]}));w("items",a);const c={};a.forEach((r,n)=>{c[n]={}}),C(c)}},ye=t=>{k(t),p(!0);const s=P(`items.${t}`);s.selected_vendor_id?(u(s.selected_vendor_id),i(s.selected_vendor_id)):s.vendors&&s.vendors.length>0?u(s.vendors[0].id):u("")},ie=()=>{p(!1),k(null),i(""),u("")},fe=(t,s,a)=>{if(!t)return"";const c=t*(s/100||0),r=t-c,n=r*(a/100||0),l=r+n;return Number.isFinite(l)?l.toFixed(2):""},ee=(t,s)=>{const a=parseFloat(t)||0,c=parseFloat(s)||0,r=a*c;return Number.isFinite(r)?r.toFixed(2):""},te=(t,s,a,c)=>{const r={...f,[t]:{...f[t],[s]:{...f[t]?.[s],[a]:c}}};if(a==="quantity"){const O=r[t][s].net_amount,ae=P(`items.${t}.quantity`),Se=ee(ae,O);r[t][s].total_amount=Se,C(r);return}const n=r[t][s],l=parseFloat(n?.rate||"0")||0,v=parseFloat(n?.discount_percent||"0")||0,V=parseFloat(n?.gst_percent||"0")||0,b=fe(l,v,V);r[t][s].net_amount=b;const G=P(`items.${t}.quantity`),m=ee(G,b);r[t][s].total_amount=m,C(r)},je=async t=>{if(!t||o===null)return;const s=parseInt(t),a=oe.find(b=>b.id===s);if(!a)return;const r=P(`items.${o}`).vendors||[],n=`v_${s}`;if(r.some(b=>b.vendor_id===s)){u(n),C(b=>({...b,[o]:{...b[o],[n]:{...K}}})),i(""),await D();return}const v={id:n,name:a.party_name,vendor_id:s},V=[...r,v];w(`items.${o}.vendors`,V),u(n),C(b=>({...b,[o]:{...b[o],[n]:{...K}}})),i(""),await D()},ve=async(t,s)=>{const a=P(`items.${t}`),c=a.vendors[s].id,r=a.vendors.filter((n,l)=>l!==s);w(`items.${t}.vendors`,r),C(n=>{const l={...n};return l[t]&&delete l[t][c],l}),a.selected_vendor_id===c&&w(`items.${t}.selected_vendor_id`,""),d===c&&r.length>0&&u(r[0].id),await D()},se=t=>t?!!(t.rate||t.net_amount||t.total_amount):!1,Ne=async t=>{Q(!0);const s={branch_id:Number(_),material_requisition_id:t.material_requisition_id?Number(t.material_requisition_id):null,items:t.items.map((a,c)=>({item_id:Number(a.item_id),quantity:Number(a.quantity),last_purchase_rate:Number(a.last_purchase_rate)||0,selected_vendor_id:a.selected_vendor_id?Number(a.selected_vendor_id.replace("v_","")):null,vendors:a.vendors.map(r=>{const n=f[c]?.[r.id]||K,l=Number(n.discount_percent)||0,v=Number(n.gst_percent)||0;return{vendor_id:r.vendor_id,quantity:Number(n.quantity)||Number(a.quantity),rate:Number(n.rate)||0,unit_price:Number(n.rate)||0,discount_percent:l,gst_percent:v,discount_percentage:l,gst_percentage:v,tax_percentage:v,net_amount:Number(n.net_amount)||0,total_amount:Number(n.total_amount)||0}})}))};console.log("Submitting Comparative Statement Payload:",s);try{const a=g?F.comparative_statement.update(Number(g)):F.comparative_statement.create;await(g?E.put:E.post)(a,s),q.success(g?"Comparative statement updated successfully":"Comparative statement created successfully"),j(re.COMPERATIVE_STATEMENT.LIST)}catch(a){console.error(a),q.error(a.response?.data?.message||"Failed to save comparative statement")}finally{Q(!1)}};if(M)return e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(Te,{})});const N=o!==null?P(`items.${o}.vendors`)||[]:[];return e.jsxs("div",{className:"w-full h-full overflow-auto bg-slate-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8 px-6 py-5 pb-10",children:[e.jsx(Fe,{title:g?"Edit Comparative Statement":"Create Comparative Statement",subtitle:g?"Update the comparative statement details":"Compare rates from multiple vendors and select the best option."}),e.jsx(ke,{fields:xe,onFilter:pe,defaultValues:he}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 sm:p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-semibold text-slate-500 uppercase mb-1",children:"Material Request"}),e.jsx(y,{name:"material_requisition_id",control:Z,render:({field:t})=>e.jsxs(ne,{...t,className:"text-sm py-2",onChange:s=>{t.onChange(s.target.value),be(s.target.value)},disabled:!!g,children:[e.jsx("option",{value:"",children:"Select Material Request"}),S&&S.length>0&&S.map(s=>e.jsxs("option",{value:s.id,children:[s.mr_number," - ",s.department||"Unknown Dept"]},s.id))]})})]})}),J.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"text-sm font-semibold text-slate-700 mb-3",children:["Material Request Items (",J.length,")"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-100 border-b border-slate-200",children:[e.jsx("th",{className:"text-left text-xs font-semibold text-slate-600 p-3",children:"Item Description"}),e.jsx("th",{className:"text-center text-xs font-semibold text-slate-600 p-3",children:"Unit"}),e.jsx("th",{className:"text-center text-xs font-semibold text-slate-600 p-3",children:"Quantity"}),e.jsx("th",{className:"text-center text-xs font-semibold text-slate-600 p-3",children:"Last Rate"}),e.jsx("th",{className:"text-center text-xs font-semibold text-slate-600 p-3",children:"Selected Vendor"}),e.jsx("th",{className:"text-center text-xs font-semibold text-slate-600 p-3",children:"Action"})]})}),e.jsx("tbody",{children:J.map((t,s)=>{const a=R(`items.${s}.vendors`)||[],c=R(`items.${s}.selected_vendor_id`),r=a.find(n=>n.id===c);return e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50",children:[e.jsx("td",{className:"p-3",children:e.jsx(h,{...I(`items.${s}.item_name`),className:"bg-slate-50 border-slate-200 text-sm py-2",readOnly:!0})}),e.jsx("td",{className:"p-3",children:e.jsx(h,{...I(`items.${s}.item_unit`),className:"bg-slate-50 border-slate-200 text-center text-sm py-2",readOnly:!0})}),e.jsx("td",{className:"p-3",children:e.jsx(h,{...I(`items.${s}.quantity`),type:"number",className:"text-center text-sm py-2",placeholder:"0"})}),e.jsx("td",{className:"p-3",children:e.jsx(h,{...I(`items.${s}.last_purchase_rate`),type:"number",className:`text-center text-sm py-2 ${g?"bg-slate-50 border-slate-200":""}`,placeholder:"0.00",readOnly:!!g})}),e.jsx("td",{className:"p-3",children:r?e.jsx("div",{className:"bg-green-50 border border-green-300 rounded px-3 py-2 text-center",children:e.jsx("span",{className:"text-sm font-medium text-green-800",children:r.name})}):e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded px-3 py-2 text-center",children:e.jsx("span",{className:"text-xs text-gray-400",children:"Not Selected"})})}),e.jsx("td",{className:"p-3 text-center",children:e.jsx(A,{variant:"outline",onClick:()=>ye(s),className:"text-xs py-1 px-3",children:"Select Vendor"})})]},t.fieldId)})})]})})]}),!P("material_requisition_id")&&e.jsx("div",{className:"text-center p-12 bg-white border border-dashed border-slate-300 rounded-lg text-slate-500",children:"Please select a material request to view items."}),e.jsxs("div",{className:"flex justify-end items-center gap-3 mt-6",children:[e.jsx(A,{variant:"outline",onClick:()=>j(-1),children:"Cancel"}),e.jsx(A,{className:"bg-red-600 text-white",onClick:ue(Ne),loading:U,disabled:U||J.length===0,children:g?"Update Statement":"Submit Statement"})]})]})]}),e.jsx(de,{open:z,onClose:ie,title:"Select Vendors",maxWidth:"max-w-5xl",children:o!==null&&e.jsxs("div",{className:"space-y-4 max-h-[80vh] overflow-y-auto pr-2",children:[e.jsx("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200",children:e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Item:"}),e.jsx("p",{className:"font-medium",children:R(`items.${o}.item_name`)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Unit:"}),e.jsx("p",{className:"font-medium",children:R(`items.${o}.item_unit`)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 block mb-1",children:"Quantity:"}),e.jsx(h,{...I(`items.${o}.quantity`),type:"number",className:"text-sm py-2 font-medium",placeholder:"0",onChange:t=>{w(`items.${o}.quantity`,t.target.value),(R(`items.${o}.vendors`)||[]).forEach(a=>{const c=f[o]?.[a.id]?.net_amount||"";if(c){const r=ee(t.target.value,c);C(n=>({...n,[o]:{...n[o],[a.id]:{...n[o]?.[a.id],total_amount:r}}}))}})}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 block mb-1",children:"Last Rate:"}),e.jsx(h,{...I(`items.${o}.last_purchase_rate`),type:"number",className:"text-sm py-2 font-medium",placeholder:"0.00"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 uppercase",children:"Add Vendor"}),e.jsx(A,{variant:"outline",className:"text-[10px] py-0 px-2 h-6 border-slate-300 hover:bg-slate-100",onClick:()=>le(!0),children:"+ Add Party"})]}),e.jsxs(ne,{value:Y,onChange:t=>{i(t.target.value),je(t.target.value)},className:"text-sm py-2",disabled:M,children:[e.jsx("option",{value:"",children:M?"Loading vendors...":"Select Vendor to Add"}),oe.filter(t=>!N.some(s=>s.vendor_id===t.id)).map(t=>e.jsx("option",{value:t.id.toString(),children:t.party_name},t.id))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 uppercase mb-1",children:"Select Vendor (Final Choice)"}),e.jsx(y,{name:`items.${o}.selected_vendor_id`,control:Z,render:({field:t})=>e.jsxs(ne,{...t,className:"text-sm py-2 bg-green-50 border-green-300",onChange:s=>{const a=s.target.value,c=t.value;t.onChange(a),c&&c!==a&&C(r=>({...r,[o]:{...r[o],[c]:{...K}}})),a&&u(a)},children:[e.jsx("option",{value:"",children:"Select Vendor"}),N.filter(s=>{const a=f[o]?.[s.id];return se(a)}).map(s=>e.jsx("option",{value:s.id,children:s.name||"Vendor"},s.id))]})})]})]}),N.length>0&&e.jsx("div",{className:"space-y-4",children:(()=>{const t=N.find(a=>a.id===d)||N[0];if(!t)return null;const s=N.findIndex(a=>a.id===t.id);return e.jsxs("div",{className:"bg-slate-50 rounded-lg border border-slate-200 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3 pb-2 border-b border-slate-300",children:[e.jsx("span",{className:"font-semibold text-slate-700 text-sm",children:t.name||`Vendor ${s+1}`}),N.length>1&&e.jsx("button",{type:"button",onClick:()=>ve(o,s),className:"text-red-400 hover:text-red-600 font-bold ml-2",children:"✕"})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500 text-center font-medium",children:"Rate"}),e.jsx(h,{type:"number",className:"text-sm text-right py-2 px-2",placeholder:"0.00",value:f[o]?.[t.id]?.rate||"",onChange:a=>{te(o,t.id,"rate",a.target.value)}})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500 text-center font-medium",children:"Disc%"}),e.jsx(h,{type:"number",className:"text-sm text-right py-2 px-2",placeholder:"0",value:f[o]?.[t.id]?.discount_percent||"",onChange:a=>{te(o,t.id,"discount_percent",a.target.value)}})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500 text-center font-medium",children:"GST%"}),e.jsx(h,{type:"number",className:"text-sm text-right py-2 px-2",placeholder:"0",value:f[o]?.[t.id]?.gst_percent||"",onChange:a=>{te(o,t.id,"gst_percent",a.target.value)}})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500 text-center font-medium",children:"Net Amount"}),e.jsx(h,{readOnly:!0,className:"bg-white border-slate-200 text-sm text-right font-medium py-2 px-2",value:f[o]?.[t.id]?.net_amount||""})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500 text-center font-medium",children:"Total Amount"}),e.jsx(h,{readOnly:!0,className:"bg-blue-50 border-blue-200 text-sm text-right font-semibold py-2 px-2",value:f[o]?.[t.id]?.total_amount||""})]})]})]},t.id)})()}),N.length>0&&e.jsxs("div",{className:"mt-6 border-t border-slate-200 pt-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-slate-700 mb-3",children:["Participating Vendors (",N.filter(t=>se(f[o]?.[t.id])).length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:N.map(t=>{const s=t.id===d,a=t.id===R(`items.${o}.selected_vendor_id`);let c,r;a?(c="p-4 border-2 border-green-500 bg-green-50 rounded-lg shadow-sm cursor-pointer",r="font-semibold text-sm text-green-800"):s?(c="p-4 border border-gray-600 bg-gray-400 text-white rounded-lg shadow-sm cursor-pointer",r="font-semibold text-sm text-white"):(c="p-4 border border-slate-200 bg-white rounded-lg shadow-sm cursor-pointer hover:border-slate-300",r="font-semibold text-slate-800 text-sm");const n=f[o]?.[t.id];return se(n)?e.jsxs("div",{className:c,onClick:()=>u(t.id),children:[e.jsx("div",{className:"flex justify-between mb-2 items-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:r,children:t.name}),a&&e.jsx("span",{className:"text-xs bg-green-500 text-white px-2 py-1 rounded-full",children:"Selected"})]})}),e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:a?"border border-green-200 rounded p-2 bg-green-100":s?"border border-gray-500/40 rounded p-2 bg-gray-500/30":"border border-slate-100 rounded p-2 bg-slate-50",children:e.jsxs("div",{className:"grid grid-cols-2 gap-1 text-[11px]",children:[e.jsxs("span",{className:a?"text-green-700":s?"text-white":"",children:["Rate: ₹",n?.rate||"0"]}),e.jsxs("span",{className:a?"text-green-700":s?"text-white":"",children:["Disc: ",n?.discount_percent||"0","%"]}),e.jsxs("span",{className:a?"text-green-700":s?"text-white":"",children:["GST: ",n?.gst_percent||"0","%"]}),e.jsxs("span",{className:`col-span-2 font-semibold ${a?"text-green-800":s?"text-white":""}`,children:["Net: ₹",n?.net_amount||"0"]}),e.jsxs("span",{className:`col-span-2 font-semibold ${a?"text-green-800":s?"text-white":"text-blue-700"}`,children:["Total: ₹",n?.total_amount||"0"]})]})})})]},t.id):null})})]}),N.length===0&&e.jsx("div",{className:"text-center p-8 bg-yellow-50 border border-yellow-200 rounded-lg text-yellow-700 text-sm",children:"Please add at least one vendor to compare rates."}),e.jsx("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-slate-200 sticky bottom-0 bg-white",children:e.jsx(A,{variant:"outline",onClick:ie,children:"Close"})})]})}),e.jsx(Re,{open:me,onClose:()=>le(!1),onSuccess:$})]})};export{Ye as default};
