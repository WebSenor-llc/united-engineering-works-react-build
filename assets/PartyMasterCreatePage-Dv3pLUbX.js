import{u as L,b as R,r as l,j as e,B as w,A as k,h as u,e as p,y as f}from"./index-QEJ2HCdw.js";import{T as i}from"./TextInput-BdJuYdFC.js";import{F as U}from"./FormHeader-BVmIKXpM.js";import{S as g}from"./SearchableSelect-5Z_5MaTW.js";import{L as $}from"./Loading-BUzEJx3P.js";import{o as B,p as D,e as H}from"./yup-Dt7c8rJX.js";import{u as O,C as o}from"./index.esm-Bd1pinfN.js";import"./BackButton-8FL22_V2.js";const V={party_type:"",party_name:"",company_name:"",address:"",city:"",state:"",pincode:"",gstin:"",contact_person:"",phone:"",credit_limit:null,email:"",country:"",pan:"",bank_name:"",bank_account_number:"",bank_ifsc_code:"",is_active:!0},Z=()=>{const j=L(),[E]=R(),r=E.get("id"),[T,_]=l.useState(!1),[v,N]=l.useState(!1),[y,A]=l.useState([]),[m,C]=l.useState([]),[x,S]=l.useState([]),{control:c,handleSubmit:F,reset:M,watch:P,formState:{errors:n}}=O({defaultValues:V,resolver:B(r?D:H)}),h=P("country"),b=P("state");l.useEffect(()=>{(async()=>{try{const t=await u.get(p.party_master.countries);A(t.data.countries||[])}catch(t){console.error("Failed to fetch countries",t)}})()},[]),l.useEffect(()=>{if(!h){C([]);return}(async()=>{const t=y.find(s=>s.name===h);if(t)try{const s=await u.get(`${p.party_master.states}?country=${t.name}`);C(s.data.states||s.data||[])}catch(s){console.error("Failed to fetch states",s)}})()},[h,y]),l.useEffect(()=>{if(!b){S([]);return}(async()=>{const t=m.find(s=>s.name===b);if(t)try{const s=await u.get(`${p.party_master.cities}?state=${t.name}`);S(s.data.cities||s.data||[])}catch(s){console.error("Failed to fetch cities",s)}})()},[b,m]);const q=async()=>{if(r){_(!0);try{const t=(await u.get(p.party_master.details(Number(r)))).data.party;M({party_type:t.party_type||"",party_name:t.party_name||"",company_name:t.company_name||"",address:t.address||"",city:t.city||"",state:t.state||"",pincode:t.pincode||"",gstin:t.gstin||"",contact_person:t.contact_person||"",phone:t.phone||"",credit_limit:t.credit_limit??null,email:t.email||"",country:t.country||"",pan:t.pan||"",bank_name:t.bank_name||"",bank_account_number:t.bank_account_number||"",bank_ifsc_code:t.bank_ifsc_code||"",is_active:t.is_active??!0})}catch(a){console.error("Failed to load party details:",a),f.error("Failed to load party details")}finally{_(!1)}}};l.useEffect(()=>{r&&q()},[r]);const I=async a=>{N(!0);try{const t=r?{id:Number(r),party_name:a.party_name,party_type:a.party_type,contact_person:a.contact_person,phone:a.phone,credit_limit:a.credit_limit??null,is_active:a.is_active,company_name:a.company_name||"",address:a.address||""}:a,s=r?p.party_master.update(Number(r)):p.party_master.create;await(r?u.put:u.post)(s,t),f.success(r?"Party Updated Successfully":"Party Created Successfully"),j(k.PARTY_MASTER.LIST)}catch(t){console.error(t),f.error(t.response?.data?.message||"Failed to save party")}finally{N(!1)}};return T?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx($,{})}):e.jsxs("div",{className:"w-full h-full overflow-auto space-y-8 p-4 pb-20",children:[e.jsx("div",{className:"space-y-1 ml-2",children:e.jsx(U,{title:r?"Edit Party Master":"Create Party Master",subtitle:r?"Update the party master details":"Fill out the form to create a new party master"})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mx-2",children:e.jsxs("form",{onSubmit:F(I),children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[!r&&e.jsx(o,{name:"party_type",control:c,render:({field:a})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["Party Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...a,className:"w-full rounded-lg border border-gray-300 mt-1 px-3 py-3 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"Select Party Type"}),e.jsx("option",{value:"vendor",children:"Vendor"}),e.jsx("option",{value:"customer",children:"Customer"})]}),n?.party_type?.message&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.party_type.message})]})}),e.jsx(o,{name:"party_name",control:c,render:({field:a})=>e.jsx(i,{required:!0,...a,label:"Party Name",error:n?.party_name?.message})}),e.jsx(o,{name:"contact_person",control:c,render:({field:a})=>e.jsx(i,{required:!0,...a,label:"Contact Person",error:n?.contact_person?.message})}),!r&&e.jsx(o,{name:"company_name",control:c,render:({field:a})=>e.jsx(i,{required:!0,...a,label:"Company Name",error:n?.company_name?.message})}),!r&&e.jsx(o,{name:"address",control:c,render:({field:a})=>e.jsx(i,{required:!0,...a,label:"Address",error:n?.address?.message})}),!r&&e.jsx(o,{name:"country",control:c,render:({field:a})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["Country ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(g,{options:y.map(t=>({value:Number(t.id),label:t.name})),value:y.find(t=>t.name===a.value)?.id,onChange:t=>{const s=y.find(d=>Number(d.id)===Number(t));a.onChange(s?.name||"")},placeholder:"Select Country",error:n.country?.message})]})}),!r&&e.jsx(o,{name:"state",control:c,render:({field:a})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["State ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(g,{disabled:!m.length,options:m.map(t=>({value:Number(t.id),label:t.name})),value:m.find(t=>t.name===a.value)?.id,onChange:t=>{const s=m.find(d=>Number(d.id)===Number(t));a.onChange(s?.name||"")},placeholder:"Select State",error:n.state?.message})]})}),!r&&e.jsx(o,{name:"city",control:c,render:({field:a})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["City ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(g,{disabled:!x.length,options:x.map(t=>({value:Number(t.id),label:t.name})),value:x.find(t=>t.name===a.value)?.id,onChange:t=>{const s=x.find(d=>Number(d.id)===Number(t));a.onChange(s?.name||"")},placeholder:"Select City",error:n.city?.message})]})}),!r&&e.jsx(o,{name:"pincode",control:c,render:({field:a})=>e.jsx(i,{required:!0,...a,label:"Pincode",error:n?.pincode?.message})}),e.jsx(o,{name:"phone",control:c,render:({field:a})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["Mobile No ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-3 py-3 bg-gray-100 border border-gray-300 rounded-lg text-gray-700 text-sm",children:"+91"}),e.jsx(i,{...a,type:"tel",maxLength:10,placeholder:"Enter 10 digit mobile number",className:"mb-0 flex-1",onChange:t=>{const s=t.target.value.replace(/\D/g,"");a.onChange(s)}})]}),n?.phone?.message&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.phone.message})]})}),!r&&e.jsx(o,{name:"email",control:c,render:({field:a})=>e.jsx(i,{required:!0,...a,label:"Email",type:"email",error:n?.email?.message})}),e.jsx(o,{control:c,name:"is_active",render:({field:a})=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:["Is Active ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...a,value:a.value?"true":"false",onChange:t=>a.onChange(t.target.value==="true"),className:"w-full border border-gray-300 rounded-lg px-3 py-3 bg-white text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[e.jsx(w,{type:"button",onClick:()=>j(k.PARTY_MASTER.LIST),variant:"outline",children:"Cancel"}),e.jsx(w,{type:"submit",loading:v,disabled:v,className:"bg-red-600 text-white",children:r?"Update Party":"Create Party"})]})]})})]})};export{Z as default};
