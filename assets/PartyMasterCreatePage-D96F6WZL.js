import{u as q,i as I,r as l,j as e,B as S,A as w,h as d,e as m,y as g}from"./index-BPpkRjQL.js";import{T as i}from"./TextInput-gfXRTV11.js";import{F as L}from"./FormHeader-N4r7k8fv.js";import{L as R}from"./Loading-nJeSTSjR.js";import{o as U,p as $,e as B}from"./yup-Cpl6tZUx.js";import{u as H,C as o}from"./index.esm-CaQR1vU5.js";import"./BackButton-DvhqPw91.js";const O={party_type:"",party_name:"",company_name:"",address:"",city:"",state:"",pincode:"",gstin:"",contact_person:"",phone:"",credit_limit:"",email:"",country:"",pan:"",bank_name:"",bank_account_number:"",bank_ifsc_code:"",is_active:!0},W=()=>{const f=q(),[P]=I(),s=P.get("id"),[k,h]=l.useState(!1),[b,j]=l.useState(!1),[p,T]=l.useState([]),[u,_]=l.useState([]),[v,N]=l.useState([]),{control:c,handleSubmit:A,reset:E,watch:C,formState:{errors:r}}=H({defaultValues:O,resolver:U(s?B:$)}),x=C("country"),y=C("state");l.useEffect(()=>{(async()=>{try{const t=await d.get(m.party_master.countries);T(t.data.data||t.data||[])}catch(t){console.error("Failed to fetch countries",t)}})()},[]),l.useEffect(()=>{if(!x){_([]);return}(async()=>{const t=p.find(n=>n.name===x);if(t)try{const n=await d.get(`${m.party_master.states}?country=${t.name}`);_(n.data.data||n.data||[])}catch(n){console.error("Failed to fetch states",n)}})()},[x,p]),l.useEffect(()=>{if(!y){N([]);return}(async()=>{const t=u.find(n=>n.name===y);if(t)try{const n=await d.get(`${m.party_master.cities}?state=${t.name}`);N(n.data.data||n.data||[])}catch(n){console.error("Failed to fetch cities",n)}})()},[y,u]);const F=async()=>{if(s){h(!0);try{const t=(await d.get(m.party_master.details(Number(s)))).data.party;E({party_type:t.party_type||"",party_name:t.party_name||"",company_name:t.company_name||"",address:t.address||"",city:t.city||"",state:t.state||"",pincode:t.pincode||"",gstin:t.gstin||"",contact_person:t.contact_person||"",phone:t.phone||"",credit_limit:t.credit_limit||"",email:t.email||"",country:t.country||"",pan:t.pan||"",bank_name:t.bank_name||"",bank_account_number:t.bank_account_number||"",bank_ifsc_code:t.bank_ifsc_code||"",is_active:t.is_active??!0})}catch(a){console.error("Failed to load party details:",a),g.error("Failed to load party details")}finally{h(!1)}}};l.useEffect(()=>{s&&F()},[s]);const M=async a=>{j(!0);try{const t=s?{party_name:a.party_name,contact_person:a.contact_person,phone:a.phone,credit_limit:a.credit_limit,is_active:a.is_active}:a,n=s?m.party_master.update(Number(s)):m.party_master.create;await(s?d.put:d.post)(n,t),g.success(s?"Party Updated Successfully":"Party Created Successfully"),f(w.PARTY_MASTER.LIST)}catch(t){console.error(t),g.error(t.response?.data?.message||"Failed to save party")}finally{j(!1)}};return k?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(R,{})}):e.jsxs("div",{className:"w-full h-full overflow-auto space-y-8 p-4 pb-20",children:[e.jsx("div",{className:"space-y-1 ml-2",children:e.jsx(L,{title:s?"Edit Party Master":"Create Party Master",subtitle:s?"Update the party master details":"Fill out the form to create a new party master"})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mx-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[!s&&e.jsx(o,{name:"party_type",control:c,render:({field:a})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["Party Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...a,className:"w-full rounded-lg border border-gray-300 mt-1 px-3 py-3 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"Select Party Type"}),e.jsx("option",{value:"vendor",children:"Vendor"}),e.jsx("option",{value:"customer",children:"Customer"})]}),r?.party_type?.message&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.party_type.message})]})}),e.jsx(o,{name:"party_name",control:c,render:({field:a})=>e.jsx(i,{required:!0,...a,label:"Party Name",error:r?.party_name?.message})}),e.jsx(o,{name:"contact_person",control:c,render:({field:a})=>e.jsx(i,{required:!0,...a,label:"Contact Person",error:r?.contact_person?.message})}),!s&&e.jsx(o,{name:"company_name",control:c,render:({field:a})=>e.jsx(i,{required:!0,...a,label:"Company Name",error:r?.company_name?.message})}),!s&&e.jsx(o,{name:"address",control:c,render:({field:a})=>e.jsx(i,{required:!0,...a,label:"Address",error:r?.address?.message})}),!s&&e.jsx(o,{name:"country",control:c,render:({field:a})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["Country ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...a,className:"w-full rounded-lg border border-gray-300 mt-1 px-3 py-3 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"Select Country"}),p.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id||t.name))]}),r?.country?.message&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.country.message})]})}),!s&&e.jsx(o,{name:"state",control:c,render:({field:a})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["State ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...a,disabled:!u.length,className:"w-full rounded-lg border border-gray-300 mt-1 px-3 py-3 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white disabled:bg-gray-100",children:[e.jsx("option",{value:"",children:"Select State"}),u.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id||t.name))]}),r?.state?.message&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.state.message})]})}),!s&&e.jsx(o,{name:"city",control:c,render:({field:a})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["City ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...a,disabled:!v.length,className:"w-full rounded-lg border border-gray-300 mt-1 px-3 py-3 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white disabled:bg-gray-100",children:[e.jsx("option",{value:"",children:"Select City"}),v.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id||t.name))]}),r?.city?.message&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.city.message})]})}),!s&&e.jsx(o,{name:"pincode",control:c,render:({field:a})=>e.jsx(i,{required:!0,...a,label:"Pincode",error:r?.pincode?.message})}),e.jsx(o,{name:"phone",control:c,render:({field:a})=>e.jsx(i,{required:!0,...a,label:"Mobile No",type:"tel",error:r?.phone?.message})}),!s&&e.jsx(o,{name:"email",control:c,render:({field:a})=>e.jsx(i,{required:!0,...a,label:"Email",type:"email",error:r?.email?.message})}),e.jsx(o,{control:c,name:"is_active",render:({field:a})=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:["Is Active ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...a,value:a.value?"true":"false",onChange:t=>a.onChange(t.target.value==="true"),className:"w-full border border-gray-300 rounded-lg px-3 py-3 bg-white text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[e.jsx(S,{onClick:()=>f(w.PARTY_MASTER.LIST),variant:"outline",children:"Cancel"}),e.jsx(S,{onClick:A(M),loading:b,disabled:b,className:"bg-red-600 text-white",children:s?"Update Party":"Create Party"})]})]})]})};export{W as default};
