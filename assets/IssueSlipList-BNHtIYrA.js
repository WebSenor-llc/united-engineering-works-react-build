import{j as e,u as L,r as b,a as z,A as I,h as _,e as C,y as u}from"./index-K9d2s2ak.js";import{L as U}from"./ListWrapper-BJunTYp4.js";import{T as j}from"./TableData-CRcUF9xG.js";import{T as W,a as k}from"./TableWrapper-KnGC4Kvc.js";import{T as V}from"./TableRow-D6SvfGXk.js";import{u as v}from"./usePagination-BaFH0qQ1.js";import{T as H}from"./TableActions-BWIL9Be6.js";import{T as $}from"./TableDelete-MrNCSMHN.js";import{T as G,a as M}from"./TableDownload-DxVf-QVo.js";import{Document as O,Page as K,StyleSheet as Q,View as i,Image as J,Text as s,pdf as Y}from"./react-pdf.browser-D1T5-Vd5.js";import{C as Z}from"./CommonFilter-Biy-cRRg.js";import"./index.esm-Ct0RaNqj.js";import"./TextInput-C-uPTskM.js";const X=({data:a})=>{if(!a)return console.error("IssueSlipPdf: No data provided"),null;const h=Array.isArray(a.items)?a.items:[],d=o=>typeof o=="string"?o:typeof o=="object"&&o!==null?o.name?o.name:o.machine_name?o.machine_name:JSON.stringify(o):o?String(o):"-";return e.jsx(O,{children:e.jsxs(K,{size:"A4",style:t.page,children:[e.jsxs(i,{style:t.headerContainer,children:[e.jsx(i,{style:t.logoSection,children:e.jsx(J,{src:"/assets/images/logo.png",style:t.logo})}),e.jsxs(i,{style:t.companyInfo,children:[e.jsx(s,{style:t.companyName,children:"UNITED ENGINEERING WORKS"}),e.jsx(s,{style:t.companyAddress,children:"N.H. 8, Nehla Village, By Pass Road, Near Govardhan Vilas, Udaipur- 313001 (Raj.) INDIA"}),e.jsx(s,{style:t.companyContact,children:"Phone: +91-9829232445 +91-9829657145 | GSTIN: 08ABQPK8948J3ZP | Email: info@unitedengineeringworks.com"})]})]}),e.jsx(s,{style:t.title,children:"ISSUE SLIP"}),e.jsxs(i,{style:t.infoContainer,children:[e.jsxs(i,{style:t.detailRow,children:[e.jsx(s,{style:t.label,children:"MR:"}),e.jsx(s,{style:t.value,children:d(a.mr)})]}),e.jsxs(i,{style:t.detailRow,children:[e.jsx(s,{style:t.label,children:"Machine:"}),e.jsx(s,{style:t.value,children:d(a.machine)})]}),e.jsxs(i,{style:t.detailRow,children:[e.jsx(s,{style:t.label,children:"For Party:"}),e.jsx(s,{style:t.value,children:d(a.for_party)})]}),e.jsxs(i,{style:t.detailRow,children:[e.jsx(s,{style:t.label,children:"For Mines:"}),e.jsx(s,{style:t.value,children:d(a.for_mines)})]}),e.jsxs(i,{style:t.detailRow,children:[e.jsx(s,{style:t.label,children:"Purpose:"}),e.jsx(s,{style:t.value,children:d(a.purpose)})]}),e.jsxs(i,{style:t.detailRow,children:[e.jsx(s,{style:t.label,children:"Issued For:"}),e.jsx(s,{style:t.value,children:d(a.issued_for)})]})]}),e.jsxs(i,{style:t.tableContainer,children:[e.jsxs(i,{style:t.tableHeaderRow,children:[e.jsx(i,{style:[t.tableCell,t.snoCol],children:e.jsx(s,{style:t.headerText,children:"S.No"})}),e.jsx(i,{style:[t.tableCell,t.itemNameCol],children:e.jsx(s,{style:t.headerText,children:"Item Name"})}),e.jsx(i,{style:[t.tableCell,t.itemCodeCol],children:e.jsx(s,{style:t.headerText,children:"Item Code"})}),e.jsx(i,{style:[t.tableCell,t.unitCol],children:e.jsx(s,{style:t.headerText,children:"Unit"})}),e.jsx(i,{style:[t.tableCell,t.qtyCol],children:e.jsx(s,{style:t.headerText,children:"Required QTY"})}),e.jsx(i,{style:[t.tableCell,t.qtyCol],children:e.jsx(s,{style:t.headerText,children:"Issued QTY"})})]}),h.length>0?h.map((o,y)=>e.jsxs(i,{style:t.tableRow,children:[e.jsx(i,{style:[t.tableCell,t.snoCol],children:e.jsx(s,{style:t.cellText,children:y+1})}),e.jsx(i,{style:[t.tableCell,t.itemNameCol],children:e.jsx(s,{style:t.cellText,children:d(o?.item_name)})}),e.jsx(i,{style:[t.tableCell,t.itemCodeCol],children:e.jsx(s,{style:t.cellText,children:d(o?.item_code)})}),e.jsx(i,{style:[t.tableCell,t.unitCol],children:e.jsx(s,{style:t.cellText,children:d(o?.item_unit)})}),e.jsx(i,{style:[t.tableCell,t.qtyCol],children:e.jsx(s,{style:t.cellText,children:d(o?.required_qty)||"0"})}),e.jsx(i,{style:[t.tableCell,t.qtyCol],children:e.jsx(s,{style:t.cellText,children:d(o?.issued_qty)||"0"})})]},y)):Array.from({length:3}).map((o,y)=>e.jsxs(i,{style:t.tableRow,children:[e.jsx(i,{style:[t.tableCell,t.snoCol],children:e.jsx(s,{style:t.cellText,children:"-"})}),e.jsx(i,{style:[t.tableCell,t.itemNameCol],children:e.jsx(s,{style:t.cellText,children:"-"})}),e.jsx(i,{style:[t.tableCell,t.itemCodeCol],children:e.jsx(s,{style:t.cellText,children:"-"})}),e.jsx(i,{style:[t.tableCell,t.unitCol],children:e.jsx(s,{style:t.cellText,children:"-"})}),e.jsx(i,{style:[t.tableCell,t.qtyCol],children:e.jsx(s,{style:t.cellText,children:"-"})}),e.jsx(i,{style:[t.tableCell,t.qtyCol],children:e.jsx(s,{style:t.cellText,children:"-"})})]},y))]}),e.jsx(i,{style:t.signatureContainer,children:e.jsxs(i,{style:t.signatureBox,children:[e.jsx(s,{style:t.signatureTitle,children:"For: UNITED ENGINEERING WORKS"}),e.jsx(i,{style:t.signatureLine}),e.jsx(s,{style:t.signatureText,children:"Authorized Signatory"})]})})]})})},t=Q.create({page:{padding:20,fontSize:10,fontFamily:"Helvetica",lineHeight:1.3},headerContainer:{flexDirection:"row",alignItems:"center",marginBottom:15,gap:15,borderBottomWidth:2,borderBottomColor:"#000",paddingBottom:8},logoSection:{width:"20%"},logo:{width:90,height:50},companyInfo:{width:"80%",paddingLeft:10},companyName:{fontSize:14,fontWeight:"bold"},companyAddress:{fontSize:9},companyContact:{fontSize:9},title:{fontSize:16,textAlign:"center",marginVertical:10,fontWeight:"bold",textDecoration:"underline"},infoContainer:{marginBottom:15},detailRow:{flexDirection:"row",marginBottom:3},label:{width:"25%",fontSize:9,fontWeight:"bold"},value:{width:"75%",fontSize:9},tableContainer:{borderWidth:.25,borderColor:"#000",marginBottom:20},tableHeaderRow:{flexDirection:"row",backgroundColor:"#e0e0e0"},tableRow:{flexDirection:"row"},tableCell:{borderWidth:.25,borderColor:"#000",padding:2,justifyContent:"center",alignItems:"center"},headerText:{fontSize:9,fontWeight:"bold",textAlign:"center"},cellText:{fontSize:8,textAlign:"center"},snoCol:{width:"8%"},itemNameCol:{width:"30%"},itemCodeCol:{width:"20%"},unitCol:{width:"12%"},qtyCol:{width:"15%"},signatureContainer:{marginTop:40,alignItems:"flex-end"},signatureBox:{width:200,alignItems:"center"},signatureTitle:{fontSize:10,fontWeight:"bold",marginBottom:25},signatureLine:{width:150,height:1,backgroundColor:"#000",marginBottom:5},signatureText:{fontSize:9}}),ye=()=>{const{page:a,rowsPerPage:h,setTotal:d,renderPagination:o}=v(),y=L(),[N,R]=b.useState([]),{user:D,selectedBranchId:f}=z(),[w,P]=b.useState({}),A=[{name:"mr_number",label:"MR Number",placeholder:"Enter MR Number"},{name:"item_name",label:"Item Name",placeholder:"Enter Item Name"},{name:"date_from",label:"Date From",type:"date"},{name:"date_to",label:"Date To",type:"date"}],E=l=>{if(!l)return{ymd:"",dmy:""};const[r]=l.split("T"),[c,n,x]=r.split("-");return{ymd:r,dmy:`${x}-${n}-${c}`}},g=async l=>{try{const r={page:a+1,per_page:h,...f&&{branch_id:f}};l&&(l.mr_number&&(r.mr_number=l.mr_number),l.item_name&&(r.item_name=l.item_name),l.date_from&&l.date_to?l.date_from===l.date_to?r.date=l.date_from:(r.date_from=l.date_from,r.date_to=l.date_to):(l.date_from&&(r.date_from=l.date_from),l.date_to&&(r.date_to=l.date_to)));const c=await _.get(C.issue_slips.items,{params:r}),n=c.data?.data?.slips||c.data?.slips||[],x=c.data?.pagination;R(n),x?.last_page!==void 0&&d(x.last_page)}catch(r){console.error("Failed to fetch issue slips",r)}};b.useEffect(()=>{g(w)},[a,h,f,D]);const F=async l=>{P(l),await g(l)},q=async l=>{try{if(!l)throw new Error("No slip data provided");const r=u.loading("Preparing issue slip for download..."),c=await _.get(C.issue_slips.details(Number(l.id))),n=c.data.slip||c.data.data||c.data,x={id:n.id?.toString()||l.id,mr:n.mr||l.mr||"-",machine:typeof n.machine=="object"&&n.machine?.name?n.machine.name:n.machine||l.machine||"-",for_party:n.for_party||l.for_party||"-",for_mines:n.for_mines||l.for_mines||"-",purpose:n.purpose||l.purpose||"-",issued_to:n.issued_for||l.issued_to||"-",issued_for:n.issued_for||l.issued_for||"-",created_at:n.created_at||l.created_at||"",items:(n.items||[]).map(m=>({item_id:m.item_id?.toString()||"",item_name:m.item?.item_name||m.item_name||"-",item_code:m.item?.item_code||m.item_code||"-",item_unit:m.item?.unit?.unit_name||m.item_unit||"-",required_qty:m.required_qty?.toString()||"0",issued_qty:m.issued_qty?.toString()||"0"}))},T=await Y(e.jsx(X,{data:x})).toBlob();if(!T)throw new Error("Failed to generate PDF blob");const S=URL.createObjectURL(T),p=document.createElement("a");p.href=S,p.download=`issue-slip-${l.id||"unknown"}.pdf`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(S),u.dismiss(r),u.success("Issue slip downloaded successfully")}catch(r){console.error("Failed to download issue slip:",r),u.error(`Failed to download issue slip: ${r.message||"Unknown error"}`)}},B=async l=>{try{await _.delete(C.issue_slips.delete(l)),u.success("Issue slip deleted successfully"),g()}catch(r){console.error("Failed to delete issue slip",r),u.error("Failed to delete issue slip")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Z,{fields:A,onFilter:F,defaultValues:w}),e.jsxs(U,{title:"Issue Slip List",createOnClick:()=>y(I.ISSUE_SLIP.CREATE),children:[e.jsxs(W,{children:[e.jsx(k,{cols:[{title:"Date"},{title:"Issued to MR"},{title:"Issued To"},{title:"Purpose"},{title:"Actions"}]}),e.jsx("tbody",{children:N.map((l,r)=>e.jsxs(V,{children:[e.jsx(j,{className:"px-5",children:a*h+r+1}),e.jsx(j,{children:E(l.created_at).dmy}),e.jsx(j,{children:l?.mr||"N/A"}),e.jsx(j,{children:l.issued_for||"N/A"}),e.jsx(j,{children:l.purpose||"N/A"}),e.jsx(j,{children:e.jsxs(H,{children:[e.jsx(G,{url:`${I.ISSUE_SLIP.DETAILS.replace(":id","")}${l.id}`,tooltip:"View Issue Slip Details"}),e.jsx(M,{title:"Download Issue slip",onClick:()=>q(l)}),e.jsx($,{onClick:()=>B(Number(l.id))})]})})]},l.id))})]}),o()]})]})};export{ye as default};
