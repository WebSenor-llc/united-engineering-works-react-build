import{u as P,b as k,r,j as t,B as C,A as N,h as c,e as d,y as m}from"./index-5cgORhEY.js";import{T as O}from"./TextInput-79R6YI_q.js";import{T as R}from"./TextArea-qLBV2JX1.js";import{F as U}from"./FormHeader-Cf55-c6p.js";import{L as B}from"./Loading-B1FFLWWP.js";import{S as H}from"./SearchableSelect-DFzaBDZQ.js";import{o as Y,d as q}from"./yup-GURQQu5j.js";import{u as D,C as u}from"./index.esm-DJg7NxZA.js";import"./BackButton-C2V7tOX5.js";const V={name:"",state_id:void 0,is_active:!0,note:""},te=()=>{const x=P(),[_]=k(),s=_.get("id"),[w,p]=r.useState(!1),[y,g]=r.useState(!1),[h,S]=r.useState([]),[v,j]=r.useState(!0),[A,o]=r.useState([]),[z,b]=r.useState(!1),{control:l,handleSubmit:T,reset:F,formState:{errors:f}}=D({defaultValues:V,resolver:Y(q)}),L=async()=>{j(!0);try{const e=await c.get(d.state_master.all),a=e.data?.data?.states||e.data?.states||[],i=Array.isArray(a)?a:[];S(i),o(n(i))}catch(e){console.error("Failed to fetch states",e),m.error("Failed to load states"),S([]),o([])}finally{j(!1)}},n=e=>e.map(a=>({value:a.id,label:a.name})),I=async e=>{if(e.length<3){o(n(h));return}b(!0);try{const a=h.filter(i=>i.name.toLowerCase().includes(e.toLowerCase()));o(n(a))}catch(a){console.error("Failed to search states:",a),o(n(h))}finally{b(!1)}},E=async()=>{if(s){p(!0);try{const e=await c.get(d.city_master.details(Number(s))),a=e.data.states||e.data||{};F({name:a.name||"",state_id:a.state_id,is_active:a.is_active??!0,note:a.note||""})}catch(e){console.error("Failed to load city details:",e),m.error("Failed to load city details")}finally{p(!1)}}};r.useEffect(()=>{L(),s&&E()},[s]);const M=async e=>{g(!0);try{const a=s?d.city_master.update(Number(s)):d.city_master.create;await(s?c.put:c.post)(a,e),m.success(s?"City Updated Successfully":"City Created Successfully"),x(N.CITY_MASTER.LIST)}catch(a){console.error(a),m.error(a.response?.data?.message||"Failed to save city")}finally{g(!1)}};return w?t.jsx("div",{className:"flex justify-center py-20",children:t.jsx(B,{})}):t.jsxs("div",{className:"w-full h-full overflow-auto space-y-8 p-4 pb-20",children:[t.jsx("div",{className:"space-y-1 ml-2",children:t.jsx(U,{title:s?"Edit City Master":"Create City Master",subtitle:s?"Update the city master details":"Fill out the form to create a new city master"})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mx-2",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx(u,{name:"name",control:l,render:({field:e})=>t.jsx(O,{required:!0,...e,label:"City Name",error:f?.name?.message})}),t.jsx(u,{name:"state_id",control:l,render:({field:e})=>t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["State ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx(H,{options:A,value:e.value?Number(e.value):void 0,onChange:a=>e.onChange(a),placeholder:v?"Loading states...":"Search states...",onSearch:I,disabled:v,error:f?.state_id?.message})]})}),t.jsx(u,{name:"is_active",control:l,render:({field:e})=>t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:["Is Active ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("select",{...e,value:e.value?"true":"false",onChange:a=>e.onChange(a.target.value==="true"),className:"w-full border border-gray-300 rounded-lg px-3 py-3 bg-white text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"true",children:"Active"}),t.jsx("option",{value:"false",children:"Inactive"})]})]})})]}),t.jsx("div",{className:"mt-6",children:t.jsx(u,{name:"note",control:l,render:({field:e})=>t.jsx(R,{...e,label:"Note",placeholder:"Add any additional notes or comments...",error:f?.note?.message,rows:3})})}),t.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[t.jsx(C,{onClick:()=>x(N.CITY_MASTER.LIST),variant:"outline",children:"Cancel"}),t.jsx(C,{onClick:T(M),loading:y,disabled:y,className:"bg-red-600 text-white",children:s?"Update City":"Create City"})]})]})]})};export{te as default};
