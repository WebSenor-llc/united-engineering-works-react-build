import{r as h,a as v,j as e,as as r,h as y,e as j,y as E,u as T,D,A}from"./index-gVZAAP-J.js";import{L as w}from"./ListWrapper-CDXR4yYu.js";import{T as _,a as I,b as c}from"./TableWrapper-D8zDqKY_.js";import{T as P}from"./TableRow-D4vG6bsd.js";import{u as C}from"./usePagination-Jfc51W3i.js";import{T as L}from"./TableActions-CBCEPdci.js";import{T as U}from"./TableEdit-59jRdv9L.js";import{T as q}from"./TableDelete-Cqy9W1lx.js";import{c as k,a as G,b as $}from"./rolePermissions-Bo7kfMMU.js";const O=({requisition:a,onStatusUpdate:l})=>{const[f,d]=h.useState(!1),{user:u}=v(),o=async t=>{d(!0);try{await y.post(j.repair_requisition.statusActions(a.id),{repair_requisition_id:a.id,status:t}),E.success("Status updated successfully"),l()}catch(i){console.error("Failed to update status:",i),E.error(i.response?.data?.message||"Failed to update status")}finally{d(!1)}},n=(()=>{const t=u?.role?.role_name,i=a.status,x=k(t||""),m=G(t||"")||t==="Super Admin";let s=[];switch(i){case r.PENDING:m&&(s=[r.UNDER_REPAIR]);break;case r.UNDER_REPAIR:m&&(s=[r.READY]);break;case r.READY:break;case r.CANCELLED:x&&(s=[r.PENDING]);break}return s})(),p=t=>t.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase()),b=t=>{switch(t){case r.PENDING:return"text-yellow-600 bg-yellow-50";case r.UNDER_REPAIR:return"text-blue-600 bg-blue-50";case r.READY:return"text-purple-600 bg-purple-50";case r.CANCELLED:return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}};return e.jsx("div",{className:"flex items-center gap-2",children:f?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Updating..."})]}):e.jsxs("select",{className:`text-xs border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white min-w-[120px] ${b(a.status)}`,value:a.status,onChange:t=>{t.target.value!==a.status&&o(t.target.value)},disabled:n.length===0,children:[e.jsx("option",{value:a.status,children:p(a.status)}),n.map(t=>e.jsx("option",{value:t,children:p(t)},t))]})})},M=()=>{const{page:a,rowsPerPage:l,setTotal:f,renderPagination:d}=C(),u=T(),{selectedBranchId:o,user:R}=v(),[n,p]=h.useState([]),[b,t]=h.useState(!0),i=async()=>{t(!0);try{const s={page:a+1,rowsPerPage:l,...o&&{branch_id:o}},g=await y.get(j.repair_requisition.list,{params:s}),S=g.data?.data||[],N=g.data?.pagination;p(S),N?.total!==void 0&&f(N.total)}catch(s){console.error("Error fetching repair requisitions:",s)}finally{t(!1)}};h.useEffect(()=>{i()},[a,l,o]);const x=R?.role?.role_name||"",m=$(x)||x==="Super Admin";return e.jsx("div",{className:"space-y-6",children:e.jsxs(w,{title:`Repair Requisitions (${n.length})`,createOnClick:m?()=>u(A.REPAIR_REQUISITION.CREATE):void 0,children:[e.jsxs(_,{children:[e.jsx(I,{cols:[{title:"Repair Item"},{title:"Created At"},{title:"Status"},{title:"Actions"}]}),e.jsx("tbody",{children:b&&n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-sm text-gray-500",children:"Loading repair requisitions..."})]})})}):n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"No repair requisitions found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new repair requisition."})]})})}):n.map((s,g)=>e.jsxs(P,{children:[e.jsx(c,{className:"px-5",children:a*l+g+1}),e.jsx(c,{children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.repair_item})}),e.jsx(c,{className:"w-40",children:e.jsx("div",{className:"text-sm text-gray-500",children:D.date(s.created_at)})}),e.jsx(c,{className:"w-40",children:e.jsx(O,{requisition:s,onStatusUpdate:i})}),e.jsx(c,{className:"w-32",children:e.jsxs(L,{children:[e.jsx(U,{onClick:()=>u(`${A.REPAIR_REQUISITION.CREATE}?id=${s.id}`)}),e.jsx(q,{refetch:i,endpoint:j.repair_requisition.delete(s.id)})]})})]},s.id))})]}),n.length>0&&d()]})})};export{M as default};
