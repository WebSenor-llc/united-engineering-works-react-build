import{r as t,j as n,af as _,m as k,h as z,e as O}from"./index-BSu8tAiZ.js";import{C as T}from"./index.esm-Djn9WKK3.js";const A=({options:h,value:g,onChange:x,placeholder:b="Select",disabled:m,error:d,className:w,onSearch:i})=>{const[r,o]=t.useState(!1),[l,u]=t.useState(""),[s,a]=t.useState(""),[p,v]=t.useState({top:0,left:0,width:0}),c=t.useRef(null),E=t.useRef(null),L=t.useRef(null),y=h??[],I=y.find(e=>e.value===g);t.useEffect(()=>{const e=setTimeout(()=>{a(l),i?.(l)},300);return()=>clearTimeout(e)},[l,i]);const C=s.length>=3?y.filter(e=>e.label.toLowerCase().includes(s.toLowerCase())):y,f=()=>{if(c.current){const e=c.current.getBoundingClientRect();v({top:e.bottom+window.scrollY,left:e.left+window.scrollX,width:e.width})}};t.useEffect(()=>(r&&(f(),window.addEventListener("resize",f),window.addEventListener("scroll",f,!0)),()=>{window.removeEventListener("resize",f),window.removeEventListener("scroll",f,!0)}),[r]),t.useEffect(()=>{const e=S=>{const j=S.target,R=c.current?.contains(j),D=E.current?.contains(j);!R&&!D&&(o(!1),u(""))};return r&&document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[r]);const N=()=>r?l:I?.label||"";return n.jsxs("div",{className:"relative w-full",ref:c,children:[n.jsx("input",{ref:L,type:"text",disabled:m,value:N(),placeholder:b,onFocus:()=>{o(!0)},onChange:e=>{u(e.target.value),o(!0)},className:k("disabled:cursor-not-allowed disabled:opacity-80 w-full rounded-lg border px-4 py-3 text-gray-900 focus:outline-none text-sm",d?"border-red-500 focus:ring-2 focus:ring-red-200":"border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500","bg-gray-50",w)}),r&&!m&&_.createPortal(n.jsxs("div",{ref:E,className:"absolute z-[9999] rounded-lg border border-gray-300 bg-white shadow-lg max-h-60 overflow-auto",style:{top:p.top+4,left:p.left,width:p.width,boxShadow:"0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)"},children:[s.length>0&&s.length<3&&n.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"Type at least 3 characters"}),s.length>=3&&C.length===0&&n.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No results found"}),C.map(e=>n.jsx("div",{className:"px-4 py-2 text-sm cursor-pointer hover:bg-blue-50 border-b border-gray-100 last:border-b-0",onMouseDown:S=>{S.preventDefault()},onClick:()=>{x(e.value),o(!1),u("")},children:e.label},e.value))]}),document.body),d&&n.jsx("p",{className:"text-xs text-red-500 mt-1 font-medium",children:d})]})},$=({control:h,name:g,error:x,disabled:b=!1,onChange:m})=>{const[d,w]=t.useState([]),[i,r]=t.useState(!1),[o,l]=t.useState("");t.useEffect(()=>{if(console.log("SEARCH VALUE:",o),o&&o.length<3)return;(async()=>{r(!0);try{const v=((await z.get(O.item_master.all,{params:{search:o}})).data?.items||[]).filter(c=>c.is_active);w(v)}catch(a){console.error("Failed to fetch items",a)}finally{r(!1)}})()},[o]);const u=d.map(s=>({value:s.id,label:`${s.item_name} (${s.item_code})`}));return n.jsx(T,{name:g,control:h,render:({field:s})=>n.jsx(A,{options:u,value:s.value,disabled:b||i,error:x,placeholder:i?"Loading...":"Select Item",onChange:a=>{s.onChange(a),m?.(a)},onSearch:l})})};export{$ as I};
