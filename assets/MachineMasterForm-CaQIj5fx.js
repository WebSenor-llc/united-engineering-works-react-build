import{u as k,i as F,a as I,r as y,j as e,B as p,aq as P,h as u,e as h,y as x,A as N}from"./index-BPpkRjQL.js";import{T as o}from"./TextInput-gfXRTV11.js";import{T as H}from"./TextArea-B4hqIei3.js";import{L}from"./Loading-nJeSTSjR.js";import{o as q,y as B}from"./yup-Cpl6tZUx.js";import{u as D,b as R,C as r}from"./index.esm-CaQR1vU5.js";import{F as U}from"./FormHeader-N4r7k8fv.js";import{g as $}from"./maintenanceUtils-DBVPLXJ6.js";import"./BackButton-DvhqPw91.js";const V={id:null,name:"",number:"",status:"operational",maintenance_date:"",specifications:[],branch_id:null,note:""},Z=()=>{const f=k(),[g]=F(),t=g.get("id")?Number(g.get("id")):void 0,{selectedBranchId:v}=I(),{control:n,handleSubmit:S,reset:_,watch:w,formState:{errors:i}}=D({defaultValues:V,resolver:q(B)}),b=w("maintenance_date"),j=$(b),{fields:d,append:M,remove:C}=R({control:n,name:"specifications"}),[m,l]=y.useState(!1),A=async()=>{if(t){l(!0);try{const a=(await u.get(h.machine_master.details(t))).data,c={id:a.id,name:a.name,number:a.number,status:a.status==="operational"||a.status==="breakdown"?a.status:"operational",maintenance_date:a.maintenance_date?a.maintenance_date.split("T")[0]:"",specifications:a.specifications||[],branch_id:a.branch_id,note:a.note||""};_(c)}catch(s){console.log(s),x.error("Failed to fetch machine details")}finally{l(!1)}}};y.useEffect(()=>{A()},[t]);const E=async s=>{l(!0);try{const a={...s,branch_id:v};await(t?u.put(h.machine_master.update(t),a):u.post(h.machine_master.create,a)),x.success(t?"Machine Updated Successfully":"Machine Created Successfully"),f(N.MACHINE_MASTER.LIST)}catch(a){console.log(a),x.error(a.response?.data?.message||"Failed to save machine")}finally{l(!1)}},T=()=>{f(N.MACHINE_MASTER.LIST)};return e.jsxs("div",{className:"w-full h-full overflow-auto space-y-8 p-4 pb-20",children:[e.jsx(U,{title:t?"Edit Machine":"Create Machine",subtitle:t?"Update machine details":"Add a new machine to the system"}),m&&e.jsx(L,{}),e.jsxs("form",{onSubmit:S(E),className:"space-y-8 mt-8 max-w-full",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsx(r,{control:n,name:"name",render:({field:s})=>e.jsx(o,{required:!0,autoFocus:!0,...s,label:"Machine Name",error:i?.name?.message,placeholder:"Enter Machine Name"})}),e.jsx(r,{control:n,name:"number",render:({field:s})=>e.jsx(o,{required:!0,...s,label:"Machine Model",error:i?.number?.message,placeholder:"Enter Machine Model"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{control:n,name:"maintenance_date",render:({field:s})=>e.jsx(o,{required:!0,...s,type:"date",label:"Next Maintenance Date",error:i?.maintenance_date?.message})}),b&&e.jsxs("div",{className:"flex items-center gap-2 mt-1 px-1",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Status:"}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-bold ${j.badge}`,children:j.text.toUpperCase()})]})]}),e.jsx(r,{control:n,name:"status",render:({field:s})=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...s,onChange:a=>s.onChange(a.target.value==="operational"?"operational":"breakdown"),className:"w-full border border-gray-300 rounded-lg px-3 py-[10px] bg-white text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"operational",children:"Operational"}),e.jsx("option",{value:"breakdown",children:"Breakdown"})]}),i?.status?.message&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.status.message})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Specifications"}),e.jsx(p,{type:"button",variant:"outline",onClick:()=>M({specification_name:"",specification_value:""}),className:"text-sm",children:"+ Add Specification"})]}),d.length>0&&e.jsx("div",{className:"space-y-3",children:d.map((s,a)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 items-end p-4 border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"flex justify-end md:col-span-2",children:e.jsx("button",{type:"button",onClick:()=>C(a),className:"text-red-500 hover:text-red-700 p-1",children:e.jsx(P,{className:"w-4 h-4"})})}),e.jsx(r,{control:n,name:`specifications.${a}.specification_name`,render:({field:c})=>e.jsx(o,{...c,label:"Specification Name",placeholder:"e.g., Power, Weight, etc.",error:i?.specifications?.[a]?.specification_name?.message})}),e.jsx(r,{control:n,name:`specifications.${a}.specification_value`,render:({field:c})=>e.jsx(o,{...c,label:"Specification Value",placeholder:"e.g., 500HP, 2 tons, etc.",error:i?.specifications?.[a]?.specification_value?.message})})]},s.id))}),d.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500 border-2 border-dashed border-gray-200 rounded-lg",children:[e.jsx("p",{children:"No specifications added yet."}),e.jsx("p",{className:"text-sm",children:'Click "Add Specification" to add machine specifications.'})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsx(r,{control:n,name:"note",render:({field:s})=>e.jsx(H,{...s,label:"Note",placeholder:"Add any additional notes or comments about this machine...",rows:3,error:i?.note?.message})})}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx(p,{type:"button",onClick:T,variant:"outline",children:"Cancel"}),e.jsx(p,{type:"submit",loading:m,disabled:m,children:t?"Update Machine":"Create Machine"})]})]})]})};export{Z as default};
