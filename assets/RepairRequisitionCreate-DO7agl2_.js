import{u as D,b as F,r as o,a as L,h as d,e as c,y as m,j as e,B as j,A as _}from"./index-7oOzxGwh.js";import{T as p}from"./TextInput-CNXJtGhb.js";import{S as v}from"./SearchableSelect-CKP118A4.js";import{F as O}from"./FormHeader-BY5PkINd.js";import{u as k,C as n}from"./index.esm-DVCxdrgQ.js";import{u as M}from"./useItemsStore-X5F3ywbu.js";import{u as U}from"./useMachineStore-D_itKuy3.js";import{o as B,C as H}from"./yup-m1ykcdGI.js";import{I as Q}from"./ItemSelect-CQg1xAHN.js";import"./BackButton-D-IQrB5O.js";const ee=()=>{const u=D(),[h]=F(),a=h.get("id")?Number(h.get("id")):void 0,[x,g]=o.useState(!1),[S,y]=o.useState([]),[N,b]=o.useState(!1),{control:i,handleSubmit:I,formState:{errors:s},reset:R}=k({defaultValues:{repair_item:"",product_id:0,machine_id:0,item_id:0,department:"Store Department",description:""},resolver:B(H)}),{machines:E,fetchMachines:P}=U(),{fetchItems:q}=M(),{user:C}=L();o.useEffect(()=>{P(),q(),f()},[]);const f=async(t="")=>{if(!(t&&t.length<3)){b(!0);try{const r=await d.get(c.product_master.all,{params:{search:t}}),l=r.data?.products||r.data||[];y(l)}catch(r){console.error("Error fetching products:",r)}finally{b(!1)}}};o.useEffect(()=>{a&&w()},[a]);const w=async()=>{try{const t=await d.get(c.repair_requisition.details(a)),r=t.data.data||t.data;R({repair_item:r.repair_item||r.repair_item_name,product_id:r.product_id,machine_id:r.machine_id,item_id:r.item_id,department:r.department||r.to||"Store Department",description:r.description||""})}catch(t){console.error("Error loading details:",t),m.error("Failed to load repair requisition details")}},T=async t=>{g(!0);try{const r={...t,created_by:C?.id},l=a?d.put:d.post,A=a?c.repair_requisition.update(a):c.repair_requisition.create;await l(A,r),m.success(`Repair Requisition ${a?"updated":"created"} successfully`),u(_.REPAIR_REQUISITION.LIST)}catch(r){console.error("Error saving repair requisition:",r),m.error(r.response?.data?.message||"Failed to save repair requisition")}finally{g(!1)}};return e.jsx("div",{className:"w-full min-h-screen bg-gray-50 p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(O,{title:`${a?"Edit":"Create"} Repair Requisition`,subtitle:"Fill in the details for the repair requisition."}),e.jsxs("form",{onSubmit:I(T),className:"mt-8 space-y-6",children:[s.root&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded outline-none relative",children:s.root.message}),s.atLeastOne&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded outline-none relative",children:s.atLeastOne.message}),e.jsx("section",{className:"bg-white rounded-lg shadow-sm p-6 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[e.jsx("div",{className:"sm:col-span-2",children:e.jsx(n,{name:"repair_item",control:i,render:({field:t})=>e.jsx(p,{...t,label:"Repair Item",placeholder:"Enter repair item",error:s.repair_item?.message})})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product"}),e.jsx(n,{name:"product_id",control:i,render:({field:t})=>e.jsx(v,{options:S.map(r=>({value:r.id,label:r.name||r.product_name})),value:t.value,onChange:t.onChange,onSearch:f,placeholder:N?"Loading products...":"Search Product",error:s.product_id?.message})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Machine"}),e.jsx(n,{name:"machine_id",control:i,render:({field:t})=>e.jsx(v,{options:E.map(r=>({value:r.id,label:r.name})),value:t.value||void 0,onChange:t.onChange,placeholder:"Select Machine",error:s.machine_id?.message})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Item"}),e.jsx(Q,{control:i,name:"item_id",error:s.item_id?.message})]}),e.jsx("div",{children:e.jsx(n,{name:"department",control:i,render:({field:t})=>e.jsx(p,{...t,label:"Department",readOnly:!0,className:"bg-gray-100 placeholder:text-gray-900"})})}),e.jsx("div",{className:"sm:col-span-2",children:e.jsx(n,{name:"description",control:i,render:({field:t})=>e.jsx(p,{...t,label:"Description",placeholder:"Enter description",error:s.description?.message})})})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(j,{variant:"outline",type:"button",onClick:()=>u(_.REPAIR_REQUISITION.LIST),children:"Cancel"}),e.jsxs(j,{className:"bg-red-600 text-white hover:bg-red-700 transition-colors",type:"submit",loading:x,disabled:x,children:[a?"Update":"Submit"," Repair Requisition"]})]})]})]})})};export{ee as default};
