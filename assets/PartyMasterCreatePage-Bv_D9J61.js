import{u as q,b as I,r as o,j as e,B as S,A as w,h as i,e as d,y as g}from"./index-CW8Rk0MY.js";import{T as m}from"./TextInput-Bk3AXtco.js";import{F as L}from"./FormHeader-DU_wOAiA.js";import{L as R}from"./Loading-B2tKD1y0.js";import{o as U,p as $,e as B}from"./yup-BpuGbvRh.js";import{u as D,C as c}from"./index.esm-w9It4e3N.js";import"./BackButton-C8uoZ6dv.js";const H={party_type:"",party_name:"",company_name:"",address:"",city:"",state:"",pincode:"",gstin:"",contact_person:"",phone:"",credit_limit:null,email:"",country:"",pan:"",bank_name:"",bank_account_number:"",bank_ifsc_code:"",is_active:!0},W=()=>{const h=q(),[P]=I(),a=P.get("id"),[k,f]=o.useState(!1),[b,j]=o.useState(!1),[p,E]=o.useState([]),[u,_]=o.useState([]),[v,N]=o.useState([]),{control:l,handleSubmit:T,reset:A,watch:C,formState:{errors:n}}=D({defaultValues:H,resolver:U(a?$:B)}),x=C("country"),y=C("state");o.useEffect(()=>{(async()=>{try{const t=await i.get(d.party_master.countries);E(t.data.countries||[])}catch(t){console.error("Failed to fetch countries",t)}})()},[]),o.useEffect(()=>{if(!x){_([]);return}(async()=>{const t=p.find(r=>r.name===x);if(t)try{const r=await i.get(`${d.party_master.states}?country=${t.name}`);_(r.data.states||r.data||[])}catch(r){console.error("Failed to fetch states",r)}})()},[x,p]),o.useEffect(()=>{if(!y){N([]);return}(async()=>{const t=u.find(r=>r.name===y);if(t)try{const r=await i.get(`${d.party_master.cities}?state=${t.name}`);N(r.data.cities||r.data||[])}catch(r){console.error("Failed to fetch cities",r)}})()},[y,u]);const F=async()=>{if(a){f(!0);try{const t=(await i.get(d.party_master.details(Number(a)))).data.party;A({party_type:t.party_type||"",party_name:t.party_name||"",company_name:t.company_name||"",address:t.address||"",city:t.city||"",state:t.state||"",pincode:t.pincode||"",gstin:t.gstin||"",contact_person:t.contact_person||"",phone:t.phone||"",credit_limit:t.credit_limit??null,email:t.email||"",country:t.country||"",pan:t.pan||"",bank_name:t.bank_name||"",bank_account_number:t.bank_account_number||"",bank_ifsc_code:t.bank_ifsc_code||"",is_active:t.is_active??!0})}catch(s){console.error("Failed to load party details:",s),g.error("Failed to load party details")}finally{f(!1)}}};o.useEffect(()=>{a&&F()},[a]);const M=async s=>{j(!0);try{const t=a?{id:Number(a),party_name:s.party_name,party_type:s.party_type,contact_person:s.contact_person,phone:s.phone,credit_limit:s.credit_limit??null,is_active:s.is_active,company_name:s.company_name||"",address:s.address||""}:s,r=a?d.party_master.update(Number(a)):d.party_master.create;await(a?i.put:i.post)(r,t),g.success(a?"Party Updated Successfully":"Party Created Successfully"),h(w.PARTY_MASTER.LIST)}catch(t){console.error(t),g.error(t.response?.data?.message||"Failed to save party")}finally{j(!1)}};return k?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(R,{})}):e.jsxs("div",{className:"w-full h-full overflow-auto space-y-8 p-4 pb-20",children:[e.jsx("div",{className:"space-y-1 ml-2",children:e.jsx(L,{title:a?"Edit Party Master":"Create Party Master",subtitle:a?"Update the party master details":"Fill out the form to create a new party master"})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mx-2",children:e.jsxs("form",{onSubmit:T(M),children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[!a&&e.jsx(c,{name:"party_type",control:l,render:({field:s})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["Party Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...s,className:"w-full rounded-lg border border-gray-300 mt-1 px-3 py-3 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"Select Party Type"}),e.jsx("option",{value:"vendor",children:"Vendor"}),e.jsx("option",{value:"customer",children:"Customer"})]}),n?.party_type?.message&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.party_type.message})]})}),e.jsx(c,{name:"party_name",control:l,render:({field:s})=>e.jsx(m,{required:!0,...s,label:"Party Name",error:n?.party_name?.message})}),e.jsx(c,{name:"contact_person",control:l,render:({field:s})=>e.jsx(m,{required:!0,...s,label:"Contact Person",error:n?.contact_person?.message})}),!a&&e.jsx(c,{name:"company_name",control:l,render:({field:s})=>e.jsx(m,{required:!0,...s,label:"Company Name",error:n?.company_name?.message})}),!a&&e.jsx(c,{name:"address",control:l,render:({field:s})=>e.jsx(m,{required:!0,...s,label:"Address",error:n?.address?.message})}),!a&&e.jsx(c,{name:"country",control:l,render:({field:s})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["Country ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...s,className:"w-full rounded-lg border border-gray-300 mt-1 px-3 py-3 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"Select Country"}),p.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id||t.name))]}),n?.country?.message&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.country.message})]})}),!a&&e.jsx(c,{name:"state",control:l,render:({field:s})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["State ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...s,disabled:!u.length,className:"w-full rounded-lg border border-gray-300 mt-1 px-3 py-3 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white disabled:bg-gray-100",children:[e.jsx("option",{value:"",children:"Select State"}),u.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id||t.name))]}),n?.state?.message&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.state.message})]})}),!a&&e.jsx(c,{name:"city",control:l,render:({field:s})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["City ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...s,disabled:!v.length,className:"w-full rounded-lg border border-gray-300 mt-1 px-3 py-3 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white disabled:bg-gray-100",children:[e.jsx("option",{value:"",children:"Select City"}),v.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id||t.name))]}),n?.city?.message&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.city.message})]})}),!a&&e.jsx(c,{name:"pincode",control:l,render:({field:s})=>e.jsx(m,{required:!0,...s,label:"Pincode",error:n?.pincode?.message})}),e.jsx(c,{name:"phone",control:l,render:({field:s})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["Mobile No ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-3 py-3 bg-gray-100 border border-gray-300 rounded-lg text-gray-700 text-sm",children:"+91"}),e.jsx("input",{...s,type:"tel",maxLength:10,placeholder:"Enter 10 digit mobile number",className:"flex-1 w-full rounded-lg border border-gray-300 px-3 py-3 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:t=>{const r=t.target.value.replace(/\D/g,"");s.onChange(r)}})]}),n?.phone?.message&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.phone.message})]})}),!a&&e.jsx(c,{name:"email",control:l,render:({field:s})=>e.jsx(m,{required:!0,...s,label:"Email",type:"email",error:n?.email?.message})}),e.jsx(c,{control:l,name:"is_active",render:({field:s})=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:["Is Active ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...s,value:s.value?"true":"false",onChange:t=>s.onChange(t.target.value==="true"),className:"w-full border border-gray-300 rounded-lg px-3 py-3 bg-white text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[e.jsx(S,{type:"button",onClick:()=>h(w.PARTY_MASTER.LIST),variant:"outline",children:"Cancel"}),e.jsx(S,{type:"submit",loading:b,disabled:b,className:"bg-red-600 text-white",children:a?"Update Party":"Create Party"})]})]})})]})};export{W as default};
