import{r as m,a6 as A,j as e,h as w,e as f,y as x,u as P,a as R,k,D as y,P as _,A as T}from"./index-Dpd7qybE.js";import{L as D}from"./ListWrapper-BE1d8M7S.js";import{T as E,a as U,b as r}from"./TableWrapper-DtKbbg8N.js";import{T as F}from"./TableRow-DkGT6S5k.js";import{T as B,a as $}from"./TableDelete-DH9r8gXr.js";import{T as W}from"./TableEdit-CDNZJjSB.js";import{T as H}from"./TableDownload-C7K3Z2iU.js";import{L as z}from"./Loading-rkjgGfkz.js";import{u as M}from"./usePagination-CTvTl5R7.js";import{S as V}from"./StatusFilter-Bsem3JQO.js";const G=({jobOrder:o,onStatusUpdate:u})=>{const[g,h]=m.useState(!1),b=async t=>{h(!0);try{await w.post(f.job_order.statusActions,{job_card_id:o.job_card_id,status:t}),x.success("Status updated successfully"),u()}catch(n){console.error("Failed to update status:",n),x.error(n.response?.data?.message||"Failed to update status")}finally{h(!1)}},i=Object.values(A).filter(t=>t!==o.status);return e.jsx("div",{className:"flex items-center gap-2",children:g?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Updating..."})]}):e.jsxs("select",{className:"text-xs border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white min-w-[120px]",value:o.status,onChange:t=>{t.target.value!==o.status&&b(t.target.value)},disabled:i.length===0,children:[e.jsx("option",{value:o.status,children:o.status.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}),i.map(t=>e.jsx("option",{value:t,children:t.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase())},t))]})})},te=()=>{const{renderPagination:o}=M(),u=P(),{selectedBranchId:g,user:h}=R(),{setJobOrders:b}=k(),[i,t]=m.useState([]),[n,v]=m.useState(!1),[c,J]=m.useState(""),N=async()=>{v(!0);try{const a=(await w.get(f.job_order.list)).data?.job_cards||[];t(a);const d=h?.role?.role_name;if(d==="Workshop Supervisor"||d==="Super Admin"){const l=a.filter(j=>j.status==="pending").length;b(l)}}catch(s){console.error("Failed to fetch job orders:",s),x.error("Failed to fetch job orders")}finally{v(!1)}},L=async s=>{try{const a=await w.get(f.job_order.download(s),{responseType:"blob"}),d=window.URL.createObjectURL(new Blob([a.data])),l=document.createElement("a");l.href=d;const j=a.headers["content-disposition"];let S=`job-card-${s}.pdf`;if(j){const C=j.match(/filename="(.+)"/);C&&(S=C[1])}l.setAttribute("download",S),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(d),x.success("Job card downloaded successfully")}catch(a){console.error("Failed to download job card:",a),x.error(a.response?.data?.message||"Failed to download job card")}};m.useEffect(()=>{N()},[g]);const p=c?i.filter(s=>s.status===c):i;return n?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(z,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(V,{module:"JobOrderStatus",selectedStatus:c,onChange:J}),e.jsxs(D,{title:`Job Orders (${p.length})`,createOnClick:_.hasPermission("job_card_management_create")?()=>u(T.JOB_ORDER.CREATE):void 0,children:[e.jsxs(E,{children:[e.jsx(U,{cols:[{title:"Job Card No"},{title:"Job Name"},{title:"Customer"},{title:"Job Date"},{title:"Expected Delivery"},{title:"Job Type"},{title:"Created At"},{title:"Status"},{title:"Actions"}]}),e.jsx("tbody",{children:n?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Loading job orders..."})]})})}):p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No job orders"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:c?`No job orders found with status "${c}"`:"Get started by creating a new job order."})]})})}):p.map((s,a)=>e.jsxs(F,{children:[e.jsx(r,{className:"w-12 text-center font-medium",children:e.jsx("div",{className:"text-sm text-gray-900",children:a+1})}),e.jsx(r,{className:"w-40",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.job_card_number||"-"})})}),e.jsx(r,{className:"w-48",children:e.jsx("div",{className:"text-sm text-gray-900",children:s.job_name||"-"})}),e.jsx(r,{className:"w-48",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.customer?.party_name||s.customer_name||"â€”"})})})}),e.jsx(r,{className:"w-32",children:e.jsx("div",{className:"text-sm text-gray-900",children:y.date(s.job_date)})}),e.jsx(r,{className:"w-32",children:e.jsx("div",{className:"text-sm text-gray-900",children:y.date(s.expected_delivery_date)})}),e.jsx(r,{className:"w-32",children:e.jsx("span",{className:"capitalize text-sm text-gray-900",children:s.job_type?.replace(/_/g," ")||"-"})}),e.jsx(r,{className:"w-32",children:e.jsx("div",{className:"text-sm text-gray-500",children:y.date(s.created_at)})}),e.jsx(r,{className:"w-40",children:e.jsx(G,{jobOrder:{job_card_id:s.id,status:s.status},onStatusUpdate:N})}),e.jsx(r,{className:"w-20",children:e.jsxs(B,{children:[_.hasPermission("job_card_management_update")&&e.jsx(W,{onClick:()=>u(`${T.JOB_ORDER.CREATE}?editId=${s.id}`)}),e.jsx(H,{onClick:()=>L(s.id)}),_.hasPermission("job_card_management_delete")&&e.jsx($,{refetch:N,endpoint:f.job_order.delete(s.id)})]})})]},s.id))})]}),p.length>0&&o()]})]})};export{te as default};
