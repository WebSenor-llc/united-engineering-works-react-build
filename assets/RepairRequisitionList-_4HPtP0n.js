const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-pdf.browser-D77kvrqE.js","assets/index-BYQAWDKy.js","assets/index-BuVjEwMM.css","assets/RepairRequisitionPDF-BDZq9ImT.js"])))=>i.map(i=>d[i]);
import{r as f,a as w,j as e,h as y,e as R,y as b,u as I,D as T,P as N,A as g,_ as A}from"./index-BYQAWDKy.js";import{L as q}from"./ListWrapper-q3P9wLfd.js";import{T as x}from"./TableData-DZNs_4QR.js";import{T as L,a as C}from"./TableWrapper-DjDxEdMk.js";import{T as U}from"./TableRow-CZT0r12O.js";import{u as F}from"./usePagination-mbYd4YyL.js";import{T as k}from"./TableActions-C8GQDS6Q.js";import{T as $}from"./TableEdit-BsbWn9Ja.js";import{T as O}from"./TableDelete-C2uArd9V.js";import{T as G,a as V}from"./TableDownload-BebLkM4J.js";import{c as r}from"./enum-SoLNwffs.js";import{c as Y,a as Q}from"./rolePermissions-BvMMyxfj.js";const B=({requisition:s,onStatusUpdate:c})=>{const[E,m]=f.useState(!1),{user:d}=w(),n=async a=>{m(!0);try{await y.post(R.repair_requisition.statusActions(s.id),{repair_requisition_id:s.id,status:a}),b.success("Status updated successfully"),c()}catch(t){console.error("Failed to update status:",t),b.error(t.response?.data?.message||"Failed to update status")}finally{m(!1)}},h=(()=>{const a=d?.role?.role_name,t=s.status,i=Y(a||""),l=Q(a||"")||a==="Super Admin";let o=[];switch(t){case r.PENDING:l&&(o=[r.UNDER_REPAIR]);break;case r.UNDER_REPAIR:l&&(o=[r.READY]);break;case r.READY:break;case r.CANCELLED:i&&(o=[r.PENDING]);break}return o})(),u=a=>a.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase()),j=a=>{switch(a){case r.PENDING:return"text-yellow-600 bg-yellow-50";case r.UNDER_REPAIR:return"text-blue-600 bg-blue-50";case r.READY:return"text-purple-600 bg-purple-50";case r.CANCELLED:return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}};return e.jsx("div",{className:"flex items-center gap-2",children:E?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Updating..."})]}):e.jsxs("select",{className:`text-xs border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white min-w-[120px] ${j(s.status)}`,value:s.status,onChange:a=>{a.target.value!==s.status&&n(a.target.value)},disabled:h.length===0,children:[e.jsx("option",{value:s.status,children:u(s.status)}),h.map(a=>e.jsx("option",{value:a,children:u(a)},a))]})})},ie=()=>{const{page:s,rowsPerPage:c,setTotal:E,renderPagination:m}=F(),d=I(),[n,D]=f.useState([]),[h,u]=f.useState(!0),j=async t=>{try{const i=await y.get(R.repair_requisition.details(t));return i.data?.data||i.data}catch(i){return console.error("Error fetching repair requisition for PDF:",i),b.error("Failed to fetch repair requisition details for PDF"),null}},a=async()=>{u(!0);try{const t={page:s+1,per_page:c},i=await y.get(R.repair_requisition.list,{params:t}),l=i.data?.data||[],o=i.data?.pagination;D(l),o?.last_page!==void 0&&E(o.last_page)}catch(t){console.error("Error fetching repair requisitions:",t)}finally{u(!1)}};return f.useEffect(()=>{a()},[s,c]),e.jsx("div",{className:"space-y-6",children:e.jsxs(q,{title:`Repair Requisitions (${n.length})`,createOnClick:N.hasPermission("inhouse_repair_create")?()=>d(g.REPAIR_REQUISITION.CREATE):void 0,children:[e.jsxs(L,{children:[e.jsx(C,{cols:[{title:"Repair Item"},{title:"Created At"},{title:"Status"},{title:"Actions"}]}),e.jsx("tbody",{children:h&&n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-sm text-gray-500",children:"Loading repair requisitions..."})]})})}):n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"No repair requisitions found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new repair requisition."})]})})}):n.map((t,i)=>e.jsxs(U,{children:[e.jsx(x,{className:"px-5",children:s*c+i+1}),e.jsx(x,{children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.repair_item})}),e.jsx(x,{className:"w-40",children:e.jsx("div",{className:"text-sm text-gray-500",children:T.date(t.created_at)})}),e.jsx(x,{className:"w-40",children:e.jsx(B,{requisition:t,onStatusUpdate:a})}),e.jsx(x,{className:"w-32",children:e.jsxs(k,{children:[e.jsx(G,{url:`${g.REPAIR_REQUISITION.DETAILS.replace(":id","")}${t.id}`,tooltip:"View Repair Requisition Details"}),e.jsx(V,{onClick:async()=>{const l=await j(t.id);if(l)try{const{pdf:o}=await A(async()=>{const{pdf:_}=await import("./react-pdf.browser-D77kvrqE.js");return{pdf:_}},__vite__mapDeps([0,1,2])),{default:v}=await A(async()=>{const{default:_}=await import("./RepairRequisitionPDF-BDZq9ImT.js");return{default:_}},__vite__mapDeps([3,1,2,0])),S=await o(e.jsx(v,{repairRequisition:l})).toBlob(),P=URL.createObjectURL(S),p=document.createElement("a");p.href=P,p.download=`Repair-Requisition-${t.id}.pdf`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(P)}catch(o){console.error("Error generating PDF:",o),b.error("Failed to generate PDF")}},title:"Download Repair Requisition PDF"}),t.status===r.READY&&e.jsx("button",{onClick:()=>d(`${g.REPAIR_ISSUE_SLIP.CREATE}?requisitionId=${t.id}`),className:"text-blue-600 hover:text-blue-800 text-sm font-medium px-2 py-1 rounded hover:bg-blue-50 transition-colors",title:"Issue Slip",children:"Issue Slip"}),N.hasPermission("inhouse_repair_update")&&e.jsx($,{onClick:()=>d(`${g.REPAIR_REQUISITION.CREATE}?id=${t.id}`)}),N.hasPermission("inhouse_repair_delete")&&e.jsx(O,{refetch:a,endpoint:R.repair_requisition.delete(t.id)})]})})]},t.id))})]}),n.length>0&&m()]})})};export{ie as default};
