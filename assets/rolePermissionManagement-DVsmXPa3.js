import{i as R,u as A,r as n,y as c,h as g,e as u,j as e,I as B,B as f}from"./index-K9d2s2ak.js";import{L}from"./ListWrapper-BJunTYp4.js";import{L as U}from"./Loading-BgP_rkDi.js";import{B as _}from"./BackButton-pmq9AY_B.js";function q(){const{roleId:l}=R(),m=A(),[y,b]=n.useState({}),[a,p]=n.useState(new Set),[j,h]=n.useState(!1),[d,x]=n.useState(!1),[N,v]=n.useState("");n.useEffect(()=>{if(!l){c.error("Role ID is required"),m("/role-management/list");return}w()},[l]);const w=async()=>{h(!0);try{const r=await g.get(u.permission.permissions);r?.data?.grouped_permissions&&b(r.data.grouped_permissions);const s=await g.get(u.permission.update(Number(l)));if(s?.data?.role&&(v(s.data.role.role_name||""),s.data.role.permissions&&Array.isArray(s.data.role.permissions))){const t=s.data.role.permissions.map(i=>typeof i=="number"?i:i.id);p(new Set(t))}}catch(r){console.error("Error fetching permissions:",r),c.error("Failed to load permissions")}finally{h(!1)}},S=r=>{const s=new Set(a);s.has(r)?s.delete(r):s.add(r),p(s)},P=r=>{const s=r.map(o=>o.id),t=s.every(o=>a.has(o)),i=new Set(a);t?s.forEach(o=>i.delete(o)):s.forEach(o=>i.add(o)),p(i)},k=r=>r.every(s=>a.has(s.id)),C=r=>{const s=r.filter(t=>a.has(t.id)).length;return s>0&&s<r.length},E=r=>r.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),M=async()=>{if(l){x(!0);try{const r={permissions:Array.from(a)};await g.put(u.permission.update(Number(l)),r),c.success("Permissions updated successfully"),setTimeout(()=>{m("/role-management/list")},1e3)}catch(r){console.error("Error updating permissions:",r),c.error("Failed to update permissions")}finally{x(!1)}}};return j?e.jsx(U,{}):e.jsxs(L,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h1",{className:"text-lg font-semibold",children:["Manage Permissions - ",N]}),e.jsx(_,{})]}),e.jsxs("div",{className:"mt-6 space-y-6",children:[Object.entries(y).map(([r,s])=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:E(r)}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:k(s),ref:t=>{t&&(t.indeterminate=C(s))},onChange:()=>P(s),className:"w-5 h-5 text-primary border-gray-300 rounded focus:ring-primary focus:ring-2 cursor-pointer"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 group-hover:text-primary transition-colors",children:"Select All"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(t=>e.jsxs("label",{className:`flex items-start gap-3 p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 ${a.has(t.id)?"border-primary bg-red-50":"border-gray-200 bg-white hover:border-gray-300 hover:bg-gray-50"}`,children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{type:"checkbox",checked:a.has(t.id),onChange:()=>S(t.id),className:"w-5 h-5 text-primary border-gray-300 rounded focus:ring-primary focus:ring-2 cursor-pointer"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-800 capitalize",children:t.action.replace(/_/g," ")}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:t.description})]})]},t.id))})})]},r)),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"text-green-600 w-5 h-5"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[a.size," permission",a.size!==1?"s":""," selected"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(f,{variant:"outline",onClick:()=>m("/role-management/list"),disabled:d,children:"Cancel"}),e.jsx(f,{onClick:M,loading:d,disabled:d,className:"flex items-center gap-2",children:d?"Updating...":"Update Permissions"})]})]})})]})]})}export{q as default};
