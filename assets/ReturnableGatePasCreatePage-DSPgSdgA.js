import{u as U,i as O,a as H,r as p,j as e,B as f,A as j,h as y,e as g,y as b}from"./index-Kefaop-A.js";import{T as c}from"./TextInput-B58h13Ad.js";import{L as V}from"./ListWrapper-DlZ8qXu3.js";import{T as W}from"./TableActions-CAwi2Fu4.js";import{I as J}from"./ItemSelect-CikVrIuI.js";import{T as Q,a as z,b as u}from"./TableWrapper-B_u-I_AE.js";import{T as K}from"./TableDelete-B-y0vUJi.js";import{u as M,b as X,C as n}from"./index.esm-vlneu0i-.js";import{o as Y,q as Z}from"./yup-DzfhvPhS.js";import{u as D}from"./useItemsStore-CnkOl88e.js";import{F as ee}from"./FormHeader-C5lpDi-J.js";import{L as se}from"./Loading-BMeDUOiY.js";import{u as ae}from"./usePartyStore-xtOQp9xd.js";import{S as te}from"./Select-DbUKfexl.js";import{u as re}from"./useBranchStore-2zvNrOed.js";import"./SearchableSelect-D143fGLy.js";import"./BackButton-BFdUVkcw.js";const R={branch_name:"",branch_address:"",party_name:"",party_address:"",employee_name:"",employee_address:"",purpose:"",vehicle_number:"",driver:"",items:[{item_id:0,item_name:"",item_code:"",item_unit:"",item_description:"",quantity_out:0}]},Ne=()=>{const x=U(),[C]=O(),d=C.get("editId"),{selectedBranchId:N,user:h}=H(),{parties:v,fetchParties:P}=ae(),{branches:G,fetchBranches:w}=re(),[k,A]=p.useState(!1),[_,S]=p.useState(!1),{control:r,handleSubmit:B,setValue:o,reset:E,formState:{errors:l}}=M({resolver:Y(Z),defaultValues:R}),{fields:I,append:q,remove:L}=X({control:r,name:"items"}),{items:$,fetchItems:T}=D();p.useEffect(()=>{T(),P(),w()},[T,P,w]),p.useEffect(()=>{h?.branch&&(o("branch_name",h.branch.branch_name||""),o("branch_address",h.branch.address||""))},[h,o]),p.useEffect(()=>{if(!d)return;(async()=>{A(!0);try{const a=await y.get(g.returnable_gate_pass.details(parseInt(d,10))),t=a.data?.gate_pass||a.data?.data||a.data,m=t.items?.map(i=>({item_id:i.item_id||0,item_name:i.item?.item_name||"",item_code:i.item?.item_code||"",item_unit:i.item?.unit?.unit_name||"",item_description:i.item_description||"",quantity_out:i.quantity_out||0}))||R.items;E({branch_name:t.branch_id?.toString()||"",branch_address:t.branch?.address||"",party_name:t.party_name||"",party_address:t.party_contact||"",employee_name:t.emp_name||"",employee_address:t.emp_address||"",purpose:t.purpose||"",vehicle_number:t.vehicle_number||"",driver:t.driver_name||"",items:m})}catch(a){console.error(a),b.error("Failed to load gate pass details"),x(j.RETURNABLE_GATEPAS.LIST)}finally{A(!1)}})()},[d,E,N,x]);const F=async s=>{const a={branch_id:N,purpose:s.purpose,party_name:s.party_name,emp_name:s.employee_name,emp_address:s.employee_address,vehicle_number:s.vehicle_number,driver_name:s.driver,items:s.items.map(t=>({item_id:t.item_id,quantity_out:Number(t.quantity_out),item_description:t.item_description}))};try{S(!0),d?(await y.put(g.returnable_gate_pass.update(parseInt(d,10)),a),b.success("Returnable Gate Pass updated successfully!")):(await y.post(g.returnable_gate_pass.create,a),b.success("Returnable Gate Pass created successfully!")),x(j.RETURNABLE_GATEPAS.LIST)}catch(t){console.error("Error submitting:",t),b.error(t.response?.data?.message||`Failed to ${d?"update":"create"} returnable gate pass`)}finally{S(!1)}};return k?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(se,{})}):e.jsxs("div",{className:"w-full h-full overflow-auto space-y-6 md:space-y-8 p-2 md:p-4 pb-20",children:[e.jsx("div",{className:"space-y-1 px-2 md:px-0 md:ml-2",children:e.jsx(ee,{title:d?"Edit Returnable Gate Pass":"Create Returnable Gate Pass",subtitle:d?"Update the Returnable Gate Pass details":"Fill out the form to submit a new Returnable Gate Pass."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-5 px-2 md:px-0 md:ml-2 md:mr-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Party Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"party_name",control:r,render:({field:s})=>e.jsxs("select",{...s,value:s.value||"",className:"w-full h-[44px] border border-gray-300 rounded-lg text-sm px-4 py-2 mt-1 focus:outline-none  focus:border-blue-500 focus:ring-2 focus:ring-blue-500 bg-white",onChange:a=>{const t=a.target.value;s.onChange(t);const m=v.find(i=>i.company_name===t);m?o("party_address",m.address||""):o("party_address","")},children:[e.jsx("option",{value:"",children:"Select party for gate pass"}),v.map(a=>e.jsx("option",{value:a.company_name,children:a.company_name},a.id))]})}),l.party_name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.party_name.message})]}),e.jsx(n,{name:"party_address",control:r,render:({field:s})=>e.jsx(c,{...s,label:"Party Address",placeholder:"Auto-filled from selected party",error:l.party_address?.message,readOnly:!0})}),e.jsx(n,{name:"branch_name",control:r,render:({field:s})=>e.jsxs(te,{...s,label:"Branch",required:!0,error:l.branch_name?.message,children:[e.jsx("option",{value:"",children:"Select Branch"}),G.map(a=>e.jsx("option",{value:a.id,children:a.branch_name},a.id))]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Branch Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"branch_address",control:r,render:({field:s})=>e.jsx(c,{...s,placeholder:"Enter branch address",error:l.branch_address?.message})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Employee Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"employee_name",control:r,render:({field:s})=>e.jsx(c,{...s,placeholder:"Enter employee name",error:l.employee_name?.message})})]}),e.jsx(n,{name:"employee_address",control:r,render:({field:s})=>e.jsx(c,{...s,label:"Employee Address",placeholder:"Enter employee address",error:l.employee_address?.message})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Purpose ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"purpose",control:r,render:({field:s})=>e.jsx(c,{...s,placeholder:"Enter purpose of gate pass",error:l.purpose?.message})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Vehicle Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"vehicle_number",control:r,render:({field:s})=>e.jsx(c,{...s,placeholder:"e.g., RJ14AB1234",error:l.vehicle_number?.message})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Driver Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"driver",control:r,render:({field:s})=>e.jsx(c,{...s,placeholder:"Enter driver name",error:l.driver?.message})})]})]}),e.jsx("div",{className:"px-2 md:px-0",children:e.jsxs(V,{title:"Items Requested",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(f,{className:"bg-red-600 text-white px-3 py-1 text-sm",onClick:()=>q({item_id:0,item_name:"",item_code:"",item_unit:"",item_description:"",quantity_out:0}),children:"+ Add Item"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Q,{children:[e.jsx(z,{cols:[{title:"Item Name"},{title:"Item Code"},{title:"Item Unit"},{title:"Out Qty"},{title:"Remarks"},{title:"Action"}]}),e.jsx("tbody",{children:I.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8 text-gray-500",children:'No items added. Click "Add Item" to get started.'})}):I.map((s,a)=>e.jsxs("tr",{className:"align-middle",children:[e.jsx(u,{className:"text-center w-12",children:a+1}),e.jsx(u,{className:"min-w-[120px]",children:e.jsx(J,{control:r,name:`items.${a}.item_id`,onChange:t=>{const m=$.find(i=>i.id===t);m&&(o(`items.${a}.item_id`,m.id),o(`items.${a}.item_code`,m.item_code),o(`items.${a}.item_name`,m.item_name),o(`items.${a}.item_unit`,m.unit?.unit_name||""))}})}),e.jsx(u,{className:"min-w-[120px]",children:e.jsx(n,{name:`items.${a}.item_code`,control:r,render:({field:t})=>e.jsx("input",{...t,className:"w-full h-10 border focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none  rounded-lg px-3 text-sm bg-gray-50",placeholder:"Auto-filled",readOnly:!0})})}),e.jsx(u,{className:"min-w-[100px]",children:e.jsx(n,{name:`items.${a}.item_unit`,control:r,render:({field:t})=>e.jsx("input",{...t,className:"w-full h-10 border focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none  rounded-lg px-3 text-sm bg-gray-50",placeholder:"Auto-filled",readOnly:!0})})}),e.jsx(u,{className:"min-w-[120px]",children:e.jsx(n,{name:`items.${a}.quantity_out`,control:r,render:({field:t})=>e.jsx("input",{...t,type:"number",min:"0",step:"0.01",className:"w-full h-10 border focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none  rounded-lg px-3 text-sm bg-gray-50",placeholder:"Enter qty"})})}),e.jsx(u,{className:"min-w-[150px]",children:e.jsx(n,{name:`items.${a}.item_description`,control:r,render:({field:t})=>e.jsx("input",{...t,className:"w-full h-10 border focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none  rounded-lg px-3 text-sm bg-gray-50",placeholder:"Add remarks"})})}),e.jsx(u,{children:e.jsx(W,{children:e.jsx(K,{onClick:()=>L(a)})})})]},s.id))})]})})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 px-2 md:px-0 md:mr-4",children:[e.jsx(f,{variant:"outline",className:"w-full sm:w-auto",onClick:()=>x(j.RETURNABLE_GATEPAS.LIST),disabled:_,children:"Cancel"}),e.jsx(f,{className:"bg-red-600 text-white w-full sm:w-auto",onClick:B(F),loading:_,disabled:_,children:d?"Update Gate Pass":"Submit Gate Pass"})]})]})};export{Ne as default};
