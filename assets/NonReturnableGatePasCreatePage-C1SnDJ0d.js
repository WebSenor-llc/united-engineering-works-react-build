import{u as H,i as V,a as C,r as b,j as e,B as _,A as g,h as y,e as N,y as f}from"./index-gVZAAP-J.js";import{T as m}from"./TextInput-Dl06c-zo.js";import{L as W}from"./ListWrapper-CDXR4yYu.js";import{T as J}from"./TableActions-CBCEPdci.js";import{T as Q,a as z,b as c}from"./TableWrapper-D8zDqKY_.js";import{T as K}from"./TableDelete-Cqy9W1lx.js";import{u as M,b as X,C as n}from"./index.esm-ClmqLBPc.js";import{F as Y}from"./FormHeader-CUljfwm3.js";import{L as Z}from"./Loading-D4JR0vbX.js";import{u as ee}from"./useItemsStore-Dn5a47RR.js";import{u as se}from"./usePartyStore-BzxulE78.js";import{S as ae}from"./Select-Dkl4_rZk.js";import{u as te}from"./useBranchStore-BSTnGOW-.js";import"./BackButton-DNCViUTp.js";const R={party_name:"",party_address:"",branch_id:"",branch_name:"",branch_address:"",emp_name:"",emp_address:"",purpose:"",vehicle_number:"",driver_name:"",items:[{item_id:"",item_name:"",item_code:"",item_unit:"",quantity_out:"",item_description:""}]},je=()=>{const u=H(),[G]=V(),l=G.get("editId"),{user:o}=C(),{items:v,fetchItems:p}=ee(),{parties:w,fetchParties:A}=se(),{branches:k,fetchBranches:P}=te(),[B,S]=b.useState(!1),[j,E]=b.useState(!1),{selectedBranchId:L}=C(),{control:r,handleSubmit:$,reset:T,setValue:d,formState:{errors:F}}=M({defaultValues:R}),{fields:I,append:O,remove:q}=X({control:r,name:"items"});b.useEffect(()=>{p(),A(),P(),o?.branch&&(d("branch_name",o.branch.branch_name||""),d("branch_address",o.branch.address||""))},[o,d,p,A,P]),b.useEffect(()=>{if(!l)return;(async()=>{S(!0);try{const s=await y.get(N.non_returnable_gate_pass.details(parseInt(l,10))),a=s.data?.gate_pass||s.data?.data||s.data;console.log("object",a),T({party_name:a.party_name||"",party_address:a.party_address||"",branch_name:a.branch_name||"",branch_address:a.branch_address||"",emp_name:a.emp_name||"",emp_address:a.emp_address||"",purpose:a.purpose||"",vehicle_number:a.vehicle_number||"",driver_name:a.driver_name||"",items:a.items&&a.items.length>0?a.items:R.items})}catch(s){console.error(s),f.error("Failed to load gate pass details"),u(g.NON_RETURNABLE_GATEPAS.LIST)}finally{S(!1)}})(),p()},[l,T,u,p,L]);const U=async t=>{E(!0);try{const s={...t,branch_id:t.branch_id||o?.branch?.id};l?(await y.put(N.non_returnable_gate_pass.update(parseInt(l,10)),s),f.success("Gate pass updated successfully")):(await y.post(N.non_returnable_gate_pass.create,s),f.success("Gate pass created successfully")),u(g.NON_RETURNABLE_GATEPAS.LIST)}catch(s){console.error(s),f.error(s.response?.data?.message||"Failed to save gate pass")}finally{E(!1)}};return B?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(Z,{})}):e.jsxs("div",{className:"w-full h-full overflow-auto space-y-6 md:space-y-8 p-2 md:p-4 pb-20",children:[e.jsx("div",{className:"space-y-1 px-2 md:px-0 md:ml-2",children:e.jsx(Y,{title:l?"Edit Non Returnable Gate Pass":"Create Non Returnable Gate Pass",subtitle:l?"Update the Non Returnable Gate Pass details":"Fill out the form to create a new Non Returnable Gate Pass"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-5 px-2 md:px-0 md:ml-2 md:mr-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Party Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"party_name",control:r,render:({field:t})=>e.jsxs("select",{...t,value:t.value||"",className:"w-full h-[42px] border border-gray-300 rounded-lg text-sm px-3 focus:outline-none  focus:border-blue-500 focus:ring-2 focus:ring-blue-500 bg-white",onChange:s=>{const a=s.target.value;t.onChange(a);const i=w.find(x=>x.company_name===a);i?d("party_address",i.address||""):d("party_address","")},children:[e.jsx("option",{value:"",children:"Select party for gate pass"}),w.map(s=>e.jsx("option",{value:s.company_name,children:s.company_name},s.id))]})})]}),e.jsx(n,{name:"party_address",control:r,render:({field:t})=>e.jsx(m,{...t,label:"Party Address",placeholder:"Auto-filled from selected party",readOnly:!0})}),e.jsx(n,{name:"branch_id",control:r,render:({field:t})=>e.jsxs(ae,{...t,label:"Branch",required:!0,error:F.branch_id?.message,children:[e.jsx("option",{value:"",children:"Select Branch"}),k.map(s=>e.jsx("option",{value:s.id,children:s.branch_name},s.id))]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Branch Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"branch_address",control:r,render:({field:t})=>e.jsx(m,{...t,placeholder:"Enter branch address"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Employee Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"emp_name",control:r,render:({field:t})=>e.jsx(m,{...t,placeholder:"Enter employee name"})})]}),e.jsx(n,{name:"emp_address",control:r,render:({field:t})=>e.jsx(m,{...t,label:"Employee Address",placeholder:"Enter employee address"})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Purpose ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"purpose",control:r,render:({field:t})=>e.jsx(m,{...t,placeholder:"Enter purpose of gate pass"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Vehicle Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"vehicle_number",control:r,render:({field:t})=>e.jsx(m,{...t,placeholder:"e.g., RJ14AB1234"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Driver Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"driver_name",control:r,render:({field:t})=>e.jsx(m,{...t,placeholder:"Enter driver name"})})]})]}),e.jsx("div",{className:"px-2 md:px-0",children:e.jsxs(W,{title:"Items Requested",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(_,{className:"bg-red-600 text-white px-3 py-1 text-sm",onClick:()=>O({item_id:"",item_name:"",item_code:"",item_unit:"",quantity_out:"",item_description:""}),children:"+ Add Item"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Q,{children:[e.jsx(z,{cols:[{title:"Item Name"},{title:"Item Code"},{title:"Item Unit"},{title:"Out Qty"},{title:"Remarks"},{title:"Action"}]}),e.jsx("tbody",{children:I.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8 text-gray-500",children:'No items added. Click "Add Item" to get started.'})}):I.map((t,s)=>e.jsxs("tr",{className:"align-middle",children:[e.jsx(c,{className:"text-center w-16",children:s+1}),e.jsx(c,{className:"min-w-[200px]",children:e.jsx(n,{name:`items.${s}.item_id`,control:r,render:({field:a})=>e.jsxs("select",{...a,className:"w-full h-10 rounded-lg border px-3 text-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500 bg-white",onChange:i=>{const x=Number(i.target.value);a.onChange(x);const h=v.find(D=>D.id===x);h&&(d(`items.${s}.item_code`,h.item_code),d(`items.${s}.item_unit`,h.unit?.unit_name||""),d(`items.${s}.item_name`,h.item_name))},value:a.value,children:[e.jsx("option",{value:"",children:"Select item"}),v.map(i=>e.jsx("option",{value:i.id,children:i.item_name},i.id))]})})}),e.jsx(c,{className:"min-w-[120px]",children:e.jsx(n,{name:`items.${s}.item_code`,control:r,render:({field:a})=>e.jsx("input",{...a,className:"w-full h-10 border rounded-lg px-3 text-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Auto-filled",readOnly:!0})})}),e.jsx(c,{className:"min-w-[100px]",children:e.jsx(n,{name:`items.${s}.item_unit`,control:r,render:({field:a})=>e.jsx("input",{...a,className:"w-full h-10 border focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500 bg-white rounded-lg px-3 text-sm",placeholder:"Auto-filled",readOnly:!0})})}),e.jsx(c,{className:"min-w-[120px]",children:e.jsx(n,{name:`items.${s}.quantity_out`,control:r,render:({field:a})=>e.jsx("input",{...a,type:"number",min:"0",step:"0.01",className:"w-full h-10 border rounded-lg px-3 text-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500",placeholder:"Enter qty"})})}),e.jsx(c,{className:"min-w-[150px]",children:e.jsx(n,{name:`items.${s}.item_description`,control:r,render:({field:a})=>e.jsx("input",{...a,className:"w-full h-10 border rounded-lg px-3 text-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500",placeholder:"Add remarks"})})}),e.jsx(c,{children:e.jsx(J,{children:e.jsx(K,{onClick:()=>q(s)})})})]},t.id))})]})})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 px-2 md:px-0 md:mr-5",children:[e.jsx(_,{variant:"outline",className:"w-full sm:w-auto",onClick:()=>u(g.NON_RETURNABLE_GATEPAS.LIST),disabled:j,children:"Cancel"}),e.jsx(_,{className:"bg-red-600 text-white w-full sm:w-auto",onClick:$(U),loading:j,disabled:j,children:l?"Update Gate Pass":"Create Gate Pass"})]})]})};export{je as default};
