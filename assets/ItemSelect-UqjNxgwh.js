import{r as t,j as n,ai as _,m as k,h as z,e as O}from"./index-DhMZcEWH.js";import{C as T}from"./index.esm-1Qhp7SJI.js";const F=({options:g,value:x,onChange:b,placeholder:w="Select",disabled:h,error:l,className:v,onSearch:u})=>{const[r,o]=t.useState(!1),[c,f]=t.useState(""),[s,a]=t.useState(""),[d,m]=t.useState({top:0,left:0,width:0}),i=t.useRef(null),E=t.useRef(null),I=t.useRef(null),y=g??[],L=y.find(e=>e.value===x);t.useEffect(()=>{const e=setTimeout(()=>{a(c),u?.(c)},300);return()=>clearTimeout(e)},[c,u]);const j=s.length>=3?y.filter(e=>e.label.toLowerCase().includes(s.toLowerCase())):y,p=()=>{if(i.current){const e=i.current.getBoundingClientRect();m({top:e.bottom+window.scrollY,left:e.left+window.scrollX,width:e.width})}};t.useEffect(()=>(r&&(p(),window.addEventListener("resize",p),window.addEventListener("scroll",p,!0)),()=>{window.removeEventListener("resize",p),window.removeEventListener("scroll",p,!0)}),[r]),t.useEffect(()=>{const e=S=>{const C=S.target,R=i.current?.contains(C),D=E.current?.contains(C);!R&&!D&&(o(!1),f(""))};return r&&document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[r]);const N=()=>r?c:L?.label||"";return n.jsxs("div",{className:"relative w-full",ref:i,children:[n.jsx("input",{ref:I,type:"text",disabled:h,value:N(),placeholder:w,onFocus:()=>{o(!0)},onChange:e=>{f(e.target.value),o(!0)},className:k("disabled:cursor-not-allowed disabled:opacity-80 w-full rounded-lg border px-4 py-3 text-gray-900 focus:outline-none text-sm",l?"border-red-500 focus:ring-2 focus:ring-red-200":"border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500","bg-gray-50",v)}),r&&!h&&_.createPortal(n.jsxs("div",{ref:E,className:"absolute z-[9999] rounded-lg border border-gray-300 bg-white shadow-lg max-h-60 overflow-auto",style:{top:d.top+4,left:d.left,width:d.width,boxShadow:"0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)"},children:[s.length>0&&s.length<3&&n.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"Type at least 3 characters"}),s.length>=3&&j.length===0&&n.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No results found"}),j.map(e=>n.jsx("div",{className:"px-4 py-2 text-sm cursor-pointer hover:bg-blue-50 border-b border-gray-100 last:border-b-0",onMouseDown:S=>{S.preventDefault()},onClick:()=>{b(e.value),o(!1),f("")},children:e.label},e.value))]}),document.body),l&&n.jsx("p",{className:"text-xs text-red-500 mt-1 font-medium",children:l})]})},M=({control:g,name:x,error:b,disabled:w=!1,onChange:h})=>{const[l,v]=t.useState([]),[u,r]=t.useState(!1),[o,c]=t.useState("");t.useEffect(()=>{if(o&&o.length<3)return;(async()=>{r(!0);try{const m=((await z.get(O.item_master.all,{params:{search:o}})).data?.items||[]).filter(i=>i.is_active);v(m)}catch(a){console.error("Failed to fetch items",a)}finally{r(!1)}})()},[o]);const f=l.map(s=>({value:s.id,label:`${s.item_name} (${s.item_code})`}));return n.jsx(T,{name:x,control:g,render:({field:s})=>n.jsx(F,{options:f,value:s.value,disabled:w||u,error:b,placeholder:u?"Loading...":"Select Item",onChange:a=>{const d=l.find(m=>m.id===a);s.onChange(a),h?.(a,d)},onSearch:c})})};export{M as I};
