import{u as I,i as B,a as k,r as l,j as e,B as y,h as p,e as m,y as _}from"./index-DwoM2qi7.js";import{u as D,C as o}from"./index.esm-MBtrRDns.js";import{o as E,A as H,B as T}from"./yup-CI06meJR.js";import{u as L}from"./usePartyStore-DbSTfM_r.js";import{T as v}from"./TextInput-B3xKsBn1.js";import{T as g}from"./TextArea-B8_QqCoa.js";import{S as h}from"./Select-B5dfGBP8.js";import{L as R}from"./Loading-JYq8HBew.js";import{b as Q}from"./rolePermissions-C6yvwKWQ.js";import{F as V}from"./FormHeader-BGoI8AUi.js";import"./BackButton-DRzNQbUf.js";const W={name:"",source:"",product_description:"",hsn_code:"",quantity_required:"",approved_by:"Head of Dept",allocated_supervisor_id:"",is_active:!0,note:""},te=()=>{const f=I(),[x]=B(),t=x.get("editId")?Number(x.get("editId")):void 0,{selectedBranchId:d}=k(),{parties:j,fetchParties:b}=L(),[c,n]=l.useState(!1),[z,S]=l.useState([]),[q,P]=l.useState([]),{control:a,handleSubmit:N,reset:C,formState:{errors:i}}=D({defaultValues:W,resolver:E(t?T:H)}),w=async r=>{if(r)try{const u=(await p.get(m.user_management.all,{params:{branch_id:r}})).data.users;S(u);const U=u.filter(F=>Q(F.role.role_name));P(U)}catch(s){console.log(s),_.error("Failed to fetch users")}},A=async()=>{if(t){n(!0);try{const s=(await p.get(m.product_master.details(t))).data.product;C({name:s.name,source:s.source,product_description:s.product_description,hsn_code:s.hsn_code,quantity_required:String(s.quantity_required),approved_by:s.approved_by?String(s.approved_by):"",allocated_supervisor_id:s.allocated_supervisor_id?String(s.allocated_supervisor_id):"",is_active:s.is_active,note:s.note||""})}finally{n(!1)}}};l.useEffect(()=>{b(),d&&w(Number(d)),t&&A()},[t,d]);const M=async r=>{n(!0);try{const s={name:r.name,source:r.source,party_id:j.find(u=>u.party_name===r.source)?.id,description:r.product_description,hsn_code:r.hsn_code,quantity_required:r.quantity_required,approved_by:"Head of Dept",allocated_supervisor_id:Number(r.allocated_supervisor_id),is_active:r.is_active,branch_id:d};t?(await p.put(m.product_master.update(t),s),_.success("Product Updated Successfully")):(await p.post(m.product_master.create,s),_.success("Product Created Successfully")),f("/master/product-master/list")}catch(s){console.error(s),_.error(s.response?.data?.message||"Failed to save product")}finally{n(!1)}};return c&&t?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(R,{})}):e.jsxs("div",{className:"w-full h-full overflow-auto space-y-8 p-4 pb-20",children:[e.jsx("div",{className:"space-y-1 ml-2",children:e.jsx(V,{title:t?"Edit Product Master":"Create Product Master",subtitle:t?"Update the Product Master details":"Fill out the form to submit a new Product Master."})}),e.jsxs("div",{className:"grid grid-cols-3 gap-5 ml-2 mr-5 mt-5",children:[e.jsx(o,{name:"name",control:a,render:({field:r})=>e.jsx(v,{required:!0,...r,label:"Product Name",error:i?.name?.message})}),e.jsx(o,{name:"source",control:a,render:({field:r})=>e.jsxs(h,{required:!0,...r,label:"Source",error:i?.source?.message,children:[e.jsx("option",{value:"",children:"Select Source"}),j.map(s=>e.jsx("option",{value:s.party_name,children:s.party_name},s.id))]})}),e.jsx(o,{name:"hsn_code",control:a,render:({field:r})=>e.jsx(v,{required:!0,...r,label:"HSN Code",error:i?.hsn_code?.message})}),e.jsx(o,{name:"quantity_required",control:a,render:({field:r})=>e.jsx(v,{required:!0,...r,type:"number",label:"Quantity Required",error:i?.quantity_required?.message})}),e.jsx(o,{name:"approved_by",control:a,render:({field:r})=>e.jsx(v,{required:!0,...r,type:"string",label:"Approved By",error:i?.approved_by?.message})}),e.jsx(o,{name:"allocated_supervisor_id",control:a,render:({field:r})=>e.jsxs(h,{...r,label:"Allocated Supervisor",required:!0,error:i?.allocated_supervisor_id?.message,children:[e.jsx("option",{value:"",children:"Select Workshop Supervisor"}),q.map(s=>e.jsx("option",{value:s.id,children:s.full_name},s.id))]})}),e.jsx(o,{name:"is_active",control:a,render:({field:r})=>e.jsxs(h,{...r,onChange:s=>r.onChange(s.target.value==="true"),label:"Is Active",value:r.value?"true":"false",children:[e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})})]}),e.jsx("div",{className:"ml-2 mr-5",children:e.jsx(o,{name:"product_description",control:a,render:({field:r})=>e.jsx(g,{required:!0,...r,label:"Product Description",rows:4,error:i?.product_description?.message})})}),e.jsx("div",{className:"ml-2 mr-5",children:e.jsx(o,{name:"note",control:a,render:({field:r})=>e.jsx(g,{...r,label:"Note",placeholder:"Add any additional notes or comments about this product...",rows:3,error:i?.note?.message})})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-5 mr-5",children:[e.jsx(y,{onClick:()=>f("/master/product-master/list"),variant:"outline",disabled:c,children:"Cancel"}),e.jsx(y,{onClick:N(M),loading:c,disabled:c,children:t?"Update Product":"Create Product"})]})]})};export{te as default};
