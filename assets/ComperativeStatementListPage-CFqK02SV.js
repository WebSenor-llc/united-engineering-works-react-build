const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-pdf.browser-zSMU-UFz.js","assets/index-CzjESdn-.js","assets/index-BBd5HntT.css","assets/ComperativeStatementPDF-CUIrbVYI.js"])))=>i.map(i=>d[i]);
import{u as k,r as i,a as V,j as t,_ as v,y as c,A as M,h as x,e as h}from"./index-CzjESdn-.js";import{L as O}from"./ListWrapper-zh-B1St2.js";import{T as $,a as B,b as m}from"./TableWrapper-CCT9enoe.js";import{T as I}from"./TableRow-BJYJAldJ.js";import{u as U}from"./usePagination-DPp0a-ct.js";import{T as H}from"./TableActions-DYhKNk6H.js";import{T as W}from"./TableView-DiGr1cJn.js";import{T as q}from"./TableDelete-CHeVipc5.js";import{T as z}from"./TableDownload-DjGNA05N.js";import{C as G}from"./CommonFilter-DBf3R8BY.js";import"./index.esm-DBey6kFt.js";import"./TextInput-DfufbPvl.js";const me=()=>{const{page:l,rowsPerPage:d,setTotal:g,renderPagination:T}=U(),D=k(),[_,N]=i.useState([]),{user:w,selectedBranchId:f}=V(),[b,P]=i.useState({}),F=[{name:"statement_number",label:"Statement Number",placeholder:"Enter Statement Number"},{name:"mr_number",label:"MR Number",placeholder:"Enter MR Number"},{name:"date_from",label:"Date From",type:"date"},{name:"date_to",label:"Date To",type:"date"}],C=e=>{if(!e)return{ymd:"",dmy:""};const[a]=e.split("T"),[r,s,o]=a.split("-");return{ymd:a,dmy:`${o}-${s}-${r}`}},[E,y]=i.useState(!0),S=async e=>{try{const a=await x.get(h.comparative_statement.details(e));return a.data?.statement||a.data}catch(a){return console.error("Error fetching statement for PDF:",a),c.error("Failed to fetch statement details for PDF"),null}},p=async e=>{y(!0);try{const a={page:l+1,rowsPerPage:d,branch_id:f};e&&(e.statement_number&&(a.statement_number=e.statement_number),e.mr_number&&(a.mr_number=e.mr_number),e.date_from&&e.date_to?e.date_from===e.date_to?a.date=e.date_from:(a.date_from=e.date_from,a.date_to=e.date_to):(e.date_from&&(a.date_from=e.date_from),e.date_to&&(a.date_to=e.date_to)));const r=await x.get(h.comparative_statement.items,{params:a}),s=r.data?.statements||[],o=r.data.pagination;o?.total!==void 0&&g(o.total),N(Array.isArray(s)?s:[])}catch(a){console.error("Failed to fetch comparative statements",a)}finally{y(!1)}};i.useEffect(()=>{p(b)},[l,d,f,w]);const A=async e=>{P(e),await p(e)},L=async e=>{try{await x.delete(h.comparative_statement.delete(e)),c.success("Comparative statement deleted successfully"),p()}catch(a){console.error("Failed to delete comparative statement",a),c.error("Failed to delete comparative statement")}};return t.jsxs("div",{className:"space-y-6",children:[t.jsx(G,{fields:F,onFilter:A,defaultValues:b}),t.jsxs(O,{title:"Comparative Statements",createOnClick:()=>D(M.COMPERATIVE_STATEMENT.CREATE),children:[t.jsxs($,{children:[t.jsx(B,{cols:[{title:"Date"},{title:"Comparative Statement"},{title:"Material Requisition"},{title:"Actions"}]}),t.jsx("tbody",{children:E?t.jsx("tr",{children:t.jsx("td",{colSpan:5,className:"text-center p-4",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),t.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Loading comparative statements..."})]})})}):_.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:5,className:"text-center py-8",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No comparative statements"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new comparative statement."})]})})}):_.map((e,a)=>t.jsxs(I,{children:[t.jsx(m,{className:"px-5",children:l*d+a+1}),t.jsx(m,{children:t.jsx("span",{className:"text-sm text-gray-900",children:C(e.created_at).dmy})}),t.jsx(m,{children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.statement_number||"â€”"})}),t.jsx(m,{children:t.jsx("span",{className:"text-sm text-gray-900",children:e.material_requisition?.mr_number||"N/A"})}),t.jsx(m,{children:t.jsxs(H,{children:[t.jsx(W,{url:`/comperative-statement/${e.id}`,tooltip:"View Details"}),t.jsx(z,{onClick:async()=>{const r=await S(e.id);if(r)try{const{pdf:s}=await v(async()=>{const{pdf:u}=await import("./react-pdf.browser-zSMU-UFz.js");return{pdf:u}},__vite__mapDeps([0,1,2])),{default:o}=await v(async()=>{const{default:u}=await import("./ComperativeStatementPDF-CUIrbVYI.js");return{default:u}},__vite__mapDeps([3,1,2,0])),R=await s(t.jsx(o,{statement:r})).toBlob(),j=URL.createObjectURL(R),n=document.createElement("a");n.href=j,n.download=`Comparative-Statement-${r.statement_number||e.id}.pdf`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(j)}catch(s){console.error("Error generating PDF:",s),c.error("Failed to generate PDF")}},title:"Download Comparative Statement PDF"}),t.jsx(q,{onClick:()=>L(e.id)})]})})]},e.id))})]}),T()]})]})};export{me as default};
