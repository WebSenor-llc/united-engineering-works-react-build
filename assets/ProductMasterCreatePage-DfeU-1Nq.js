import{u as U,i as F,r as n,j as e,B as j,h as u,e as l,y as p}from"./index-CzjESdn-.js";import{u as I,C as o}from"./index.esm-DBey6kFt.js";import{o as k,A as B,B as D}from"./yup-DSuMVrKN.js";import{u as E}from"./usePartyStore-DVmxU8Po.js";import{T as m}from"./TextInput-DfufbPvl.js";import{T as y}from"./TextArea-SoSF9I72.js";import{S as v}from"./Select-D_RHSQTs.js";import{L as H}from"./Loading-BGzUGx0u.js";import{b as T}from"./rolePermissions-DkNSaWLM.js";import{F as L}from"./FormHeader-N2HZYvrx.js";import"./BackButton-Cz_psy3_.js";const R={name:"",source:"",product_description:"",hsn_code:"",quantity_required:"",approved_by:"Head of Dept",allocated_supervisor_id:"",is_active:!0,note:""},$=()=>{const h=U(),[x]=F(),t=x.get("editId")?Number(x.get("editId")):void 0,{parties:f,fetchParties:g}=E(),[d,c]=n.useState(!1),[,b]=n.useState([]),[S,q]=n.useState([]),{control:a,handleSubmit:P,reset:C,formState:{errors:i}}=I({defaultValues:R,resolver:k(t?D:B)}),N=async()=>{try{const s=(await u.get(l.user_management.all)).data.users;b(s);const _=s.filter(M=>T(M.role.role_name));q(_)}catch(r){console.log(r),p.error("Failed to fetch users")}},w=async()=>{if(t){c(!0);try{const s=(await u.get(l.product_master.details(t))).data.product;C({name:s.name,source:s.source,product_description:s.product_description,hsn_code:s.hsn_code,quantity_required:String(s.quantity_required),approved_by:s.approved_by?String(s.approved_by):"",allocated_supervisor_id:s.allocated_supervisor_id?String(s.allocated_supervisor_id):"",is_active:s.is_active,note:s.note||""})}finally{c(!1)}}};n.useEffect(()=>{g(),N(),t&&w()},[t]);const A=async r=>{c(!0);try{const s={name:r.name,source:r.source,party_id:f.find(_=>_.party_name===r.source)?.id,description:r.product_description,hsn_code:r.hsn_code,quantity_required:r.quantity_required,approved_by:"Head of Dept",allocated_supervisor_id:Number(r.allocated_supervisor_id),is_active:r.is_active};t?(await u.put(l.product_master.update(t),s),p.success("Product Updated Successfully")):(await u.post(l.product_master.create,s),p.success("Product Created Successfully")),h("/master/product-master/list")}catch(s){console.error(s),p.error(s.response?.data?.message||"Failed to save product")}finally{c(!1)}};return d&&t?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(H,{})}):e.jsxs("div",{className:"w-full h-full overflow-auto space-y-8 p-4 pb-20",children:[e.jsx("div",{className:"space-y-1 ml-2",children:e.jsx(L,{title:t?"Edit Product Master":"Create Product Master",subtitle:t?"Update the Product Master details":"Fill out the form to submit a new Product Master."})}),e.jsxs("div",{className:"grid grid-cols-3 gap-5 ml-2 mr-5 mt-5",children:[e.jsx(o,{name:"name",control:a,render:({field:r})=>e.jsx(m,{required:!0,...r,label:"Product Name",error:i?.name?.message})}),e.jsx(o,{name:"source",control:a,render:({field:r})=>e.jsxs(v,{required:!0,...r,label:"Source",error:i?.source?.message,children:[e.jsx("option",{value:"",children:"Select Source"}),f.map(s=>e.jsx("option",{value:s.party_name,children:s.party_name},s.id))]})}),e.jsx(o,{name:"hsn_code",control:a,render:({field:r})=>e.jsx(m,{required:!0,...r,label:"HSN Code",error:i?.hsn_code?.message})}),e.jsx(o,{name:"quantity_required",control:a,render:({field:r})=>e.jsx(m,{required:!0,...r,type:"number",label:"Quantity Required",error:i?.quantity_required?.message})}),e.jsx(o,{name:"approved_by",control:a,render:({field:r})=>e.jsx(m,{required:!0,...r,type:"string",label:"Approved By",error:i?.approved_by?.message})}),e.jsx(o,{name:"allocated_supervisor_id",control:a,render:({field:r})=>e.jsxs(v,{...r,label:"Allocated Supervisor",required:!0,error:i?.allocated_supervisor_id?.message,children:[e.jsx("option",{value:"",children:"Select Workshop Supervisor"}),S.map(s=>e.jsx("option",{value:s.id,children:s.full_name},s.id))]})}),e.jsx(o,{name:"is_active",control:a,render:({field:r})=>e.jsxs(v,{...r,onChange:s=>r.onChange(s.target.value==="true"),label:"Is Active",value:r.value?"true":"false",children:[e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})})]}),e.jsx("div",{className:"ml-2 mr-5",children:e.jsx(o,{name:"product_description",control:a,render:({field:r})=>e.jsx(y,{required:!0,...r,label:"Product Description",rows:4,error:i?.product_description?.message})})}),e.jsx("div",{className:"ml-2 mr-5",children:e.jsx(o,{name:"note",control:a,render:({field:r})=>e.jsx(y,{...r,label:"Note",placeholder:"Add any additional notes or comments about this product...",rows:3,error:i?.note?.message})})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-5 mr-5",children:[e.jsx(j,{onClick:()=>h("/master/product-master/list"),variant:"outline",disabled:d,children:"Cancel"}),e.jsx(j,{onClick:P(A),loading:d,disabled:d,children:t?"Update Product":"Create Product"})]})]})};export{$ as default};
