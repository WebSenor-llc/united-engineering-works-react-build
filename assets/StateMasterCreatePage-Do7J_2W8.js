import{u as P,b as k,r,j as t,B as C,A as N,h as c,e as d,y as u}from"./index-DZUejYSu.js";import{T as O}from"./TextInput-CfYT9kxn.js";import{T as R}from"./TextArea-DQ1G-Ggy.js";import{F as U}from"./FormHeader-DC4am5AO.js";import{L as B}from"./Loading-BZ-_58ep.js";import{S as H}from"./SearchableSelect-C6IXXd44.js";import{o as q,b as D}from"./yup-CyIqaq5C.js";import{u as V,C as m}from"./index.esm-8JYv16KU.js";import"./BackButton-DGqmmXaI.js";const z={name:"",country_id:void 0,is_active:!0,note:""},te=()=>{const x=P(),[w]=k(),s=w.get("id"),[_,p]=r.useState(!1),[g,y]=r.useState(!1),[h,S]=r.useState([]),[v,j]=r.useState(!0),[A,n]=r.useState([]),[G,b]=r.useState(!1),{control:i,handleSubmit:L,reset:T,formState:{errors:f}}=V({defaultValues:z,resolver:q(D)}),F=async()=>{j(!0);try{const e=await c.get(d.country_master.all),a=e.data?.data?.countries||e.data?.countries||[],o=Array.isArray(a)?a:[];S(o),n(l(o))}catch(e){console.error("Failed to fetch countries",e),u.error("Failed to load countries"),S([]),n([])}finally{j(!1)}},l=e=>e.map(a=>({value:a.id,label:a.name})),E=async e=>{if(e.length<3){n(l(h));return}b(!0);try{const a=h.filter(o=>o.name.toLowerCase().includes(e.toLowerCase())||o.code?.toLowerCase().includes(e.toLowerCase()));n(l(a))}catch(a){console.error("Failed to search countries:",a),n(l(h))}finally{b(!1)}},I=async()=>{if(s){p(!0);try{const e=await c.get(d.state_master.details(Number(s))),a=e.data.data||e.data||{};T({name:a.name||"",country_id:a.country_id,is_active:a.is_active??!0,note:a.note||""})}catch(e){console.error("Failed to load state details:",e),u.error("Failed to load state details")}finally{p(!1)}}};r.useEffect(()=>{F(),s&&I()},[s]);const M=async e=>{y(!0);try{const a=s?d.state_master.update(Number(s)):d.state_master.create;await(s?c.put:c.post)(a,e),u.success(s?"State Updated Successfully":"State Created Successfully"),x(N.STATE_MASTER.LIST)}catch(a){console.error(a),u.error(a.response?.data?.message||"Failed to save state")}finally{y(!1)}};return _?t.jsx("div",{className:"flex justify-center py-20",children:t.jsx(B,{})}):t.jsxs("div",{className:"w-full h-full overflow-auto space-y-8 p-4 pb-20",children:[t.jsx("div",{className:"space-y-1 ml-2",children:t.jsx(U,{title:s?"Edit State Master":"Create State Master",subtitle:s?"Update the state master details":"Fill out the form to create a new state master"})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mx-2",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx(m,{name:"name",control:i,render:({field:e})=>t.jsx(O,{required:!0,...e,label:"State Name",error:f?.name?.message})}),t.jsx(m,{name:"country_id",control:i,render:({field:e})=>t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:["Country ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx(H,{options:A,value:e.value?Number(e.value):void 0,onChange:a=>e.onChange(a),placeholder:v?"Loading countries...":"Search countries...",onSearch:E,disabled:v,error:f?.country_id?.message})]})}),t.jsx(m,{name:"is_active",control:i,render:({field:e})=>t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:["Is Active ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("select",{...e,value:e.value?"true":"false",onChange:a=>e.onChange(a.target.value==="true"),className:"w-full border border-gray-300 rounded-lg px-3 py-3 bg-white text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"true",children:"Active"}),t.jsx("option",{value:"false",children:"Inactive"})]})]})})]}),t.jsx("div",{className:"mt-6",children:t.jsx(m,{name:"note",control:i,render:({field:e})=>t.jsx(R,{...e,label:"Note",placeholder:"Add any additional notes or comments...",error:f?.note?.message,rows:3})})}),t.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[t.jsx(C,{onClick:()=>x(N.STATE_MASTER.LIST),variant:"outline",children:"Cancel"}),t.jsx(C,{onClick:L(M),loading:g,disabled:g,className:"bg-red-600 text-white",children:s?"Update State":"Create State"})]})]})]})};export{te as default};
