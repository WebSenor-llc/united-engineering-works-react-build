import{u as P,i as R,r as i,j as r,B as b,A as j,h as d,e as c,y as u}from"./index-CHv2um3-.js";import{T as n}from"./TextInput-DLaHSu5O.js";import{S as p}from"./Select-9Gdmfsy8.js";import{F as T}from"./FormHeader-B3DVUoW0.js";import{L as B}from"./Loading-sZj5B-qA.js";import{o as I,h as L}from"./yup-DBroraFj.js";import{u as M,C as o}from"./index.esm-BXq0dTbn.js";import"./BackButton-C8N1R7JM.js";const D={username:"",email:"",password:"",password_confirmation:"",full_name:"",employee_code:"",branch_id:"",role_id:"",phone:"",is_active:!0},W=()=>{const h=P(),[_]=R(),a=_.get("id"),[y,x]=i.useState(!1),[g,f]=i.useState(!1),[v,w]=i.useState([]),[S,N]=i.useState([]),{control:t,handleSubmit:C,reset:E,formState:{errors:l}}=M({defaultValues:D,resolver:I(L,{context:{isEdit:!!a}})}),U=async()=>{try{const e=await d.get(c.role_management.roles);N(e.data?.roles||[])}catch(e){console.error("Failed to fetch roles:",e)}},A=async()=>{try{const e=await d.get(c.branches.branch);w(e.data.branches||[])}catch(e){console.error("Failed to fetch branches:",e)}},F=async()=>{if(a){x(!0);try{const s=(await d.get(c.user_management.details(Number(a)))).data.user;E({full_name:s.full_name||"",email:s.email||"",employee_code:s.employee_code||"",username:s.username||"",branch_id:s.branch_id?String(s.branch_id):"",role_id:s.role_id?String(s.role_id):"",phone:s.phone||"",is_active:s.is_active??!0,password:"",password_confirmation:""})}catch(e){console.error("Failed to load user details:",e),u.error("Failed to load user details")}finally{x(!1)}}};i.useEffect(()=>{U(),A(),a&&F()},[a]);const q=async e=>{f(!0);try{const s=a?{full_name:e.full_name,email:e.email,employee_code:e.employee_code,phone:e.phone,is_active:e.is_active}:e,m=a?c.user_management.update(Number(a)):c.user_management.create;await(a?d.put:d.post)(m,s),u.success(a?"User Updated Successfully":"User Created Successfully"),h(j.USER_MANAGEMENT.LIST)}catch(s){console.error(s),u.error(s.response?.data?.message||"Failed to save user")}finally{f(!1)}};return y?r.jsx("div",{className:"flex justify-center py-20",children:r.jsx(B,{})}):r.jsxs("div",{className:"w-full h-full overflow-auto space-y-8 p-4 pb-20",children:[r.jsx("div",{className:"space-y-1 ml-2",children:r.jsx(T,{title:a?"Edit User":"Create User",subtitle:a?"Update the user details":"Fill out the form to create a new user"})}),r.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mx-2",children:r.jsxs("form",{onSubmit:C(q),children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[r.jsx(o,{control:t,name:"full_name",render:({field:e})=>r.jsx(n,{required:!0,...e,label:"Full Name",error:l?.full_name?.message})}),r.jsx(o,{control:t,name:"email",render:({field:e})=>r.jsx(n,{required:!0,...e,type:"email",label:"Email",error:l?.email?.message})}),r.jsx(o,{control:t,name:"phone",render:({field:e})=>r.jsxs("div",{className:"flex flex-col",children:[r.jsx("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:"Mobile No"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"px-3 py-3 bg-gray-100 border border-gray-300 rounded-lg text-gray-700 text-sm",children:"+91"}),r.jsx("input",{...e,value:e.value||"",type:"tel",maxLength:10,placeholder:"Enter 10 digit mobile number (optional)",className:"flex-1 w-full rounded-lg border border-gray-300 px-3 py-3 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:s=>{const m=s.target.value.replace(/\D/g,"");e.onChange(m)}})]}),l?.phone?.message&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.phone.message})]})}),a&&r.jsx(o,{control:t,name:"employee_code",render:({field:e})=>r.jsx(n,{required:!0,...e,value:e.value??"",color:"white",label:"Employee Code",error:l?.employee_code?.message,disabled:!0})}),r.jsx(o,{control:t,name:"username",render:({field:e})=>r.jsx(n,{required:!0,...e,label:"Username",error:l?.username?.message,disabled:!!a})}),!a&&r.jsx(o,{control:t,name:"password",render:({field:e})=>r.jsx(n,{required:!0,...e,type:"password",label:"Password",error:l?.password?.message})}),!a&&r.jsx(o,{control:t,name:"password_confirmation",render:({field:e})=>r.jsx(n,{required:!0,...e,type:"password",label:"Confirm Password",error:l?.password_confirmation?.message})}),r.jsx(o,{control:t,name:"role_id",render:({field:e})=>r.jsxs(p,{...e,label:"Role",required:!0,disabled:!!a,error:l?.role_id?.message,children:[r.jsx("option",{value:"",children:"Select Role"}),S.map(s=>r.jsx("option",{value:s.id,children:s.role_name},s.id))]})}),r.jsx(o,{control:t,name:"branch_id",render:({field:e})=>r.jsxs(p,{...e,label:"Branch",required:!0,disabled:!!a,error:l?.branch_id?.message,children:[r.jsx("option",{value:"",children:"Select Branch"}),v.map(s=>r.jsx("option",{value:s.id,children:s.branch_name},s.id))]})}),r.jsx(o,{control:t,name:"is_active",render:({field:e})=>r.jsxs(p,{...e,label:"Is Active",required:!0,value:e.value?"true":"false",onChange:s=>e.onChange(s.target.value==="true"),children:[r.jsx("option",{value:"true",children:"Active"}),r.jsx("option",{value:"false",children:"Inactive"})]})})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[r.jsx(b,{type:"button",onClick:()=>h(j.USER_MANAGEMENT.LIST),variant:"outline",children:"Cancel"}),r.jsx(b,{type:"submit",loading:g,disabled:g,className:"bg-red-600 text-white",children:a?"Update User":"Create User"})]})]})})]})};export{W as default};
