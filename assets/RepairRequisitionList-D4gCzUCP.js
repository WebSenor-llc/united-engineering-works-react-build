import{r as g,a as S,j as e,as as r,h as v,e as j,y as A,u as I,D as T,A as R}from"./index-aHpIp7Ij.js";import{L as D}from"./ListWrapper-CgjY_ujH.js";import{T as _,a as w,b as d}from"./TableWrapper-jv708q_S.js";import{T as P}from"./TableRow-CUivvRdm.js";import{u as C}from"./usePagination-BLResuyG.js";import{T as L}from"./TableActions-D2FqQMqq.js";import{T as U}from"./TableEdit-3ZMvRVs2.js";import{T as q}from"./TableDelete-CQCgin4T.js";import{c as k,a as $,b as G}from"./rolePermissions-0uPJ-vVt.js";const Y=({requisition:a,onStatusUpdate:l})=>{const[b,u]=g.useState(!1),{user:o}=S(),c=async t=>{u(!0);try{await v.post(j.repair_requisition.statusActions(a.id),{repair_requisition_id:a.id,status:t}),A.success("Status updated successfully"),l()}catch(i){console.error("Failed to update status:",i),A.error(i.response?.data?.message||"Failed to update status")}finally{u(!1)}},n=(()=>{const t=o?.role?.role_name,i=a.status,x=k(t||""),m=$(t||"")||t==="Super Admin";let s=[];switch(i){case r.PENDING:m&&(s=[r.UNDER_REPAIR]);break;case r.UNDER_REPAIR:m&&(s=[r.READY]);break;case r.READY:break;case r.CANCELLED:x&&(s=[r.PENDING]);break}return s})(),p=t=>t.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase()),f=t=>{switch(t){case r.PENDING:return"text-yellow-600 bg-yellow-50";case r.UNDER_REPAIR:return"text-blue-600 bg-blue-50";case r.READY:return"text-purple-600 bg-purple-50";case r.CANCELLED:return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}};return e.jsx("div",{className:"flex items-center gap-2",children:b?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Updating..."})]}):e.jsxs("select",{className:`text-xs border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white min-w-[120px] ${f(a.status)}`,value:a.status,onChange:t=>{t.target.value!==a.status&&c(t.target.value)},disabled:n.length===0,children:[e.jsx("option",{value:a.status,children:p(a.status)}),n.map(t=>e.jsx("option",{value:t,children:p(t)},t))]})})},M=()=>{const{page:a,rowsPerPage:l,setTotal:b,renderPagination:u}=C(),o=I(),{selectedBranchId:c,user:N}=S(),[n,p]=g.useState([]),[f,t]=g.useState(!0),i=async()=>{t(!0);try{const s={page:a+1,rowsPerPage:l,...c&&{branch_id:c}},h=await v.get(j.repair_requisition.list,{params:s}),y=h.data?.data||[],E=h.data?.pagination;p(y),E?.total!==void 0&&b(E.total)}catch(s){console.error("Error fetching repair requisitions:",s)}finally{t(!1)}};g.useEffect(()=>{i()},[a,l,c]);const x=N?.role?.role_name||"",m=G(x)||x==="Super Admin";return e.jsx("div",{className:"space-y-6",children:e.jsxs(D,{title:`Repair Requisitions (${n.length})`,createOnClick:m?()=>o(R.REPAIR_REQUISITION.CREATE):void 0,children:[e.jsxs(_,{children:[e.jsx(w,{cols:[{title:"Repair Item"},{title:"Created At"},{title:"Status"},{title:"Actions"}]}),e.jsx("tbody",{children:f&&n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-sm text-gray-500",children:"Loading repair requisitions..."})]})})}):n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"No repair requisitions found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new repair requisition."})]})})}):n.map((s,h)=>e.jsxs(P,{children:[e.jsx(d,{className:"px-5",children:a*l+h+1}),e.jsx(d,{children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.repair_item})}),e.jsx(d,{className:"w-40",children:e.jsx("div",{className:"text-sm text-gray-500",children:T.date(s.created_at)})}),e.jsx(d,{className:"w-40",children:e.jsx(Y,{requisition:s,onStatusUpdate:i})}),e.jsx(d,{className:"w-32",children:e.jsxs(L,{children:[s.status===r.READY&&e.jsx("button",{onClick:()=>o(`${R.REPAIR_ISSUE_SLIP.CREATE}?requisitionId=${s.id}`),className:"text-blue-600 hover:text-blue-800 text-sm font-medium px-2 py-1 rounded hover:bg-blue-50 transition-colors",title:"Issue Slip",children:"Issue Slip"}),e.jsx(U,{onClick:()=>o(`${R.REPAIR_REQUISITION.CREATE}?id=${s.id}`)}),e.jsx(q,{refetch:i,endpoint:j.repair_requisition.delete(s.id)})]})})]},s.id))})]}),n.length>0&&u()]})})};export{M as default};
