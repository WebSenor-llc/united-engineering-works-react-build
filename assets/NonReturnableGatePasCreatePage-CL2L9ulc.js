import{u as H,i as V,a as R,r as b,j as e,B as g,A as y,h as N,e as v,y as f}from"./index-BEDO0dex.js";import{T as m}from"./TextInput-BycqYwit.js";import{L as W}from"./ListWrapper-DeANL29G.js";import{T as J}from"./TableActions-Byl6t4kE.js";import{T as Q,a as z,b as c}from"./TableWrapper-DmijAqG1.js";import{T as K}from"./TableDelete-BbRRQ-WT.js";import{u as M,b as X,C as n}from"./index.esm-Cs6rN6dt.js";import{F as Y}from"./FormHeader-nNio7dPv.js";import{L as Z}from"./Loading-DUoPDPXz.js";import{u as ee}from"./useItemsStore-BBoLfkvJ.js";import{u as se}from"./usePartyStore-DdL5I70r.js";import{S as ae}from"./Select-8r6YXSg8.js";import{u as te}from"./useBranchStore-C-pFRDNq.js";import{S as re}from"./SearchableSelect-DmT-wQ3p.js";import"./BackButton-D3G9tbc7.js";const G={party_name:"",party_address:"",branch_id:"",branch_name:"",branch_address:"",emp_name:"",emp_address:"",purpose:"",vehicle_number:"",driver_name:"",items:[{item_id:"",item_name:"",item_code:"",item_unit:"",quantity_out:"",item_description:""}]},ge=()=>{const x=H(),[k]=V(),d=k.get("editId"),{user:p}=R(),{items:w,fetchItems:h}=ee(),{parties:_,fetchParties:A}=se(),{branches:B,fetchBranches:S}=te(),[L,P]=b.useState(!1),[j,E]=b.useState(!1),{selectedBranchId:O}=R(),{control:r,handleSubmit:$,reset:I,setValue:i,formState:{errors:T}}=M({defaultValues:G}),{fields:C,append:F,remove:q}=X({control:r,name:"items"});b.useEffect(()=>{h(),A(),S(),p?.branch&&(i("branch_name",p.branch.branch_name||""),i("branch_address",p.branch.address||""))},[p,i,h,A,S]),b.useEffect(()=>{if(!d)return;(async()=>{P(!0);try{const s=await N.get(v.non_returnable_gate_pass.details(parseInt(d,10))),a=s.data?.gate_pass||s.data?.data||s.data;console.log("object",a),I({party_name:a.party_name||"",party_address:a.party_address||"",branch_name:a.branch_name||"",branch_address:a.branch_address||"",emp_name:a.emp_name||"",emp_address:a.emp_address||"",purpose:a.purpose||"",vehicle_number:a.vehicle_number||"",driver_name:a.driver_name||"",items:a.items&&a.items.length>0?a.items:G.items})}catch(s){console.error(s),f.error("Failed to load gate pass details"),x(y.NON_RETURNABLE_GATEPAS.LIST)}finally{P(!1)}})(),h()},[d,I,x,h,O]);const U=async t=>{E(!0);try{const s={...t,branch_id:t.branch_id||p?.branch?.id};d?(await N.put(v.non_returnable_gate_pass.update(parseInt(d,10)),s),f.success("Gate pass updated successfully")):(await N.post(v.non_returnable_gate_pass.create,s),f.success("Gate pass created successfully")),x(y.NON_RETURNABLE_GATEPAS.LIST)}catch(s){console.error(s),f.error(s.response?.data?.message||"Failed to save gate pass")}finally{E(!1)}};return L?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(Z,{})}):e.jsxs("div",{className:"w-full h-full overflow-auto space-y-6 md:space-y-8 p-2 md:p-4 pb-20",children:[e.jsx("div",{className:"space-y-1 px-2 md:px-0 md:ml-2",children:e.jsx(Y,{title:d?"Edit Non Returnable Gate Pass":"Create Non Returnable Gate Pass",subtitle:d?"Update the Non Returnable Gate Pass details":"Fill out the form to create a new Non Returnable Gate Pass"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-5 px-2 md:px-0 md:ml-2 md:mr-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Party Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"party_name",control:r,render:({field:t})=>{const s=_.map(l=>({value:l.id,label:l.company_name})),a=_.find(l=>l.company_name===t.value)?.id;return e.jsx(re,{options:s,value:a,onChange:l=>{const o=_.find(u=>u.id===l);o&&(t.onChange(o.company_name),i("party_address",o.address||""))},placeholder:"Select party for gate pass",error:T.party_name?.message})}})]}),e.jsx(n,{name:"party_address",control:r,render:({field:t})=>e.jsx(m,{...t,label:"Party Address",placeholder:"Auto-filled from selected party",readOnly:!0})}),e.jsx(n,{name:"branch_id",control:r,render:({field:t})=>e.jsxs(ae,{...t,label:"Branch",required:!0,error:T.branch_id?.message,children:[e.jsx("option",{value:"",children:"Select Branch"}),B.map(s=>e.jsx("option",{value:s.id,children:s.branch_name},s.id))]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Branch Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"branch_address",control:r,render:({field:t})=>e.jsx(m,{...t,placeholder:"Enter branch address"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Employee Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"emp_name",control:r,render:({field:t})=>e.jsx(m,{...t,placeholder:"Enter employee name"})})]}),e.jsx(n,{name:"emp_address",control:r,render:({field:t})=>e.jsx(m,{...t,label:"Employee Address",placeholder:"Enter employee address"})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Purpose ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"purpose",control:r,render:({field:t})=>e.jsx(m,{...t,placeholder:"Enter purpose of gate pass"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Vehicle Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"vehicle_number",control:r,render:({field:t})=>e.jsx(m,{...t,placeholder:"e.g., RJ14AB1234"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Driver Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{name:"driver_name",control:r,render:({field:t})=>e.jsx(m,{...t,placeholder:"Enter driver name"})})]})]}),e.jsx("div",{className:"px-2 md:px-0",children:e.jsxs(W,{title:"Items Requested",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(g,{className:"bg-red-600 text-white px-3 py-1 text-sm",onClick:()=>F({item_id:"",item_name:"",item_code:"",item_unit:"",quantity_out:"",item_description:""}),children:"+ Add Item"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Q,{children:[e.jsx(z,{cols:[{title:"Item Name"},{title:"Item Code"},{title:"Item Unit"},{title:"Out Qty"},{title:"Remarks"},{title:"Action"}]}),e.jsx("tbody",{children:C.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8 text-gray-500",children:'No items added. Click "Add Item" to get started.'})}):C.map((t,s)=>e.jsxs("tr",{className:"align-middle",children:[e.jsx(c,{className:"text-center w-16",children:s+1}),e.jsx(c,{className:"min-w-[200px]",children:e.jsx(n,{name:`items.${s}.item_id`,control:r,render:({field:a})=>e.jsxs("select",{...a,className:"w-full h-10 rounded-lg border px-3 text-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500 bg-white",onChange:l=>{const o=Number(l.target.value);a.onChange(o);const u=w.find(D=>D.id===o);u&&(i(`items.${s}.item_code`,u.item_code),i(`items.${s}.item_unit`,u.unit?.unit_name||""),i(`items.${s}.item_name`,u.item_name))},value:a.value,children:[e.jsx("option",{value:"",children:"Select item"}),w.map(l=>e.jsx("option",{value:l.id,children:l.item_name},l.id))]})})}),e.jsx(c,{className:"min-w-[120px]",children:e.jsx(n,{name:`items.${s}.item_code`,control:r,render:({field:a})=>e.jsx("input",{...a,className:"w-full h-10 border rounded-lg px-3 text-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Auto-filled",readOnly:!0})})}),e.jsx(c,{className:"min-w-[100px]",children:e.jsx(n,{name:`items.${s}.item_unit`,control:r,render:({field:a})=>e.jsx("input",{...a,className:"w-full h-10 border focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500 bg-white rounded-lg px-3 text-sm",placeholder:"Auto-filled",readOnly:!0})})}),e.jsx(c,{className:"min-w-[120px]",children:e.jsx(n,{name:`items.${s}.quantity_out`,control:r,render:({field:a})=>e.jsx("input",{...a,type:"number",min:"0",step:"0.01",className:"w-full h-10 border rounded-lg px-3 text-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500",placeholder:"Enter qty"})})}),e.jsx(c,{className:"min-w-[150px]",children:e.jsx(n,{name:`items.${s}.item_description`,control:r,render:({field:a})=>e.jsx("input",{...a,className:"w-full h-10 border rounded-lg px-3 text-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500",placeholder:"Add remarks"})})}),e.jsx(c,{children:e.jsx(J,{children:e.jsx(K,{onClick:()=>q(s)})})})]},t.id))})]})})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 px-2 md:px-0 md:mr-5",children:[e.jsx(g,{variant:"outline",className:"w-full sm:w-auto",onClick:()=>x(y.NON_RETURNABLE_GATEPAS.LIST),disabled:j,children:"Cancel"}),e.jsx(g,{className:"bg-red-600 text-white w-full sm:w-auto",onClick:$(U),loading:j,disabled:j,children:d?"Update Gate Pass":"Create Gate Pass"})]})]})};export{ge as default};
