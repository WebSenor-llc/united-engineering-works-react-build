import{r as f,a as A,j as e,y as T,h as L,e as P,G as E,u as z,k as V,P as R,A as D}from"./index-9KeMeSmC.js";import{L as O}from"./ListWrapper-2d9ET8qH.js";import{T as W,a as k,b as u}from"./TableWrapper-Cibv4hJc.js";import{T as U}from"./TableRow-KN3kP3T0.js";import{u as F}from"./usePagination-C2SwPsFT.js";import{T as G,a as H}from"./TableDelete--7gMyMPR.js";import{L as $}from"./Loading-BskLJe7P.js";import{S as M}from"./StatusFilter-Cb5C5Fuk.js";import{D as q,P as K,S as Z,V as a,I as J,T as s,a as Q,p as X}from"./react-pdf.browser-c6znmXeX.js";const Y=({purchaseOrder:l,onStatusUpdate:y})=>{const[x,C]=f.useState(!1),[c,g]=f.useState({open:!1,action:"",title:""}),[r,m]=f.useState(""),{user:v}=A(),w=()=>{const n=v?.role?.role_name,o=l.status,i=[];return n==="Super Admin"&&(o==="Pending_Approval"||o==="Pending Approval"||o==="pending_approval"||o==="pending_admin_approval")&&i.push({label:"Approve",value:"Approved",variant:"success"},{label:"Reject",value:"Rejected",variant:"danger"}),n==="Purchase Manager"&&o==="Approved"&&i.push({label:"Send to Vendor",value:"Sent_to_Vendor",variant:"primary"}),i},j=async n=>{if(n==="Rejected"){g({open:!0,action:n,title:"Reject Purchase Order"});return}await b(n)},b=async(n,o)=>{C(!0);try{const i={status:n};o&&(i.reason=o),await L.post(P.purchase_order.status(l.id),i),T.success("Status updated successfully"),y()}catch(i){console.error("Failed to update status:",i),T.error(i.response?.data?.message||"Failed to update status")}finally{C(!1)}},h=async()=>{if(!r.trim()){T.error("Please enter a reason");return}await b(c.action,r),p()},p=()=>{g({open:!1,action:"",title:""}),m("")},d=w(),_=(()=>{switch(l.status){case"Approved":return{text:"Approved",className:"border-gray-400 text-gray-800"};case"Pending_Approval":case"Pending Approval":case"pending_approval":case"pending_admin_approval":return{text:l.status.replace(/_/g," "),className:"border-gray-400 text-gray-800"};case"Rejected":return{text:"Rejected",className:"border-gray-400 text-gray-800"};case"Sent_to_Vendor":case"Sent to Vendor":return{text:l.status.replace(/_/g," "),className:"border-gray-400 text-gray-800"};case"Cancelled":return{text:"Cancelled",className:"border-gray-300 text-gray-800"};default:return{text:l.status?.replace(/_/g," ")||"Unknown",className:"border-gray-400 text-gray-800"}}})();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:x?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Updating..."})]}):e.jsx(e.Fragment,{children:e.jsxs("select",{className:`text-xs border rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white min-w-[140px] ${d.length===0?"opacity-50 cursor-not-allowed":""} ${_.className}`,value:"",onChange:n=>{n.target.value&&d.length>0&&(j(n.target.value),n.target.value="")},disabled:x||d.length===0,children:[e.jsxs("option",{value:"",className:"font-medium",children:[_.text," ",d.length>0?"â–¼":""]}),d.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))]})})}),c.open&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:c.title}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:`Enter reason for ${c.action}...`,value:r,onChange:n=>m(n.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{className:"px-4 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50",onClick:p,disabled:x,children:"Cancel"}),e.jsx("button",{className:`px-4 py-2 text-sm rounded-lg text-white ${c.action==="Cancelled"?"bg-red-600 hover:bg-red-700":"bg-yellow-500 hover:bg-yellow-600"}`,onClick:h,disabled:x,children:x?"Processing...":"Submit"})]})]})})]})};function ee(l){return E({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",strokeWidth:"2",d:"M12,21 C7,21 1,16 1,12 C1,8 7,3 12,3 C17,3 23,8 23,12 C23,16 17,21 12,21 Z M12,7 C9.23875,7 7,9.23875 7,12 C7,14.76125 9.23875,17 12,17 C14.76125,17 17,14.76125 17,12 C17,9.23875 14.76125,7 12,7 L12,7 Z"},child:[]}]})(l)}const te=l=>l?new Date(l).toLocaleDateString("en-IN",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",se=({po:l})=>{const x=(l.items||[]).map(r=>{const m=r.item?.item_name||"-",v=r.item?.item_code||"-",w=r.item?.unit?.unit_name||"-",j=Number(r.unit_price)||0,b=Number(r.quantity_ordered)||0,h=Number(r.tax_percentage)||0,p=b*j,d=p*h/100;return{...r,item_name:m,item_code:v,item_unit:w,rate:j,amount:p,gstAmount:d,tax_percentage:h}}),C=typeof l.subtotal=="string"?parseFloat(l.subtotal):l.subtotal||0,c=typeof l.tax_amount=="string"?parseFloat(l.tax_amount):l.tax_amount||0,g=typeof l.total_amount=="string"?parseFloat(l.total_amount):l.total_amount||0;return e.jsx(q,{children:e.jsxs(K,{size:"A4",style:t.page,children:[e.jsxs(a,{style:t.headerContainer,children:[e.jsx(a,{style:t.logoSection,children:e.jsx(J,{src:"/assets/images/logo.png",style:t.logo})}),e.jsxs(a,{style:t.companyInfo,children:[e.jsx(s,{style:t.companyName,children:"UNITED ENGINEERING WORKS"}),e.jsx(s,{style:t.companyAddress,children:"Neha Village, NH-08, Udai Pur, 313001"}),e.jsx(s,{style:t.companyContact,children:"Phone: 9829232445 | GSTIN: 08ABCPK8948J2P"})]})]}),e.jsx(s,{style:t.title,children:"PURCHASE ORDER"}),e.jsxs(a,{style:t.infoContainer,children:[e.jsxs(a,{style:t.poDetailsBox,children:[e.jsxs(a,{style:t.detailRow,children:[e.jsx(s,{style:t.label,children:"PO No:"}),e.jsx(s,{style:t.value,children:l.po_number})]}),e.jsxs(a,{style:t.detailRow,children:[e.jsx(s,{style:t.label,children:"PO Date:"}),e.jsx(s,{style:t.value,children:te(l.po_date)})]}),e.jsxs(a,{style:t.detailRow,children:[e.jsx(s,{style:t.label,children:"Branch:"}),e.jsx(s,{style:t.value,children:l.branch?.branch_name||"-"})]}),e.jsxs(a,{style:t.detailRow,children:[e.jsx(s,{style:t.label,children:"Delivery Address:"}),e.jsx(s,{style:t.value,children:l.delivery_address||"-"})]}),e.jsxs(a,{style:t.detailRow,children:[e.jsx(s,{style:t.label,children:"Contact Person:"}),e.jsx(s,{style:t.value,children:l.delivery_contact_person||"-"})]}),e.jsxs(a,{style:t.detailRow,children:[e.jsx(s,{style:t.label,children:"Phone:"}),e.jsx(s,{style:t.value,children:l.delivery_contact_phone||"-"})]})]}),e.jsxs(a,{style:t.vendorDetailsBox,children:[e.jsx(s,{style:t.vendorTitle,children:"VENDOR DETAILS"}),e.jsxs(a,{style:t.vendorDetailRow,children:[e.jsx(s,{style:t.vendorLabel,children:"Name:"}),e.jsx(s,{style:t.vendorValue,children:l.vendor?.party_name||"-"})]}),e.jsxs(a,{style:t.vendorDetailRow,children:[e.jsx(s,{style:t.vendorLabel,children:"Company:"}),e.jsx(s,{style:t.vendorValue,children:l.vendor?.company_name||"-"})]}),e.jsxs(a,{style:t.vendorDetailRow,children:[e.jsx(s,{style:t.vendorLabel,children:"Address:"}),e.jsxs(s,{style:t.vendorValue,children:[l.vendor?.address||"-",", ",l.vendor?.city||"-",","," ",l.vendor?.state||"-"," - ",l.vendor?.pincode||"-"]})]}),e.jsxs(a,{style:t.vendorDetailRow,children:[e.jsx(s,{style:t.vendorLabel,children:"Contact:"}),e.jsx(s,{style:t.vendorValue,children:l.vendor?.contact_person||"-"})]}),e.jsxs(a,{style:t.vendorDetailRow,children:[e.jsx(s,{style:t.vendorLabel,children:"Phone:"}),e.jsx(s,{style:t.vendorValue,children:l.vendor?.phone||"-"})]}),e.jsxs(a,{style:t.vendorDetailRow,children:[e.jsx(s,{style:t.vendorLabel,children:"Email:"}),e.jsx(s,{style:t.vendorValue,children:l.vendor?.email||"-"})]})]})]}),e.jsxs(a,{style:t.tableContainer,children:[e.jsxs(a,{style:t.tableHeaderRow,children:[e.jsx(a,{style:[t.tableCell,t.snoCol,t.headerCell],children:e.jsx(s,{style:t.headerText,children:"S.No"})}),e.jsx(a,{style:[t.tableCell,t.itemNameCol,t.headerCell],children:e.jsx(s,{style:t.headerText,children:"Item Name"})}),e.jsx(a,{style:[t.tableCell,t.itemCodeCol,t.headerCell],children:e.jsx(s,{style:t.headerText,children:"Item Code"})}),e.jsx(a,{style:[t.tableCell,t.qtyCol,t.headerCell],children:e.jsx(s,{style:t.headerText,children:"Qty"})}),e.jsx(a,{style:[t.tableCell,t.unitCol,t.headerCell],children:e.jsx(s,{style:t.headerText,children:"Unit"})}),e.jsx(a,{style:[t.tableCell,t.rateCol,t.headerCell],children:e.jsx(s,{style:t.headerText,children:"Rate"})}),e.jsx(a,{style:[t.tableCell,t.gstCol,t.headerCell],children:e.jsx(s,{style:t.headerText,children:"GST%"})}),e.jsx(a,{style:[t.tableCell,t.amountCol,t.headerCell],children:e.jsx(s,{style:t.headerText,children:"Amount"})})]}),x.map((r,m)=>e.jsxs(a,{style:t.tableRow,children:[e.jsx(a,{style:[t.tableCell,t.snoCol],children:e.jsx(s,{style:t.cellText,children:m+1})}),e.jsx(a,{style:[t.tableCell,t.itemNameCol],children:e.jsx(s,{style:t.cellText,children:r.item_name})}),e.jsx(a,{style:[t.tableCell,t.itemCodeCol],children:e.jsx(s,{style:t.cellText,children:r.item_code})}),e.jsx(a,{style:[t.tableCell,t.qtyCol],children:e.jsx(s,{style:t.cellText,children:String(r.quantity_ordered)})}),e.jsx(a,{style:[t.tableCell,t.unitCol],children:e.jsx(s,{style:t.cellText,children:r.item_unit})}),e.jsx(a,{style:[t.tableCell,t.rateCol],children:e.jsx(s,{style:t.cellText,children:r.rate})}),e.jsx(a,{style:[t.tableCell,t.gstCol],children:e.jsxs(s,{style:t.cellText,children:[r.tax_percentage||0,"%"]})}),e.jsx(a,{style:[t.tableCell,t.amountCol],children:e.jsx(s,{style:t.cellText,children:r.amount+r.gstAmount})})]},r.item_id||m))]}),e.jsxs(a,{style:t.totalsContainer,children:[e.jsxs(a,{style:t.totalRow,children:[e.jsx(s,{style:t.totalLabel,children:"Subtotal:"}),e.jsx(s,{style:t.totalValue,children:C})]}),e.jsxs(a,{style:t.totalRow,children:[e.jsx(s,{style:t.totalLabel,children:"Total GST:"}),e.jsx(s,{style:t.totalValue,children:c})]}),e.jsxs(a,{style:[t.totalRow,t.grandTotalRow],children:[e.jsx(s,{style:t.grandTotalLabel,children:"Grand Total:"}),e.jsx(s,{style:t.grandTotalValue,children:g})]})]}),e.jsxs(a,{style:t.termsSection,children:[e.jsx(s,{style:t.termsTitle,children:"Terms & Conditions:"}),l.special_instructions&&e.jsxs(s,{style:t.termsText,children:["4. ",l.special_instructions]})]}),e.jsx(a,{style:t.signatureContainer,children:e.jsxs(a,{style:t.signatureBox,children:[e.jsx(s,{style:t.signatureTitle,children:"For: UNITED ENGINEERING WORKS"}),e.jsx(a,{style:t.signatureLine}),e.jsx(s,{style:t.signatureText,children:"Authorized Signatory"})]})})]})})},t=Z.create({page:{padding:20,fontSize:10,fontFamily:"Helvetica",lineHeight:1.3},headerContainer:{flexDirection:"row",alignItems:"center",marginBottom:15,paddingBottom:10,borderBottomWidth:2,borderBottomColor:"#000",gap:20},logoSection:{width:"20%",marginRight:20},logo:{width:90,height:50},companyInfo:{width:"80%",alignItems:"flex-start",paddingLeft:20},companyName:{fontSize:16,fontWeight:"bold",marginBottom:3},companyAddress:{fontSize:10,marginBottom:2},companyContact:{fontSize:10},title:{fontSize:18,textAlign:"center",marginBottom:15,fontWeight:"bold",textDecoration:"underline"},infoContainer:{flexDirection:"row",marginBottom:15,justifyContent:"space-between"},poDetailsBox:{width:"48%",padding:8,marginTop:10},vendorDetailsBox:{width:"48%",padding:4,marginLeft:6},vendorTitle:{fontSize:11,fontWeight:"bold",marginBottom:5,textAlign:"center",transform:"translateX(-20)"},detailRow:{flexDirection:"row",marginBottom:3},label:{width:"28%",fontSize:9,fontWeight:"bold",marginLeft:0},value:{width:"65%",fontSize:9},vendorDetailRow:{flexDirection:"row",marginBottom:2,justifyContent:"flex-end",alignItems:"flex-start"},vendorLabel:{width:"25%",fontSize:9,fontWeight:"bold",textAlign:"right"},vendorValue:{width:"70%",fontSize:9,textAlign:"left",marginLeft:8},tableContainer:{marginBottom:15,borderWidth:.25,borderColor:"#000"},tableHeaderRow:{flexDirection:"row",backgroundColor:"#e0e0e0"},tableRow:{flexDirection:"row"},tableCell:{padding:2,borderWidth:.25,borderColor:"#000",justifyContent:"center",alignItems:"center"},headerCell:{backgroundColor:"#f0f0f0"},headerText:{fontSize:9,fontWeight:"bold",textAlign:"center"},cellText:{fontSize:8,textAlign:"center"},snoCol:{width:"8%"},itemNameCol:{width:"30%"},itemCodeCol:{width:"20%"},qtyCol:{width:"8%"},unitCol:{width:"8%"},rateCol:{width:"12%"},gstCol:{width:"8%"},amountCol:{width:"14%"},totalsContainer:{alignItems:"flex-end",marginBottom:15,paddingRight:20},totalRow:{flexDirection:"row",width:220,justifyContent:"space-between",marginBottom:3},totalLabel:{fontSize:10,fontWeight:"bold"},totalValue:{fontSize:10},grandTotalRow:{marginTop:5,paddingTop:5,borderTopWidth:1,borderTopColor:"#000"},grandTotalLabel:{fontSize:11,fontWeight:"bold"},grandTotalValue:{fontSize:11,fontWeight:"bold"},termsSection:{marginBottom:20,padding:8},termsTitle:{fontSize:9,fontWeight:"bold",marginBottom:10,textDecoration:"underline"},termsText:{fontSize:9,marginBottom:2},signatureContainer:{marginTop:50,alignItems:"flex-end"},signatureBox:{width:220,alignItems:"center"},signatureTitle:{fontSize:10,fontWeight:"bold",marginBottom:30},signatureLine:{width:150,height:1,backgroundColor:"#000",marginBottom:5},signatureText:{fontSize:9}}),le=l=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:2}).format(l),ae=l=>l?new Date(l).toLocaleDateString("en-IN",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",ue=()=>{const{page:l,rowsPerPage:y,setTotal:x,renderPagination:C}=F(),c=z(),{selectedBranchId:g,user:r}=A(),{setPurchaseOrders:m}=V(),[v,w]=f.useState([]),[j,b]=f.useState(!1),[h,p]=f.useState(""),d=async()=>{b(!0);try{const n=await L.get(P.purchase_order.list,{params:{page:l+1,per_page:y,...g&&{branch_id:g}}}),{purchase_orders:o,pagination:i}=n.data;if(w(o||[]),x(i?.total||0),r?.role?.role_name==="Purchase Manager"){const B=(o||[]).filter(I=>I.status==="Pending Approval").length;m(B)}}catch(n){console.log(n)}finally{b(!1)}};f.useEffect(()=>{d()},[l,y,g]);const N=h?v.filter(n=>n.status===h):v,_=async n=>{const o=await X(e.jsx(se,{po:n})).toBlob(),i=URL.createObjectURL(o),S=document.createElement("a");S.href=i,S.download=`${n?.po_number}.pdf`,S.click(),URL.revokeObjectURL(i)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(M,{module:"purchaseOrder",selectedStatus:h,onChange:n=>p(n)}),e.jsxs(O,{title:`Purchase Orders (${N.length})`,createOnClick:R.hasPermission("purchase_order_create")?()=>c(D.PURCHASE_ORDER.CREATE):void 0,children:[j?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx($,{})}):e.jsxs(W,{children:[e.jsx(k,{cols:[{title:"PO Number"},{title:"PO Date"},{title:"Vendor"},{title:"Branch"},{title:"Items"},{title:"Total Amount"},{title:"Status"},{title:"Actions",width:"w-96"}]}),e.jsx("tbody",{children:j?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Loading purchase orders..."})]})})}):N.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No purchase orders"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:h?`No orders found with status "${h}"`:"Get started by creating a new purchase order."})]})})}):N.map((n,o)=>e.jsxs(U,{children:[e.jsx(u,{className:"w-12 text-center font-medium",children:e.jsx("div",{className:"text-sm text-gray-900",children:o+1})}),e.jsx(u,{className:"w-40",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:n.po_number})})}),e.jsx(u,{className:"w-32",children:e.jsx("div",{className:"text-sm text-gray-900",children:ae(n.po_date)})}),e.jsx(u,{className:"w-48",children:e.jsx("div",{className:"text-sm text-gray-900",children:n.vendor?.party_name||"-"})}),e.jsx(u,{className:"w-32",children:e.jsx("div",{className:"text-sm text-gray-900",children:n.branch?.branch_name||"-"})}),e.jsx(u,{className:"w-20",children:e.jsx("div",{className:"text-sm text-gray-900",children:n.items?.length||0})}),e.jsx(u,{className:"w-32",children:e.jsx("div",{className:"text-sm text-gray-900",children:le(n.total_amount||0)})}),e.jsx(u,{className:"w-40",children:e.jsx(Y,{purchaseOrder:{id:n.id,status:n.status,po_number:n.po_number},onStatusUpdate:d})}),e.jsx(u,{className:"w-20",children:e.jsxs(G,{children:[R.hasPermission("purchase_order_update")&&e.jsx("div",{className:`flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-full  \r
                   hover:bg-gray-200 hover:text-gray-700 transition\r
                   bg-gray-200 text-gray-700\r
                   disabled:cursor-not-allowed disabled:opacity-40 touch-manipulation`,children:e.jsx(ee,{onClick:()=>c(`${D.PURCHASE_ORDER.CREATE}?editId=${n.id}`)})}),R.hasPermission("purchase_order_delete")&&e.jsx(H,{refetch:d,endpoint:P.purchase_order.delete(n.id)}),e.jsx(Q,{title:"Download PO",onClick:()=>_(n)})]})})]},n.id))})]}),N.length>0&&C()]})]})};export{ue as default};
